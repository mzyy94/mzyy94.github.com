<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: osmc | 犬アイコンのみっきー]]></title>
  <link href="http://mzyy94.com/blog/tags/osmc/atom.xml" rel="self"/>
  <link href="http://mzyy94.com/"/>
  <updated>2015-05-20T00:07:55+09:00</updated>
  <id>http://mzyy94.com/</id>
  <author>
    <name><![CDATA[mzyy94]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[KodiでChinachuの録画を観るAdd-on作った]]></title>
    <link href="http://mzyy94.com/blog/2015/02/24/kodi-chinachu-addon/"/>
    <updated>2015-02-24T19:28:35+09:00</updated>
    <id>http://mzyy94.com/blog/2015/02/24/kodi-chinachu-addon</id>
    <content type="html"><![CDATA[<p>Raspberry Pi2でKodi（旧：XBMC)が快適に動き、地デジのLIVE視聴環境として優れているので、
Chinachuの本領である録画した動画の視聴したみが高まってきました。</p>

<p>Kodiには簡単にAdd-onが作れる仕組みがあり、動画や音楽のコンテンツを独自で配信・管理する仕組みがつくれます。
Chinachuには録画ファイルの情報とストリーミング視聴ができるREST APIが搭載されているので、
これを叩いてKodiで動画コンテンツを視聴できるAdd-onを作ったのでお知らせいたします。</p>

<!-- more -->


<h1>Kodi/XBMC Add-on</h1>

<p>KodiではPythonを用いてGUIやコンテンツを操るAdd-onを作成できるようになっています。
Add-on作成に関する情報は<a href="http://kodi.wiki/view/Add-on_development">Add-on development - Kodi</a>にあるので、作成はそこまで難しくないです。
コンテンツ管理プラグインの他にも、スキンやバックグラウンドサービスも同じAdd-onの構造で作成できるので興味がある人は作ってみてください。</p>

<h1>Chinachu client add-on</h1>

<p>ChinachuのREST APIを叩いて動画を取得してコンテンツ一覧に表示、再生、そしてChinachuサーバー上の録画データを削除できるAdd-onを作成しました。</p>

<p><strong><a href="https://github.com/mzyy94/plugin.video.chinachu">https://github.com/mzyy94/plugin.video.chinachu</a></strong></p>

<p>Releaseのページからダウンロードして設定のアドオンからzipファイルからインストールでインストールしてください。
その後、有効なアドオンの一覧からビデオアドオンにあるChinachu clientを探し、設定を開いてChinachuの動くサーバーのアドレスとその他オプションを設定すると利用できるようになります。</p>

<h2>使い方</h2>

<p>利用方法は、Kodiトップにあるビデオメニューの中のビデオアドオンからChinachu clientを起動するだけです。</p>

<p><img src="/blog/resources/images/2015/02/24/launch-chinachu-client.png" alt="Launch Chinachu client" /></p>

<p>一覧の動画を選択した状態で右クリックを押すかメニューを表示すると、メニュー中に削除の項目があります。
これを選択すると、確認ダイアログ表示の後、Chinachuで管理されている<strong>録画ファイルと録画情報の両方を削除</strong>します。
キャンセルはできないのでご注意を。</p>

<p><img src="/blog/resources/images/2015/02/24/deletion-dialog.png" alt="File deletion" /></p>

<h2>設定</h2>

<p><img src="/blog/resources/images/2015/02/24/configuration-window.png" alt="Configuratoin window" /></p>

<p>Chinachu clientには幾つか設定を設けてあります。</p>

<h3>基本</h3>

<p>基本となるChinachuのURLの設定は必須です。Chinachu-WUIのAPIを叩くので、プロトコルとポート番号を含めたURLを設定してください。</p>

<p><img src="/blog/resources/images/2015/02/24/general-configuration.png" alt="General configuratoin" /></p>

<h3>ストリーミング</h3>

<p>ストリーミングカテゴリにはChinachu WUIでストリーミングする際に指定するものと同じ感覚で設定してください。
MPEG-2 ハードウェアデコーダーを導入してあるRasPi2ではこのオプションは未設定の方が良いと思います。</p>

<h3>サムネイル</h3>

<p>サムネイルカテゴリには、Chinachu APIのpreview.jpgを取得してKodiのサムネイルフォルダにキャッシュするオプションがあります。
avconvで生成している都合上、取得には時間がかかるので必要でなければ無効のままにしておくことをお勧めします。
また、一度サムネイルを取得し始めるとKodiを終了するまでバックグラウンドで取得し続けます。さらに、未取得のサムネイルは毎囘取得しに行きます。
この点ご注意ください。</p>

<p>サムネイルが不要になった際は、キャッシュのクリアもできます。</p>

<h3>動画情報</h3>

<p>動画情報カテゴリでは、動画情報に関する細かなオプションがあります。</p>

<p>エピソード番号を強制的に指定オプションは、一部のテーマ向けの設定です。
放送日がエピソード番号が指定されていないと表示されないテーマがあるため、放送日が表示されない動画がある場合は有効にしてください。
このオプションが有効の場合、バラエティ番組など連続したエピソードがない放送にエピソード番号に1を指定します。</p>

<p>チャンネル名を表示する場所を選択するオプションも、一部のテーマ向けの設定です。
通常、チャンネル名はスタジオとして動画情報に登録されている場合、動画の詳細情報に表示されるのですが、テーマによってはスタジオを表示しないものがあるようです。
チャンネル名が表示されないなと思ったらこのオプションをいじってみてください。</p>

<h2>動作してる図</h2>

<p>こんなかんじです。
スキンは一番上はConfluenceで他はTitanです。</p>

<p><img src="/blog/resources/images/2015/02/24/preview1.png" alt="Preview1" />
<img src="/blog/resources/images/2015/02/24/preview2.png" alt="Preview2" />
<img src="/blog/resources/images/2015/02/24/preview3.png" alt="Preview3" />
<img src="/blog/resources/images/2015/02/24/preview4.png" alt="Preview4" />
<img src="/blog/resources/images/2015/02/24/preview5.png" alt="Preview5" /></p>

<h1>まとめ</h1>

<p>Raspberry Pi2は買いである</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KodiとChinachuで地デジLive視聴 on Raspberry Pi2 w/ OSMC]]></title>
    <link href="http://mzyy94.com/blog/2015/02/21/kodi-livetv-chinachu/"/>
    <updated>2015-02-21T07:02:43+09:00</updated>
    <id>http://mzyy94.com/blog/2015/02/21/kodi-livetv-chinachu</id>
    <content type="html"><![CDATA[<p>どうも、Raspberry Pi2で遊ぶ毎日が続いております。
Raspberry Pi model B（2ではない）にRaspbmcを入れて昨年の夏頃からChinachu経由で地上デジタル放送を視聴する環境を構築していたのですが、
いかんせんスペックが低く、チャンネル切り替え時などにもたついていました。</p>

<p>Raspberry Pi2が発売され、従来の6倍のパフォーマンスが発揮できるようになり、もたつきがなく不便しなくなってきたので、
Raspbmc改めOSMCで地デジ視聴をする方法をまとめます。</p>

<!-- more -->


<h1>PVRクライアント</h1>

<p>Kodi(旧:XBMC)にはテレビ放送を視聴するためのPVRクライアントという機能があります。
テレビ放送の配信携帯に合わせていくつかPVRクライアントがAdd-onとして提供されていますが、汎用的につかえるものに
<a href="https://github.com/afedchin/xbmc-addon-iptvsimple/">XBMC IPTV Simple Client</a>というものがあります。</p>

<p>XBMCからKodiに名称変更した際に、Kodi本体にこれらのPVRクライアントはあらかじめバンドルされるようになり、
これまでは各自ビルドしてインストールしていたのが、設定して有効化するだけで使えるようになっています。
もちろんこのIPTV Simple Clientもバンドルされています。これを使って地デジを視聴する環境を構築します。</p>

<h2>IPTV Simple Client</h2>

<p>このAdd-onは、m3u形式で配信されているチャンネル配信情報と、<a href="http://wiki.xmltv.org/index.php/XMLTVFormat">XMLTV形式</a>で配信されている番組表情報を用いてネットワーク経由でテレビを視聴することができるPVRクライアントです。
数あるプレイリストフォーマットの中でも一般的な形式であるm3uと、<a href="http://www.mythtv.org/">MythTV</a>などのテレビ視聴・録画クライアントがサポートするEPG番組表形式であるXMLTVを用いているため、テレビ放送配信側となるサーバーがサポートしていれば簡単に地デジをKodiで視聴できます。
G
今回テレビ放送を配信するサーバーとしてはChinachuを使いますが、残念ながら上記のm3u形式のチャンネル情報とXMLTV形式の番組表情報は提供されていません。
なので、Chinachuに2つのファイルを追加して機能を追加することで対応するようにしました。</p>

<h1>Chinachu</h1>

<p>数ある地デジ録画管理ソフトウェアの中でもモダンなデザインで、使い勝手がよくREST APIを提供している素敵なソフトウェアです。
Chinachuは番組の録画・再生が主な機能とされていますが、現在放送中の番組の視聴にも対応しており、APIを経由することでいろいろなクライアントから再生することができます。
しかし、前途の通りChinachuが提供するAPIでは、IPTV Simple Clientが対応するm3u形式のプレイリストやXMLTV形式の番組表情報は取得できません。
幸いなことに、ChinachuへのAPIの追加は難しくなく、Chinachuが動作するディレクトリ直下にある<strong>api</strong>ディレクトリにAPIリソース情報とスクリプトを配置することで必要なAPIを追加することができます。</p>

<p>IPTV Simple Clientに必要な、</p>

<ul>
<li>m3u形式でのチャンネル配信情報</li>
<li>XMLTV形式での番組表情報</li>
</ul>


<p>の二つをAPIで提供するファイルを作りました。
以下からダウンロードしてapiディレクトリのファイルをChinachuのapiディレクトリに放り込んでください。</p>

<p><em><a href="https://github.com/mzyy94/Chinachu-IPTV-API-addon">https://github.com/mzyy94/Chinachu-IPTV-API-addon</a></em></p>

<p>これを導入すると、</p>

<ul>
<li><code>/api/iptv/channel.m3u8</code>にチャンネル配信情報</li>
<li><code>/api/iptv/epg.xml</code>にXMLTV情報</li>
</ul>


<p>が提供されるようになります。</p>

<h1>KodiでSimple IPTV Clientの設定</h1>

<p>サーバー側の準備は整ったのでKodiの方の設定をします。前回の記事で日本語化したRaspberry Pi2で動くOSMC上のKodiでの設定方法になります。</p>

<p>上記の通り、KodiにはPVRクライアントが導入されているので、Add-on管理から設定をして有効化するだけで準備ができます。</p>

<p>まず、設定のAdd-onの中にある無効なアドオンからPVR Simple IPTV Clientを探して選択し、設定画面を開きます。</p>

<p><img src="/blog/resources/images/2015/02/21/disabled-addons.png" alt="Disabled add-ons" />
<img src="/blog/resources/images/2015/02/21/iptv-simple-client-addon.png" alt="IPTV Simple client" /></p>

<p>設定画面にあるM3UプレイリストのURLとXMLTV URLにChinachuのWUIが動作するURLに続けて、下図のように設定します。
各自環境に合わせて<code>chinachu:10772</code>の部分を書き換えてください。</p>

<p><img src="/blog/resources/images/2015/02/21/addon-configure1.png" alt="Add-on configure1" />
<img src="/blog/resources/images/2015/02/21/addon-configure2.png" alt="Add-on configure2" /></p>

<p>設定を終えたらSimple IPTV Clientの<strong>有効</strong>を選択して有効にし、Kodiの全体の設定にあるLive TV設定に移動してLCD有効(誤訳？)すると、
トップの画像のようにライブTVの項目が現れ、PVRが利用できるようになります。</p>

<p><img src="/blog/resources/images/2015/02/21/enable-pvr.png" alt="Enable PVR" /></p>

<p>m3uプレイリストとしてAPIが提供するチャンネルは、Chinachuの設定ファイルに記載の通りの順番でサブチャンネル含め配信しているので、
後日紹介するであろうリモコンを使ってチャンネル切り替えを行う場合は、Live TV設定のチャンネルマネージャーからグループ管理を行って、
不要なチャンネルを隠すことでリモコンでの操作に適したチャンネルのみを切り替え可能にできます。</p>

<p><img src="/blog/resources/images/2015/02/21/channel-manager1.png" alt="Channel Manager1" />
<img src="/blog/resources/images/2015/02/21/channel-manager2.png" alt="Channel Manager2" />
<img src="/blog/resources/images/2015/02/21/channel-manager3.png" alt="Channel Manager3" /></p>

<p>ここまで終わった状態で、Kodiのトップに移動するとライブTVの項目が増えているはずです。これを選択すると、デフォルトではEPG番組表が表示されます。
Kodi上でキーボードのEを押すと同じようにEPG番組表が表示されます。</p>

<p><img src="/blog/resources/images/2015/02/21/pvr-epg.png" alt="PVR EPG view" /></p>

<p>ここで、バックスペースキーを押すとチャンネル一覧を表示するメニューが現れるので、そちらに切り替えると現在放送中の番組情報が表示されます。
もしくはキーボードのHを押すことでチャンネル一覧が表示できます。</p>

<p><img src="/blog/resources/images/2015/02/21/pvr-channel.png" alt="PVR Channel view" /></p>

<p>ここで好きなようにチャンネルを切り替え、地デジを観ることができます。</p>

<h1>まとめ</h1>

<p>MPEG-2ライセンスを導入してあるRaspberry Pi2だとサクサク地デジが見られる。</p>

<p><a href="https://twitter.com/mzyy94/status/565610656809091072">https://twitter.com/mzyy94/status/565610656809091072</a>&#8220;>https://twitter.com/mzyy94/status/565610656809091072&#8221;>https://twitter.com/mzyy94/status/565610656809091072</a></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Raspberry Pi2にOSMC入れてKodi(旧:XBMC)日本語化するまで]]></title>
    <link href="http://mzyy94.com/blog/2015/02/16/raspberry-pi2-osmc-jp/"/>
    <updated>2015-02-16T20:05:56+09:00</updated>
    <id>http://mzyy94.com/blog/2015/02/16/raspberry-pi2-osmc-jp</id>
    <content type="html"><![CDATA[<p>今月頭の発表で一気に盛り上がりを見せた<a href="http://www.raspberrypi.org/products/raspberry-pi-2-model-b/">Raspberry Pi 2 Model B</a>。もちろん発売日に購入しました。
手元にはRaspberry Pi BとGalileo Gen2の2つのLinuxが動く小型ボードがあるんですが、主にメディアセンター用途で使おうとしていたRaspberry Pi Bに性能面で不満を抱いていたため、今回この新バージョン購入は即決しました。</p>

<p>Raspberry Piでのメディアセンター用途で代表的なのは<a href="http://www.raspbmc.com/">Raspbmc</a>ですが、
このプロジェクトは<a href="https://osmc.tv/about/">OSMC</a>に移行するようで、2015年2月2日のFinalリリースの配布をもって終了となりました。</p>

<p>ということで、Raspberry Pi 2 Model B(以下、RPi2B)にOSMCを導入して日本語化するまでのメモを残します。</p>

<!-- more -->


<h1>OSMCインストール</h1>

<p><img src="/blog/resources/images/2015/02/16/osmc-installer.png" alt="OSMC Installer" /></p>

<p>OSMCは<a href="https://osmc.tv/download/">https://osmc.tv/download/</a>からインストーラーがダウンロードできるので、自分の使ってるOSにあったインストーラーをダウンロード・実行して、microSDHCにイメージを書き込むだけです。2015/2/16時点での最新版であるAlpha 4をインストールしました。</p>

<h1>日本語化</h1>

<p><img src="/blog/resources/images/2015/02/16/osmc-mainmenu.png" alt="OSMC main menu" /></p>

<p>起動するとこんな感じです。OSMCテーマ標準のフォントは流行りのLightなウェイトを持つRobotoとOpenSansが利用されているため、もちろんのこと日本語は表示できません。
テーマのデザインを損ねることなく、日本語でも美しい細字のフォントで表示したく思い、<a href="http://mplus-fonts.sourceforge.jp/mplus-outline-fonts/index.html">M+ FONT</a>を利用することにしました。</p>

<p>M+ FONTはJIS第一水準までの漢字を網羅し、極細から極太まで7種のウェイトを収録した美しいフリーフォントです。
LightウェイトフォントでJIS第二水準まで含むオープンなフォントはAdobeとGoolgeが共同で開発・公開している<a href="https://www.google.com/get/noto/cjk.html">Noto Sans CJK</a>/<a href="https://github.com/adobe-fonts/source-han-sans/tree/release">Source Han Sans</a>があります。しかし、OpenTypeフォントとしての配布である上に、TrueTypeに変換しても18MB前後のフォントファイルとなってしまい、Kodiで読み込めないことを確認したのでM+ FONTを利用します。</p>

<p>M+ FONTを利用するため、OSMC上で以下のスクリプトを実行するか、<code>curl -L http://git.io/pjg5 | sh -</code>とするとデフォルトフォントをM+ FONTに差し替えられます。
OSMCへはSSHで（USER/PASSともに<code>osmc</code>）ログインしてください。※パスワードの変更をお忘れなく。</p>

<script src="https://gist.github.com/mzyy94/15ee1b3880107e9d7ece.js"></script>


<p>このあと、Settings->Appearance->International->Japaneseとすることで、以下のような美しい日本語メニューが表示されるようになります。</p>

<p>（本当は日本語化したくてやったんじゃなく、次の記事で紹介する地デジの番組表情報が表示されるようにするために日本語フォントが必要で導入したので、表示確認後英語表記に戻しました。）</p>

<p><img src="/blog/resources/images/2015/02/16/osmc-mainmenu-jp.png" alt="OSMC JP" /></p>

<h1>MPEG-2ライセンス購入</h1>

<p>メディアプレイヤー用途として使うにはMPEG-2のハードウェアデコードを有効化して、快適に動画（地デジ）再生ができるようにしたいと思い、ライセンスを購入しました。</p>

<p>Raspberry PiはMPEG-2ハードウェアデコーダーの利用にライセンス料を課しているので、£2.40支払ってキーを入手します。
<a href="http://www.raspberrypi.com/mpeg-2-license-key/">ライセンスキーストア</a>にシリアル番号を入力してカートに入れ購入手続きし、深夜にでも送られてくるであろうシリアルキーを、
<code>echo decode_MPG2=0xdeadbeef | sudo tee -a /boot/config.txt</code>のようにしてハードウェア設定ファイルに追記し再起動してハードウェアデコーダーを有効にします。</p>

<p>これで快適に地デジなどの動画が再生できるようになります。</p>

<h1>次回予告</h1>

<p>Raspberry Pi 2で地デジ視聴する</p>
]]></content>
  </entry>
  
</feed>
