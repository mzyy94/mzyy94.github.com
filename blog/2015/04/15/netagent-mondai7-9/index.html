
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ネットエージェント最終面接問題 Write-up その3 - 犬アイコンのみっきー</title>
  <meta name="author" content="mzyy94">

  
  <meta name="description" content="あのネットエージェントのいきなり最終面接問題を解いたのでWrite-upを書きました。 2016年度 新卒採用｜ネットエージェント株式会社 これまでのmondaiはLinuxやOS Xがあれば解くことができていましたが、mondai7からはWindowsの実行ファイル形式やMicrosoft &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="犬アイコンのみっきー" type="application/atom+xml">
  <!-- main JS libs -->
  <script src="/javascripts/libs/modernizr.min.js"></script>
  <script src="/javascripts/jquery-2.0.3.min.js"></script>
  <script src="/javascripts/libs/jquery-ui.min.js"></script>
  <script src="/javascripts/libs/bootstrap.min.js"></script>
  <!-- Style CSS -->
  <link href="/stylesheets/bootstrap.css" media="screen" rel="stylesheet">
  <link href="/stylesheets/style.css" media="screen" rel="stylesheet">
  <link href="/stylesheets/syntax.css" media="screen" rel="stylesheet">
  <link href="/stylesheets/emoji.css" media="screen" rel="stylesheet">
  <!-- scripts -->
  <script src="/javascripts/general.js"></script>
  <!-- custom input -->
  <script src="/javascripts/jquery.customInput.js"></script>
  <script type="text/javascript" src="/javascripts/custom.js"></script>
  <!-- Placeholders -->
  <script type="text/javascript" src="/javascripts/jquery.powerful-placeholder.min.js"></script>
  <!-- Lightbox prettyPhoto -->
  <link href="/stylesheets/prettyPhoto.css" rel="stylesheet">
  <script src="/javascripts/jquery.prettyPhoto.js"></script>
  <!-- CarouFredSel  -->
  <script src="/javascripts/jquery.carouFredSel-6.2.1-packed.js"></script>
  <!-- Progress Bars -->
  <script src="/javascripts/progressbar.js"></script>
  <!-- Calendar -->
  <script src="/javascripts/jquery-ui.multidatespicker.js"></script>
  <!-- range sliders -->
  <script src="/javascripts/jquery.slider.bundle.js"></script>
  <script src="/javascripts/jquery.slider.js"></script>
  <link rel="stylesheet" href="/stylesheets/jslider.css">
  <!-- Video Player -->
  <link href="/stylesheets/video-js.css" rel="stylesheet">
  <script src="/javascripts/video.js"></script>
  <!-- Scroll Bars -->
  <script src="/javascripts/jquery.mousewheel.js"></script>
  <script src="/javascripts/jquery.jscrollpane.min.js"></script>

<!--[if lt IE 9]><script src="/javascripts/respond.min.js"></script><![endif]-->
<!--[if gte IE 9]>
<style type="text/css">
	.gradient {filter: none !important;}
</style>
<![endif]-->
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<meta property="twitter:card" content="summary" />
<meta property="twitter:site" content="mzyy94" />
<meta property="twitter:url" content="http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9" />
<meta property="twitter:title" content="ネットエージェント最終面接問題 Write-up その3" />

<meta property="twitter:description" content="あのネットエージェントのいきなり最終面接問題を解いたのでWrite-upを書きました。 2016年度 新卒採用｜ネットエージェント株式会社 これまでのmondaiはLinuxやOS Xがあれば解くことができていましたが、mondai7からはWindowsの実行ファイル形式やMicrosoft Officeドキュメントが登場したりと、そろそろWindowsがない環境には手厳しい問題となってきました &hellip;" />

<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41944495-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body  >
  <div class="container">
  <div class="content">
  <header class="row">
    <nav id="topmenu" class="col-sm-12" role="navigation"><ul class="dropdown clearfix boxed boxed-blue">
    <li class="menu-level-0"><a href="/">Home</a></li>
  <li class="menu-level-0"><a href="/blog/">Blog</a></li>
  <li class="menu-level-0"><a href="/service/">Service</a></li>
  <li class="menu-level-0">
  <a href="/about/">About</a>
  <ul class="submenu-1">
	  <li class="menu-level-1"><a href="/about/">About me</a></li>
	  <li class="menu-level-1"><a href="/about/license.html">License</a></li>
  </ul>
  </li>

  <li class="menu-level-0">
    <a>Subscribe</a>
	<ul class="submenu-1">
  <li class="menu-level-1"><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  <li class="menu-level-1"><a href="http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fmzyy94.com%2Fblog%2Fatom.xml" rel="subscribe-feedly" title="subscribe on Feedly">Feedly</a></li>
  
  </ul>
  
  <li class="menu-search last">

	<form action="https://www.google.com/search" id="searchForm" class="menu-search-form" method="get">
		<fieldset role="search">
			<input type="hidden" name="q" value="site:mzyy94.com" />
			<input type="text" name="q" value="" results="0" class="menu-search-field" placeholder="Search the website" hidefocus="true" style="outline: none;">
			<input type="submit" value="" class="btn menu-search-submit" name="search-send" hidefocus="true" style="outline: none;">
		</fieldset>
	</form>

  </li>
  
</ul>
</nav>
  </header>
  <header class="col-sm-12 boxed-red" role="banner"><hgroup>
  
  <h1><a href="/">犬アイコンのみっきー</a></h1>
  
</hgroup>

</header>
    <div class="row">
      <main class="col-sm-9">
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title boxed-green">ネットエージェント最終面接問題 Write-up その3</h1>
    
    
      <p class="meta">
        












<i class="glyphicon glyphicon-calendar"></i><time datetime="2015-04-15T00:01:21+09:00" pubdate data-updated="true">15 Apr 2015</time>
        

<i class="glyphicon glyphicon-folder-close"></i><span class="categories">
  
    <a class='category' href='/blog/categories/ctf/'>ctf</a>
  
</span>


        

<i class="glyphicon glyphicon-tags"></i><span class="tags">
  
    <a class='tag' href='/blog/tags/netagent/'>netagent</a>
  
</span>


        
		<i class="glyphicon glyphicon-comment"></i><a href="#disqus_thread"
             data-disqus-identifier="http://mzyy94.com">Comments</a>
        
      </p>
    
  </header>



<div class="entry-content"><p>あのネットエージェントのいきなり最終面接問題を解いたのでWrite-upを書きました。</p>

<ul>
<li><a href="http://www.netagent.co.jp/recruit/newgraduates_2016.html">2016年度 新卒採用｜ネットエージェント株式会社</a></li>
</ul>


<p>これまでのmondaiはLinuxやOS Xがあれば解くことができていましたが、mondai7からはWindowsの実行ファイル形式やMicrosoft Officeドキュメントが登場したりと、そろそろWindowsがない環境には手厳しい問題となってきました。
なので、今回の記事に掲載のmondaiはすべて（<code>file</code>コマンドでのファイル情報調査以外）、Windows上での解法となっております。</p>

<p>昨日の<a href="/blog/2015/04/14/netagent-mondai5-6/">mondai6までの解法</a>に続いて本日はmondai7、mondai8、mondai9の解法を公開します。</p>

<!-- more -->


<h1>mondai7</h1>

<p>mondai7はnormal.exeというWIN/PE32実行ファイルを解析して答えを得る問題のようです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file normal.exe
</span><span class='line'>normal.exe: PE32 executable <span class="k">for</span> MS Windows <span class="o">(</span>GUI<span class="o">)</span> Intel <span class="m">80386</span> 32-bit
</span></code></pre></td></tr></table></div></figure>


<p>今回はIDA Pro(demo)を使って解析してみます。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida1.png" alt="normal-ida1.png" /></p>

<p>IDAに解析させて表示を見てみると、おもむろに正解を表示するらしい<em>aCorrectKeyIsS</em>がみつかります。
ここまで来る過程をアセンブリ表示で追っていくことにします。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida2.png" alt="normal-ida2.png" /></p>

<p><em>aCorrectKeyIsS</em>はsprintfで渡されるテンプレート文字列で、そこにコマンドライン引数が埋め込められるようにいなっているようです。
このことから、normal.exeにキー候補の文字列をコマンドライン引数として渡して実行し、なにか判定があり、それが正しい場合に<strong>Correct! KEY is : </strong>に続いてその文字列が表示されるようになっていることがわかります。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida3.png" alt="normal-ida3.png" /></p>

<p>すこし遡ってみると、キーが表示される部分のサブルーチンへ来る前に、なにやら条件分岐があります。
コマンドライン第一引数の文字長をstrlenでチェックし、0x0A(=10)と比較し、合致しない場合に<strong>Try Again!</strong>と表示する処理がみつかりました。
このことから、キーは10文字長であることがわかります。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida4.png" alt="normal-ida4.png" /></p>

<p>キーが表示される直前に行われる処理を見てみると、サブルーチン<em>sub_4011C0</em>を呼んだ戻り値が0の場合、<strong>Try Again!</strong>の表示をさせるようになっています。
<em>sub_4011C0</em>にはコマンドライン引数を渡しているので、この引数が何か特定の文字列と比較されていると推測できます。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida5.png" alt="normal-ida5.png" /></p>

<p>サブルーチン<em>sub_4011C0</em>のはじめの方では、ループインデックス（以下、i）を0にしたりと、forループの初期化が行われている様子がつかめます。このループの中の処理を見てみます。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida6.png" alt="normal-ida6.png" /></p>

<p>このforループでは、iが0x0A(=10)になるまでループが回れば1を、途中でbreakが発生すれば0をサブルーチン呼び出し元に返すような処理をしています。
途中でbreakが発生する条件は、ループ内で呼ばれる<em>sub_401170</em>の戻り値と謎の配列<em>dword_40C068</em>の比較が偽である場合となっています。
要するに、このループがi=10になるまで回らないと呼び出し元に0が返され、<strong>Try Again!</strong>が表示されるということです。</p>

<p>コマンドライン引数のi番目の文字が引数として渡されて呼び出されている<em>sub_401170</em>を見てみます。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida7.png" alt="normal-ida7.png" /></p>

<p><em>sub_401170</em>はサブルーチンの引数で与えられた文字（＝コマンドライン引数のi番目の文字）が、謎の文字列<strong>&#8220;efyTUwxqrY&#8230;&#8221;</strong>の中の何番目に出てくるかを、forループを回して一つずつチェックしているようです。そしてサブルーチンの戻り値として、謎の文字列の何番目に引数の文字が現れたかを呼び出し元に返しています。</p>

<p><img src="/blog/resources/images/2015/04/15/normal-ida8.png" alt="normal-ida8.png" /></p>

<p>謎の配列<em>dword_40C068</em>の中身を見に行くと、unsignled long型の配列として、数値が格納されていました。
先のサブルーチン<em>sub_4011C0</em>のループ内では、コマンドライン引数のi番目の文字を<em>sub_401170</em>に渡し、謎の文字列の何番目に出現するかを取得し、その値とこの<em>dword_40C068</em>のi番目の数値を比較して、同じであればループを継続するという処理でした。</p>

<p>ここまでの調査を基にまとめると、このプログラムの処理は簡易的に以下のようになっていることがわかります。</p>

<ul>
<li>コマンドライン引数に与えられた文字列があり、</li>
<li>その文字列は10文字であり、</li>
<li>その文字列の1文字1文字が謎の文字列<strong>&#8220;efyTUwxqrY&#8230;&#8221;</strong>の何番目に位置するかを調べていて、</li>
<li>その位置がすべて謎の配列<em>dword_40C068</em>に定義されたもの同じであれば<strong>Correct! Key is :</strong>に続けて引数を表示する</li>
</ul>


<p>なので逆に考えると、謎の文字列の中の、謎の配列に定義されている場所の文字を抽出すればキーが見つかるということです。
パパッと以下のようなものを書いてキーを抽出します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;efyTUwxqrYHEFmduCJAXQpgKLBnhiltINPGOoszkMDvcjabSZRVW&quot;</span>
</span><span class='line'><span class="n">indexes</span> <span class="o">=</span> <span class="o">[</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x0f</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">indexes</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">key</span> <span class="o">+=</span> <span class="n">string</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">p</span> <span class="n">key</span>
</span></code></pre></td></tr></table></div></figure>




<!--
$ ruby mondai7.rb
"TochuKasou"
-->


<p>試しにnormal.exeの引数に、このコードを実行して得られたキーを与えて実行してみたところ、以下のようになりました。</p>

<p><img src="/blog/resources/images/2015/04/15/TochuKasou.png" alt="TochuKasou.png" /></p>

<p>この文字列を与えてmondai8.zipを解凍してmondai7は終了です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt; 7z.exe x mondai8.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.35 beta  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2014 Igor Pavlov  2014-12-07
</span><span class='line'>
</span><span class='line'>Processing archive: mondai8.zip
</span><span class='line'>
</span><span class='line'>Extracting  mondai8.tc
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>Extracting  mondai8.txt
</span><span class='line'>Extracting  mondai9.zip
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 3
</span><span class='line'>Size:       70339136
</span><span class='line'>Compressed: 70339594
</span><span class='line'>
</span><span class='line'>Kernel  <span class="nv">Time</span> <span class="o">=</span>     0.015 <span class="o">=</span>    0%
</span><span class='line'>User    <span class="nv">Time</span> <span class="o">=</span>     1.170 <span class="o">=</span>   21%
</span><span class='line'>Process <span class="nv">Time</span> <span class="o">=</span>     1.185 <span class="o">=</span>   22%    Virtual  <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">2</span> MB
</span><span class='line'>Global  <span class="nv">Time</span> <span class="o">=</span>     5.379 <span class="o">=</span>  100%    Physical <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">4</span> MB
</span></code></pre></td></tr></table></div></figure>




<!--
$ wine 7z x mondai8.zip -pTochuKasou

7-Zip [64] 9.20  Copyright (c) 1999-2010 Igor Pavlov  2010-11-18
p7zip Version 9.20 (locale=utf8,Utf16=on,HugeFiles=on,4 CPUs)

Processing archive: mondai8.zip

Extracting  mondai8.tc
Extracting  mondai8.txt
Extracting  mondai9.zip

Everything is Ok

Files: 3
Size:       70339136
Compressed: 70339594
-->


<h1>mondai8</h1>

<p>なにやら怪しげなファイルmondai8.tcと問題文mondai8.txtがあります。mondai8.txtには以下のような記述がありました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>TrueCrypt pass:mondai8
</span><span class='line'>漢字８文字
</span></code></pre></td></tr></table></div></figure>


<p>mondai8.tcはTrueCryptファイルで、開くためのパスワードはmondai8であるとのことです。そしてこのmondai8の答えは漢字8文字ということでしょう。
TrueCryptでmondai8.tcをマウントして中を見てみました。</p>

<p><img src="/blog/resources/images/2015/04/15/mondai8-files.png" alt="mondai8-files.png" /></p>

<p>こういったCTF系の問題でイメージファイルが配布されるときは、フォレンジック問題であると相場が決まっているので、TrueCryptでマウントしたらAutopsyで調査します。</p>

<p><img src="/blog/resources/images/2015/04/15/autopsy.png" alt="autopsy.png" /></p>

<p>マウントした際に表示されていたファイルになかった「今日の本.xlsx」という削除されたファイルが見つかりました。怪しいですね。
復元してファイルを開いてみます。</p>

<p><img src="/blog/resources/images/2015/04/15/todaysbook1.png" alt="todaysbook1.png" />
<img src="/blog/resources/images/2015/04/15/todaysbook2.png" alt="todaysbook2.png" />
<img src="/blog/resources/images/2015/04/15/todaysbook3.png" alt="todaysbook3.png" /></p>

<p>シート1にはアルファベットと2つの数字が書かれた行があり、シート2には、<a href="http://www.aozora.gr.jp/cards/001670/card56113.html">青空文庫の奇談クラブ</a>からコピーされたであろう本の内容が書かれていました。</p>

<p>シート3には、key:passwordに対応するanswerを入力するような空欄がありました。
このpasswordという文字列はきっとシート1のアルファベットと2つの数字に対応していて、1つ目の数字は行番号、2つ目の数字はその行の文字の位置を指しているだろうと思いました。
Excel Onlineの印刷機能でシート2をHTML形式にし、保存したのちテキストに変換して<a href="/blog/resources/data/2015/04/15/kidanclub.txt">kidanclub.txt</a>を作成し、
シート1を基に、アルファベット<strong>&#8220;password&#8221;</strong>に対応する行から文字を抽出するコードを書きました。</p>

<p><img src="/blog/resources/images/2015/04/15/print-book.png" alt="print-book.png" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'><span class="n">password</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">119</span><span class="p">,</span><span class="mi">161</span><span class="o">]</span><span class="p">,</span> <span class="c1"># p</span>
</span><span class='line'>  <span class="o">[</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">,</span> <span class="c1"># a</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">276</span><span class="p">,</span> <span class="mi">40</span><span class="o">]</span><span class="p">,</span> <span class="c1"># s</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">276</span><span class="p">,</span> <span class="mi">40</span><span class="o">]</span><span class="p">,</span> <span class="c1"># s</span>
</span><span class='line'>  <span class="o">[</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">58</span><span class="o">]</span><span class="p">,</span> <span class="c1"># w</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">239</span><span class="p">,</span> <span class="mi">44</span><span class="o">]</span><span class="p">,</span> <span class="c1"># o</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">236</span><span class="p">,</span>  <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="c1"># r</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">185</span><span class="p">,</span>  <span class="mi">7</span><span class="o">]</span>  <span class="c1"># d</span>
</span><span class='line'><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">book</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span>
</span><span class='line'><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">password</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1"># One-based numbering</span>
</span><span class='line'>  <span class="n">key</span> <span class="o">+=</span> <span class="n">book</span><span class="o">[</span><span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">-</span> <span class="mi">1</span><span class="o">][</span><span class="n">i</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">p</span> <span class="n">key</span>
</span></code></pre></td></tr></table></div></figure>


<p>引数に先ほど作成した<a href="/blog/resources/data/2015/04/15/kidanclub.txt">kidanclub.txt</a>を与えて実行してみると、漢字8文字のパスワードを得ることができました。</p>

<!--
$ ruby mondai8.rb kidanclub.txt
"意気揚揚明鏡止水"
-->


<p>mondai5同様、非ASCII文字のパスワードなので、<code>7z.exe</code>を利用してmondai9.zipを解凍しておしまいです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt; 7z.exe x mondai9.zip
</span><span class='line'>
</span><span class='line'>7-Zip <span class="o">[</span>64<span class="o">]</span> 9.35 beta  Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2014 Igor Pavlov  2014-12-07
</span><span class='line'>
</span><span class='line'>Processing archive: mondai9.zip
</span><span class='line'>
</span><span class='line'>Extracting  mondai10.tc
</span><span class='line'>Enter password <span class="o">(</span>will not be echoed<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>Extracting  mondai9.pkt
</span><span class='line'>
</span><span class='line'>Everything is Ok
</span><span class='line'>
</span><span class='line'>Files: 2
</span><span class='line'>Size:       68517107
</span><span class='line'>Compressed: 68241943
</span><span class='line'>
</span><span class='line'>Kernel  <span class="nv">Time</span> <span class="o">=</span>     0.046 <span class="o">=</span>    1%
</span><span class='line'>User    <span class="nv">Time</span> <span class="o">=</span>     0.733 <span class="o">=</span>   16%
</span><span class='line'>Process <span class="nv">Time</span> <span class="o">=</span>     0.780 <span class="o">=</span>   17%    Virtual  <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">2</span> MB
</span><span class='line'>Global  <span class="nv">Time</span> <span class="o">=</span>     4.536 <span class="o">=</span>  100%    Physical <span class="nv">Memory</span> <span class="o">=</span>      <span class="m">4</span> MB
</span></code></pre></td></tr></table></div></figure>




<!--
$ wine 7z.exe x mondai9.zip -p意気揚揚明鏡止水

7-Zip [64] 9.35 beta  Copyright (c) 1999-2014 Igor Pavlov  2014-12-07

Processing archive: mondai9.zip

Extracting  mondai10.tc
Extracting  mondai9.pkt

Everything is Ok

Files: 2
Size:       68517107
Compressed: 68241943

Kernel  Time =     0.046 =    5%
User    Time =     0.733 =   87%
Process Time =     0.780 =   93%    Virtual  Memory =      2 MB
Global  Time =     0.836 =  100%    Physical Memory =      4 MB
-->


<h1>mondai9</h1>

<p>mondai9.pktは<code>file</code>コマンドによると、little-endianなpcapファイルのようです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>file mondai9.pkt
</span><span class='line'>mondai9.pkt: tcpdump capture file <span class="o">(</span>little-endian<span class="o">)</span> - version 2.4 <span class="o">(</span>Ethernet, capture length 65535<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>また、拡張子pktはWindowsの関連付けでは、Wiresharkで開けるファイルとなっています。
早速Wiresharkで見てみます。</p>

<p><img src="/blog/resources/images/2015/04/15/mondai9-wireshark1.png" alt="mondai9-wireshark1.png" /></p>

<p>ざっと目を通した感じ、<code>tcpdump -f 'tcp port 80'</code>によって、fast-uploader.comにアクセスしている様子をキャプチャしたもののようです。</p>

<p><img src="/blog/resources/images/2015/04/15/mondai9-wireshark2.png" alt="mondai9-wireshark2.png" /></p>

<p>httpリクエストで絞り込むと、POSTメソッドによってファイルを幾つかアップロードしているようです。</p>

<p><img src="/blog/resources/images/2015/04/15/mondai9-wireshark3.png" alt="mondai9-wireshark3.png" /></p>

<p>アップロードしたファイルを抽出しようとメニューのHTTP objectから抽出を試みたのですが、Wiresharkでは<em>multipart/form-data</em>としてPOSTされたデータ中のファイルはうまく取り出せないようなので、NetworkMinerを使います。</p>

<p><img src="/blog/resources/images/2015/04/15/mondai9-networkminer.png" alt="mondai9-networkminer.png" /></p>

<p>NetworkMinerで4つのアップロードされたファイルを抽出したところ、文字化けした2つのExcelファイルと1つのWordファイル、パスワードのかかったzipファイルがありました。
パスワードをクラックするとWordファイルが出てきたので、4つのOfficeファイルを開いてみました。</p>

<p><img src="/blog/resources/images/2015/04/15/office-files.png" alt="office-files.png" /></p>

<p>どのOfficeファイルにも文字の記入はなく、答えらしきものがみつかりません。
ファイル名で検索してみたりいろいろしたあと、ファイルのメタ情報を詮索してみることにしたところ、文字化けしたWordファイルにそれらしきものがあることに気づきました。</p>

<p><img src="/blog/resources/images/2015/04/15/word-property.png" alt="word-property.png" /></p>

<p>これパスワードとしてmondai10.tcをTrueCryptでマウントしてみたところ、開くことができました。</p>

<p>明日は最終問題、mondai10のWrite-upを公開します。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard"><i class="glyphicon glyphicon-user"></i><span class="fn">mzyy94</span></span>

      












<i class="glyphicon glyphicon-calendar"></i><time datetime="2015-04-15T00:01:21+09:00" pubdate data-updated="true">15 Apr 2015</time>
      

<i class="glyphicon glyphicon-folder-close"></i><span class="categories">
  
    <a class='category' href='/blog/categories/ctf/'>ctf</a>
  
</span>


      

<i class="glyphicon glyphicon-tags"></i><span class="tags">
  
    <a class='tag' href='/blog/tags/netagent/'>netagent</a>
  
</span>


    </p>
    
      <div class="widget-container widget-social">
	<ul class="clearfix">
  

  <!--li class="social-twitter"><a href="https://twitter.com/intent/tweet?original_referer=http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/&text=ネットエージェント最終面接問題 Write-up その3%20-%20犬アイコンのみっきー&tw_p=tweetbutton&url=http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/&via=mzyy94"><i>Tweet</i></a></li-->

  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/" data-via="mzyy94" data-counturl="http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/" >Tweet</a>
  
  
  <!-- li class="social-google"><a href="#"><i>Google</i></a></li -->
  <div class="g-plusone" data-size="medium"></div>
  
  
  <!-- li class="social-facebook"><a href="#"><i>Facebook</i></a></li -->
  <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
  </ul>
</div>

    
    <div>
      
	  <a class="btn btn-icon-left btn-arrow-left" href="/blog/2015/04/14/netagent-mondai5-6/" title="Previous Post: ネットエージェント最終面接問題 Write-up その2"><span>ネットエージェント最終面接問題 Write-up その2</span></a>
      
      
	  <a class="btn btn-icon-right" href="/blog/2015/04/16/netagent-mondai10/" title="Next Post: ネットエージェント最終面接問題 Write-up エクストリームCTF編"><span>ネットエージェント最終面接問題 Write-up エクストリームCTF編</span></a>
      
    </div>
  </footer>
</article>

  <section class="comment">
    <h1 class="boxed-red">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</main>

<aside class="col-sm-3">
  
    <div class="widget-container widget-avatar boxed boxed-yellow">
	<div class="inner">
		<h5>mzyy94</h5>
		<span class="subtitle">Network</span>
		<div class="avatar">
			<img src="/images/avatar.png" alt="avatar icon" />
		</div>
		<a href="/about/" class="btn btn-brown btn-follow">
			<span>About me</span>
		</a>
	</div>
</div>
<div class="widget-container widget_calendar boxed boxed-red">
	<div class="inner">
		<input type="text" name="date_departure" class="inputField" id="date_departure">
	</div>
</div>
<script>
	// <![CDATA[
	$(document).ready(function() {
		var posts = {};
		var datelist = [];
		$.getJSON('/blog/posts.json', function(data){
			var dp = data.posts;
			for(var i = 0, limit = dp.length; i < limit; i++){
				var date = new Date(dp[i].date);
				posts[dp[i].date] = {title:dp[i].title,
					url: '/blog/' + date.getFullYear() + '/' + ('0' + (date.getMonth() + 1)).slice(-2) + '/' + ('0' + date.getDate()).slice(-2) + '/' + dp[i].url + '/'}
				datelist.push(dp[i].date);
			}
			assignCalendar('#date_departure');
			refreshDate();
		});


		function assignCalendar(id){
			$('<div class="calendar" />')
				.insertAfter( $(id) )
				.datepicker({
					beforeShowDay: function(date){
						var string = $.datepicker.formatDate('dd M yy', date);
						return [ datelist.indexOf(string) != -1 ]
					},
					dateFormat: 'dd M yy',
					minDate: new Date(datelist[datelist.length - 1]),
					maxDate: new Date(),
					maxPicks: 1,
					altField: id,
					firstDay: 0,
					showOtherMonths: true,
					onSelect: function(date){
						window.location.href = posts[date].url;
					},
					onChangeMonthYear: refreshDate
				}).prev().hide();
		}

		var month = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
		function refreshDate(){
			setTimeout(function(){
				$('a.ui-state-default').each(function(num){
					var yy = $(this).parent().attr('data-year');
					var M = month[$(this).parent().attr('data-month')];
					var dd = ('0' + $(this).text()).slice(-2);
					var idx = dd + ' ' + M + ' ' + yy;
					$(this).attr('data-title', posts[idx].title);
					$(this).attr('href', posts[idx].url);
				});
			},10);
		}
	});
	// ]]>
</script>
<section class="widget-container widget-recently boxed">
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/18/defcon-qual-23-writeup/">DEFCON CTF 23予選Write-up</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/29/ebi-the-move/">えびの水槽引越しと環境整備と飼育について</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/26/no-shrimp-no-life/">小さなえびを飼い始めて2ヶ月が過ぎた</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/netagent-mondai10/">ネットエージェント最終面接問題 Write-up エクストリームCTF編</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/15/netagent-mondai7-9/">ネットエージェント最終面接問題 Write-up その3</a>
      </li>
    
  </ul>
</section>

<section class="widget-container widget-github boxed">
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mzyy94',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<div class="widget-container boxed boxed-blue">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- sidebar-small -->
<ins class="adsbygoogle"
	style="display:inline-block;width:120px;height:240px"
	data-ad-client="ca-pub-5429584698977304"
	data-ad-slot="3454316875"></ins>
<!-- sidebar-small2 -->
<ins class="adsbygoogle"
	style="display:inline-block;width:120px;height:240px"
	data-ad-client="ca-pub-5429584698977304"
	data-ad-slot="6626453278"></ins>
<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>




  
</aside>


    </div>
  

<script type="text/javascript">
      var disqus_shortname = 'mzyy94blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/';
        var disqus_url = 'http://mzyy94.com/blog/2015/04/15/netagent-mondai7-9/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
  <footer class="boxed-yellow" role="contentinfo"><p>
  Copyright &copy; 2015 - mzyy94 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> -
  <span class="credit">Designed with <a href="http://pixelkit.com/kits/flat-ui-kit">Flat UI Kit | Modern Touch</a></span> -
  <span>Licensed under a <a rel="license" href="http://opensource.org/licenses/mit-license.html">MIT License</a> and <a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a><span>
</p>
<script>
	$(function () {
		$("a[href^='http'], a[href^='ftp']").click(function () {
			if ($(this).attr("target") === undefined) 
			$(this).attr("target", "_blank");
		});
	});
</script>

</footer>
  </div>
</body>
</html>
